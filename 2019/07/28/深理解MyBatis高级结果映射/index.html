<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
  <script src="/vendors/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/vendors/pace/pace-theme-minimal.min.css?v=1.0.2">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    sidebar: {"position":"right","width":300,"display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };


</script>
 <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #9fa6b3;    /*��������ɫ*/
        height: 2px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #225cc7, 0 0 5px #225cc7; /*��Ӱ��ɫ*/
    }
    .pace .pace-activity {
        border-top-color: #9fa6b3;    /*�ϱ߿���ɫ*/
        border-left-color: #9fa6b3;    /*��߿���ɫ*/
    }
</style>

  <meta name="description" content="搭建实验环境  1).新建数据库mybatis6   2). 新建表：sys_user、sys_role、sys_user_role,sys_privilege、sys_role_privilege  sql脚本如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495">
<meta name="keywords" content="MyBatis">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解MyBatis高级结果映射">
<meta property="og:url" content="http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/index.html">
<meta property="og:site_name" content="LoveITer">
<meta property="og:description" content="搭建实验环境  1).新建数据库mybatis6   2). 新建表：sys_user、sys_role、sys_user_role,sys_privilege、sys_role_privilege  sql脚本如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==">
<meta property="og:updated_time" content="2019-08-22T16:16:45.386Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解MyBatis高级结果映射">
<meta name="twitter:description" content="搭建实验环境  1).新建数据库mybatis6   2). 新建表：sys_user、sys_role、sys_user_role,sys_privilege、sys_role_privilege  sql脚本如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495">
<meta name="twitter:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==">
  <link rel="alternate" href="/atom.xml" title="LoveITer" type="application/atom+xml">
  <link rel="canonical" href="http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>深入理解MyBatis高级结果映射 | LoveITer</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3b26557457e046bcc561ba2a4b40401e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-right">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LoveITer</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">欢迎访问我的个人博客</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">6</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">3</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">34</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

<article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">



<div class="post-block">
<link itemprop="mainEntityOfPage" href="http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/">

<span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
<meta itemprop="name" content="黄鑫">
<meta itemprop="description" content="Talk is cheap. Show me the code">
<meta itemprop="image" content="/images/avatar.png">
</span>

<span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="LoveITer">
</span>
<header class="post-header">


<h2 class="post-title" itemprop="name headline">深入理解MyBatis高级结果映射


</h2>


<div class="post-meta">
<span class="post-meta-item">
<span class="post-meta-item-icon">
<i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">发表于</span>





<time title="创建时间：2019-07-28 18:26:33" itemprop="dateCreated datePublished" datetime="2019-07-28T18:26:33+08:00">2019-07-28</time>
</span>




<span class="post-meta-item">
<span class="post-meta-item-icon">
  <i class="fa fa-calendar-check-o"></i>
</span>
<span class="post-meta-item-text">更新于</span>
<time title="修改时间：2019-08-23 00:16:45" itemprop="dateModified" datetime="2019-08-23T00:16:45+08:00">2019-08-23</time>
</span>


<span class="post-meta-item">
<span class="post-meta-item-icon">
<i class="fa fa-folder-o"></i>
</span>
<span class="post-meta-item-text">分类于</span>

<span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/MyBatis框架/" itemprop="url" rel="index"><span itemprop="name">MyBatis框架</span></a></span>




</span>



<span class="post-meta-item" title="阅读次数">
<span class="post-meta-item-icon">
<i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读次数：</span>
<span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
</span>


</div>
</header>




<div class="post-body" itemprop="articleBody">


<h4 id="搭建实验环境"><a href="#搭建实验环境" class="headerlink" title="搭建实验环境"></a><font color="black">搭建实验环境</font></h4><ul>
 <li><font color="black">1).新建数据库mybatis6 </font></li>
 <li><font color="black">2). 新建表：sys_user、sys_role、sys_user_role,sys_privilege、sys_role_privilege</font></li>
 <font color="black">sql脚本如下：</font>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  user_name <span class="built_in">varchar</span>(<span class="number">255</span>) ,</span><br><span class="line">  user_password <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  user_email <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  user_info <span class="built_in">text</span> <span class="keyword">comment</span> <span class="string">'用户简介'</span>,</span><br><span class="line">  head_img <span class="built_in">blob</span> <span class="keyword">comment</span> <span class="string">'头像'</span>,</span><br><span class="line">  create_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  role_name <span class="built_in">varchar</span>(<span class="number">255</span>) ,</span><br><span class="line">  <span class="keyword">enable</span> <span class="built_in">int</span> <span class="keyword">comment</span> <span class="string">'有效标志'</span>,</span><br><span class="line">  create_by <span class="built_in">bigint</span> <span class="keyword">comment</span> <span class="string">'创建人'</span>,</span><br><span class="line">  create_time datetime</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_privilege(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>  auto_increment,</span><br><span class="line">  privilege_name <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">comment</span> <span class="string">'权限名称'</span>,</span><br><span class="line">  privilege_url <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_role(</span><br><span class="line">  user_id <span class="built_in">bigint</span> ,</span><br><span class="line">  role_id <span class="built_in">bigint</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role_privilege(</span><br><span class="line">  role_id <span class="built_in">bigint</span>,</span><br><span class="line">  privilege <span class="built_in">bigint</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'admin'</span>,<span class="string">'123456'</span>,<span class="string">'adimin@mybatis.tk'</span>,<span class="string">'管理员'</span>,<span class="literal">null</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user <span class="keyword">values</span>(<span class="string">'1002'</span>,<span class="string">'testuser'</span>,<span class="string">'123456'</span>,<span class="string">'test@mybatis.tk'</span>,<span class="string">'测试用户'</span>,<span class="literal">null</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'管理员'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'普通用户'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1'</span>,<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1'</span>,<span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1001'</span>,<span class="string">'2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'用户管理'</span>,<span class="string">'/user'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'角色管理'</span>,<span class="string">'/roles'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'系统管理'</span>,<span class="string">'/system'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'4'</span>,<span class="string">'系统维护'</span>,<span class="string">'/system-a'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'5'</span>,<span class="string">'单位管理'</span>,<span class="string">'/company'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'3'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'4'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'5'</span>);</span><br></pre></td></tr></table></figure>

 <li><font color="black">3).新建每个 表对应的实体JavaBean</font></li>
 <font color="black">SysUser.java</font>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String userPassword;</span><br><span class="line">    <span class="keyword">private</span> String userEmail;</span><br><span class="line">    <span class="keyword">private</span> String userInfo;</span><br><span class="line">    <span class="keyword">private</span> String headImg;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> SysRole role;   <span class="comment">//用户的角色</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; roleList;   <span class="comment">//用户角色结合和</span></span><br><span class="line">    <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure>

<p> <font color="black"> SysRole.java</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRole</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> enable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> createBy;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SysPrivilege&gt; privilegeList;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure>

<p> <font color="black">SysUserRole.java</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserRole</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">      <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure>

<p> <font color="black">SysPrivilege.java</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysPrivilege</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String privilegeName;</span><br><span class="line">    <span class="keyword">private</span> String privilegeUrl;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure>

<p>  <font color="black">SysRolePrivilege.java</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRolePrivilege</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">    <span class="keyword">private</span> Long privilegeId;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure>

 <li> <font color="black">4).新建SysUserMapper接口</font> </li>
 <li> <font color="black">5). 新建mybaits配置文件</font></li>
<center><span class="exturl" data-url="aHR0cHM6Ly9zbS5tcy9pbWFnZS94N1hQQ3BhNElLeVNCSnI=" title="https://sm.ms/image/x7XPCpa4IKySBJr"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2019/08/17/x7XPCpa4IKySBJr.gif"><i class="fa fa-external-link"></i></span></center>
</ul>

<h4 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">一对一映射</font></div></h4><p><font color="black">Mybatis中的映射方式有两种，一种是通过resultType自动映射，另一种是通过resultMap自己设置映射规则。resultMap又有两种映射方式：<strong>嵌套结果映射</strong>和<strong>嵌套查询映射</strong>。</font></p>
<ul>
<li><font color="black"><strong>嵌套结果映射:</strong>给数据库发一条复杂的sql语句把查询到的结果根据映射规则映射到不同的对象中</font></li>
<li><font color="black"><strong>嵌套查询映射：</strong>会发多条sql简单的语句，Mybatis会把多条sql语句的查询据结果封装到一个对象中。如果在mybatis全局配置中设置了延迟加载：`
<setting name="lazyLoadingEnabled" value="true">
        <!--aggressvieLazyLoading当这个参数为true的时候，对任意延迟属性都会完全的加载，当为false时会按需加载-->
        <setting name="aggressiveLazyLoading" value="false">`
        那么还可以按需给数据库发sql语句，即当没有用到这个表中的数据的时候，Mybatis压根就不会给数据库法sql语句，即使已在xml文件中已经配置了sql语句，这是MyBatis中非常强大的一个功能。</setting></setting></font></li>
</ul><font color="black">配置xml文件：<br>通过resultMap一对一映射，在SysUser实体类中新增一个属性<code>private SysRole role</code> 标识用户的角色，然后在SysUserMapper.xml中写如下映射<code>userRoleMap</code>：</font><p></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecla.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--sys_user表中原有的属性--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           id:id元素是一个很特殊的元素，如果设置了它，MyBayis会比较每次返回来的数据的id,如果id相同，MyBatis就会认为这是同一条数据，然后就会把这两条数据合并；如果没有设置id,MyBatis会比较resultMap下所有的字段属性，只要有一个不同就不会合并。</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--role字段在sys_user表中没有，而且role他是一个复杂的类型，没法直接映射，最简单的可以通过如下这种方式来映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">       select</span><br><span class="line">          sys_user.*,sys_role.role_name</span><br><span class="line">        from</span><br><span class="line">          sys_user,sys_role</span><br><span class="line">        where</span><br><span class="line">       sys_user.id=#&#123;id&#125; and sys_role.role_name=sys_user.user_info</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">在SysUserMapper接口中增加方法：<code>public SysUser selectUserAndRoleById(Long id);</code></font><br><font color="black">测试方法：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">           SysUser user = sum.selectUserAndRoleById(<span class="number">1002L</span>);</span><br><span class="line">           System.out.println(user);</span><br><span class="line">           <span class="comment">//log.info(sum);</span></span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">这是日志的打印结果：</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 10:16:52 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] ==&gt;  Preparing: select sys_user.*,sys_role.role_name from sys_user,sys_role where sys_user.id=? and sys_role.role_name=sys_user.user_info </span><br><span class="line">  2019-07-31 10:16:52 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 10:16:53 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=null, roleName=&apos;普通用户&apos;, enable=0, createBy=0, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 10:16:53 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 10:16:53 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br></pre></td></tr></table></figure>

<p><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;改进上面的映射方法：上面的映射方法虽然可以使用，但是耦合性太高，而且最大的问题是配置文件不能复用，啥意思?就是说，如果我现在需要一个单独查用户的方法，那我还得专门为查用户写一个sql配置，这样做非常的糟糕，当项目非常大的时候，配置文件的重复配置代码将会非常的多，那么如何解决这个问题呢?我们接着往下看:</font><br><font color="black">在SysUserMapper.xml中增加一个专门为查用户的映射<code>userMap</code>：</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUser"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">      select * from sys_user where id=#&#123;id&#125;;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">然后刚才的上面的<code>userRoleMap</code>就可以修改成下面的样子：</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      使用resultMap可以自定义结果集的映射关系</span></span><br><span class="line"><span class="comment">         type:这个样映射到那个pojo</span></span><br><span class="line"><span class="comment">         id：给这个映射关系起的一个唯一的标识</span></span><br><span class="line"><span class="comment">         extends:resultMap可以继承别的map已经定义好的关系，比如下面的userMap在上门已经定义了，在下面可以继承后直接使用</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">          sys_user.*,sys_role.role_name</span><br><span class="line">        from</span><br><span class="line">          sys_user,sys_role</span><br><span class="line">        where</span><br><span class="line">          sys_user.id=#&#123;id&#125; and sys_role.role_name=sys_user.user_info</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">使用association元素替代上面的role.XXX:</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"> <span class="comment">&lt;!--使用association和一个复杂的类型进行关联</span></span><br><span class="line"><span class="comment">       property:pojo中对应的属性名，必填</span></span><br><span class="line"><span class="comment">       javaType:这个属性对应的pojo类型</span></span><br><span class="line"><span class="comment">       resultMap:可以使用这个属性配置已有的map，</span></span><br><span class="line"><span class="comment">                 如果要引用当前mapper中的resultMap，直接引用</span></span><br><span class="line"><span class="comment">                 如果引用别的mapper中的resultMap，要指定namespace以及引用的那个map的id</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap2"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">可是这样还是不行，实际的开发中，肯定会有关于单独查询sys_role的需求，而且人家sys_role肯定也会有单独的mapper,这样就又会存在重复配置的问题，解决这个问题需要用到association元素的另一个功能,具体看代码：</font><br><font color="black">新建SysRoleMapper.xml,并配置<code>roleMap</code>如下：</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SysRoleMapper.xml</span><br><span class="line"><span class="comment">&lt;!--根据id查询角色--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span> <span class="attr">id</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        select * from sys_role where id=#&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">这样我们在<code>SysUserMapper.xml</code>就可以把刚才的配置彻底抽取了出来：</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--在association中使用resultMap属性指定要关联的Map</span></span><br><span class="line"><span class="comment">            resultMap=目标map的namespace.目标map的id   在同一个mapper中也可以这么使用，但是只用指定id就够了</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.roleMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">这样就彻底把模块与模块分开了,当然我们也可以顺便实现以下<code>selectRoleById</code>,下面是配置后的运行时打印的日志的部分：</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] ==&gt; Preparing: select sys_user.*,sys_role.role_name from sys_user,sys_role where sys_user.id=? and sys_role.role_name=sys_user.user_info </span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=1002, roleName=&apos;普通用户&apos;, enable=0, createBy=0, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 10:57:08 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p><font color="black">可以看到，日志的打印结果相同，但是修改后的方式肯定比一开始的方法要好，因为这样就把各个查询模块化了，就像搭积木，一个个简单的“积木块”最后通过合理的组织，就可以实现不同的复杂查询。</font><br><font color="black"><strong>一对一的嵌套查询映射</strong></font><br><font color="black">上面这种方法是嵌套结果映射，就是直接给数据库发一条sql语句，数据库返回数据后Mybatis根据映射规则，把数据映射到不同的对象中。而嵌套查询映射则是多次给数据库发简单的sql语句，然后把不同的数据映射到一个对象中。</font></p>
<blockquote>
<p> <font color="black"> 1.<strong>association元素的嵌套查询：<br>      &nbsp; &nbsp;   select :另一个映射查询map的id<br>        &nbsp; &nbsp; column：将主查询的那个列的结果作为嵌套查询的参数传给嵌套查询方法<br>       &nbsp; &nbsp;  fetchType:数据加载的方式[lazy或eager],即延迟加载或积极加载,<br>                 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; 配置这个属性会覆盖全局配置中飞lazyLoadingEnabled<br>              2.MyBatis的嵌套查询可以实现懒加载，简单点的说就是不用的时候就不给你加载，等用的时候才去给你加载,这样做的好处是可以降低数据库的压力，做到按需响应。那么要用懒加载必须在全局配置文件中设置如下：<font color="black"><br><code>&lt;settings&gt;
        &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;  &lt;!--vallue=false时按需加载-，否者全部加载-&gt;
        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;   &lt;!--是否开启懒加载，true表示开启--&gt;
         &lt;setting name=&quot;lazyLoadTriggerMethods&quot;        value=&quot;equals,clone,hashCode,toString&quot;/&gt;    &lt;!--懒加载模式下如果调用value后的方法将全部加载--&gt;
    &lt;/settings&gt;</code></font><br></strong></font></p>
</blockquote>
<p><font color="black">在SysUserMapper.xml中写一个id为userRoleMapSelecct的新的映射关系，并写SQL查询语句如下：</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMapSelect"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         association的select元素中指定另一个嵌套的子查询</span></span><br><span class="line"><span class="comment">         select=子查询Mapper接口中对应方法的全类名</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.selectRoleById"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">column</span>=<span class="string">"&#123;id=role_id&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById3"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMapSelect"</span>&gt;</span></span><br><span class="line">SELECT</span><br><span class="line">	sys_user.id,</span><br><span class="line">	sys_user.user_name,</span><br><span class="line">	sys_user.user_password,</span><br><span class="line">	sys_user.user_email,</span><br><span class="line">	sys_user.user_info,</span><br><span class="line">	sys_user.head_img,</span><br><span class="line">	sys_user.create_time,</span><br><span class="line">	sys_user_role.role_id </span><br><span class="line">FROM</span><br><span class="line">	sys_user,</span><br><span class="line">	sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">	sys_user.id = sys_user_role.user_id </span><br><span class="line">	AND sys_user.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">配置好后我们在SysUserMapper接口中增加<code>selectUserAndRoleById3</code>方法,然后写测试：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">            List&lt;SysUser&gt; user = sum.selectUserAndRoleById3(<span class="number">1002L</span>);</span><br><span class="line">            <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">                 System.out.println(u);</span><br><span class="line">                <span class="comment">//System.out.println(u.getUserName() + "," + u.getUserEmail() + "," + u.getCreateTime());</span></span><br><span class="line">            &#125;</span><br><span class="line">            log.info(sum);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">日志的打印结果：</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Opening JDBC Connection</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Created connection 785447854.</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt;  Preparing: select sys_user.id, sys_user.user_name, sys_user.user_password, sys_user.user_email, sys_user.user_info, sys_user.head_img, sys_user.create_time, sys_user_role.role_id from sys_user,sys_user_role where sys_user.id=sys_user_role.user_id and sys_user.id=? </span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 11:29:54 [WARN]-[org.apache.ibatis.session.AutoMappingUnknownColumnBehavior] Unknown column is detected on &apos;com.orecal.mapper.SysUserMapper.selectUserAndRoleById3&apos; auto-mapping. Mapping parameters are [columnName=role_id,propertyName=role_id,propertyType=null]</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] &lt;==      Total: 1</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] ==&gt;  Preparing: select * from sys_role where id=?; </span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] ==&gt; Parameters: 2(Long)</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=2, roleName=&apos;普通用户&apos;, enable=1, createBy=1, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 11:29:54 [INFO]-[com.orecal.AppTest] org.apache.ibatis.binding.MapperProxy@6580cfdd</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p><font color="black">可以看到，MyBatis分别给数据库发了两条sql语句，这是因为直接打印，在配置文件的setting中有一个元素<code>lazyLoadTriggerMethods  默认值value=&quot;equals,clone,hashCode,toString&quot;</code>，当程序中调用这些方法的时就会全部加载。但是如果我们在程序中只是用到User的一些属性，那么Mybatis就只发查user的sql语句,把测试代码中的<code>System.out.println(u);</code>改成<code>System.out.println(u.getUserName() + &quot;,&quot; + u.getUserEmail() + &quot;,&quot; + u.getCreateTime());</code></font></p>
<p><font color="black">再次运行打印的日志部分如下：</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt;  Preparing: select sys_user.id, sys_user.user_name, sys_user.user_password, sys_user.user_email, sys_user.user_info, sys_user.head_img, sys_user.create_time, sys_user_role.role_id from sys_user,sys_user_role where sys_user.id=sys_user_role.user_id and sys_user.id=? </span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 11:27:13 [WARN]-[org.apache.ibatis.session.AutoMappingUnknownColumnBehavior] Unknown column is detected on &apos;com.orecal.mapper.SysUserMapper.selectUserAndRoleById3&apos; auto-mapping. Mapping parameters are [columnName=role_id,propertyName=role_id,propertyType=null]</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] &lt;==      Total: 1</span><br><span class="line">  testuser,test@mybatis.tk,Tue Jul 30 10:05:56 CST 2019</span><br><span class="line">2019-07-31 11:27:13 [INFO]-[com.orecal.AppTest] org.apache.ibatis.binding.MapperProxy@6a400542</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p><font color="black">可以看到，只发了一条sql语句。这就是MyBatis的延迟加载（懒加载），也就是说，当你没用到的时候，MyBatis压根不会帮你去查这个数据。这样一来的好处是会减轻数据库的压力。</font></p>
<h4 id="一对多映射"><a href="#一对多映射" class="headerlink" title="一对多映射"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">一对多映射</font></div></h4><p><strong><font color="black">使用<code>collection</code>实现一对多映射</font></strong>,<code>collection</code>的属性和用法与<code>association</code>基本是一样的，只是<code>collection</code>是专门用来映射数据库中一对多的多方元素的一个集合。比如现在有这样的需求：查询所有用户以及每个用户在本系统中所拥有的角色。这是一个很典型的一对多的例子，一个用户在系统中有多个角色。<br><strong>举个栗子：</strong><br><font color="black">在SysUser.java中增加属性<code>List&lt;SysRole&gt; roleList</code></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他的属性不变</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysRole&gt; roleList;   <span class="comment">//用户角色结合</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysRole&gt; <span class="title">getRoleList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> roleList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleList</span><span class="params">(List&lt;SysRole&gt; roleList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.roleList = roleList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="black"> 在SysUserMapper.xml中增加reultMap<code>userRoleListMap</code>,由于<code>roleMap</code>在前面已经定义过了，这里就可以直接使用</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.roleMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>&gt;</span></span><br><span class="line">SELECT</span><br><span class="line">	sys_user.*,</span><br><span class="line">	sys_role.* </span><br><span class="line">FROM</span><br><span class="line">	sys_user,</span><br><span class="line">	sys_role,</span><br><span class="line">	sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">	sys_user_role.user_id = sys_user.id </span><br><span class="line">	AND sys_user_role.role_id = sys_role.id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">测试代码：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">        List&lt;SysUser&gt; user = sum.selectAllUserAndRole();</span><br><span class="line">        System.out.println(<span class="string">"用户数："</span> + user.size());</span><br><span class="line">        <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">            System.out.println(<span class="string">"用户名："</span> + u.getUserName());</span><br><span class="line">            <span class="keyword">for</span> (SysRole role : u.getRoleList()) &#123;</span><br><span class="line">                System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(sum);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">程序运行打印的日志：</font></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Opening JDBC Connection</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">741669172</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt;  Preparing: select sys_user.*,sys_role.*,sys_privilege.* from sys_user, sys_role,sys_user_role,sys_privilege,sys_role_privilege where sys_user_role.user_id=sys_user.id and sys_user_role.role_id=sys_role.id and sys_role_privilege.role_id=sys_role.id and sys_privilege.id=sys_role_privilege.privilege_id; </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt; Parameters: </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> &lt;==      Total: <span class="number">7</span></span><br><span class="line">  用户数：<span class="number">2</span></span><br><span class="line">用户名：admin</span><br><span class="line">角色名：管理员</span><br><span class="line">角色名：普通用户</span><br><span class="line">用户名：testuser</span><br><span class="line">角色名：普通用户</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@38c5cc4c</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2c34f934]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">741669172</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><font color="black"> 前面这个实现了一层嵌套，就是一个主查询下面只有一个层子查询然后就结束了，下面我们尝试来实现一个两层嵌套：比如现在有这样的需求：查询所有的用户的角色，以及每个角色拥有的权限。很好想，就是一个用户可以有多个角色，每个角色又有不同的权限。</font><br><font color="black"> <strong>实现：</strong></font><br><font color="black">  首先在SysRole中增加一个属性<code>private List&lt;SysPrivilege&gt; privilegeList</code></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他的属性不变</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysPrivilege&gt; privilegeList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysPrivilege&gt; <span class="title">getPrivilegeList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> privilegeList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrivilegeList</span><span class="params">(List&lt;SysPrivilege&gt; privilegeList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.privilegeList = privilegeList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">新建SysPrivilegeMapper.xml文件，增加一个resultMap<code>privilegeMap</code></font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysPrivilege"</span> <span class="attr">id</span>=<span class="string">"privilegeMap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"privilegeName"</span> <span class="attr">column</span>=<span class="string">"privilege_name"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"privilegeUrl"</span> <span class="attr">column</span>=<span class="string">"privilege_url"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   SELECT</span><br><span class="line">	sys_privilege.* </span><br><span class="line">FROM</span><br><span class="line">	sys_privilege,</span><br><span class="line">	sys_role_privilege </span><br><span class="line">WHERE</span><br><span class="line">	sys_role_privilege.privilege_id = sys_privilege.id </span><br><span class="line">	AND sys_role_privilege.role_id = #&#123;roleId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black"> 在SysRoleMapper.xml中增加一个resultMap<code>rolePrivilegeListMap</code>，由于roleMap在上面已经定义过了，，用extends继承他就可以直接使用了。</font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SysRoleMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMap"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privilegeList"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysPrivilegeMapper.privilegeMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllRoleAndPrivilege"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMap"</span>&gt;</span></span><br><span class="line">   select </span><br><span class="line">      sys_role.*,</span><br><span class="line">      sys_privilege.*</span><br><span class="line">   from </span><br><span class="line">      sys_role,</span><br><span class="line">      sys_privilege,</span><br><span class="line">      sys_role_privilege</span><br><span class="line">   where </span><br><span class="line">   sys_role_privilege.role_id=sys_role.id and                        sys_privilege.id=sys_role_privilege.privilege_id;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">在SysUserMapper.xml中增加reusltMap:<code>userRoleListMapSelect</code></font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMapSelect"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.rolePrivilegeListMap"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole2"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>&gt;</span></span><br><span class="line">          SELECT</span><br><span class="line">	sys_user.*,</span><br><span class="line">	sys_role.*,</span><br><span class="line">	sys_privilege.* </span><br><span class="line">FROM</span><br><span class="line">	sys_user,</span><br><span class="line">	sys_role,</span><br><span class="line">	sys_user_role,</span><br><span class="line">	sys_privilege,</span><br><span class="line">	sys_role_privilege </span><br><span class="line">WHERE</span><br><span class="line">	sys_user_role.user_id = sys_user.id </span><br><span class="line">	AND sys_user_role.role_id = sys_role.id </span><br><span class="line">	AND sys_role_privilege.role_id = sys_role.id </span><br><span class="line">	AND sys_privilege.id = sys_role_privilege.privilege_id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">在SysUserMapper接口中增加方法<code>selectAllUserAndRole2</code>，并且编写测试代码：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">       List&lt;SysUser&gt; user = sum.selectAllUserAndRole();</span><br><span class="line">       System.out.println(<span class="string">"用户数："</span> + user.size());</span><br><span class="line">       <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">         System.out.println(<span class="string">"用户名："</span> + u.getUserName());</span><br><span class="line">         <span class="keyword">for</span> (SysRole role : u.getRoleList()) &#123;</span><br><span class="line">         System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">            <span class="keyword">for</span> (SysPrivilege privilege : role.getPrivilegeList()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"权限："</span> + privilege.getPrivilegeName());</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">          System.out.println(<span class="string">"--------------------------------------------------------"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">程寻运行打印的日志的一部分：</font></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">741669172</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt;  Preparing: select sys_user.*,sys_role.*,sys_privilege.* from sys_user, sys_role,sys_user_role,sys_privilege,sys_role_privilege where sys_user_role.user_id=sys_user.id and sys_user_role.role_id=sys_role.id and sys_role_privilege.role_id=sys_role.id and sys_privilege.id=sys_role_privilege.privilege_id; </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt; Parameters: </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> &lt;==      Total: <span class="number">7</span></span><br><span class="line">  用户数：<span class="number">2</span></span><br><span class="line">用户名：admin</span><br><span class="line">角色名：管理员</span><br><span class="line">权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">角色名：普通用户</span><br><span class="line">权限：系统维护</span><br><span class="line">权限：单位管理</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">用户名：testuser</span><br><span class="line">角色名：普通用户</span><br><span class="line">权限：系统维护</span><br><span class="line">权限：单位管理</span><br><span class="line">--------------------------------------------------------</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@38c5cc4c</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2c34f934]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">741669172</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><font color="black">这样，我们就算是实现了一对多的两层嵌套结果映射的一个查询，这种方式在日常非常常见，也是MyBatis中非常强大的地方。<br>最后我们看一下一对多的嵌套查询映射，和一对一的实现方法是类似的：<br>前面我们写过一个resultMap<code>rolePrivilegeListMap</code>，但是还没有为他写接口方法，这里我们首先来实现这个：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SysPrivilegeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过角色ID获得它的权限</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SysPrivilege&gt; <span class="title">selectPrivilegeByRoleId</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">在SysRoleMapper.xml增加一个resultMap:<code>rolePrivilegeListMap2</code></font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMap2"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privilegeList"</span>                               <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">column</span>=<span class="string">"&#123;roleId=id&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMap2"</span>&gt;</span></span><br><span class="line">      SELECT</span><br><span class="line">	sys_role.* </span><br><span class="line">FROM</span><br><span class="line">	sys_role,</span><br><span class="line">	sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">	sys_user_role.user_id = sys_role.id </span><br><span class="line">	AND sys_user_role.user_id = 1;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">在SysRoleMapper接口中增加一个方法<code>selectRoleByUserId</code></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id查他的权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  List&lt;SysRole&gt;  <span class="title">selectRoleByUserId</span><span class="params">(Long userId)</span></span>;</span><br></pre></td></tr></table></figure>

<p><font color="black">最后在SysUserMapper.xml中增加一个resultMap:<code>userRoleListMap2</code></font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap2"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.selectRoleByUserId"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">"&#123;userId=id&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole2"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap2"</span>&gt;</span></span><br><span class="line">    select sys_user.* from sys_user where sys_user.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="black">在SysUserMapper接口中增加一个方法<code>selectAllUserAndRole2</code>:</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的Id查询他拥有的角色和对应的权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SysUser <span class="title">selectAllUserAndRole2</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure>

<p><font color="black">测试代码：</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">           SysUser user = sum.selectAllUserAndRole2(<span class="number">1002L</span>);</span><br><span class="line">           System.out.println(<span class="string">"-------------------------------------------"</span>);</span><br><span class="line">           System.out.println(<span class="string">"用户名："</span> + user.getUserName());</span><br><span class="line">           <span class="keyword">for</span> (SysRole role : user.getRoleList()) &#123;</span><br><span class="line">               System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">               <span class="keyword">for</span> (SysPrivilege privilege : role.getPrivilegeList()) &#123;</span><br><span class="line">                   System.out.println(<span class="string">"权限："</span> + privilege.getPrivilegeName());</span><br><span class="line">               &#125;</span><br><span class="line">               System.out.println(<span class="string">"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(<span class="string">"-------------------------------------------"</span>);</span><br><span class="line">           log.info(sum);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><font color="black">程寻运行打印的日志:</font></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">785447854</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> ==&gt;  Preparing: select sys_user.* from sys_user where sys_user.id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> &lt;==      Total: <span class="number">1</span></span><br><span class="line">  -------------------------------------------</span><br><span class="line">用户名：admin</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> ==&gt;  Preparing: select sys_role.* from sys_role,sys_user_role where sys_user_role.user_id=sys_role.id and sys_user_role.user_id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> &lt;==      Total: <span class="number">2</span></span><br><span class="line">  角色名：管理员</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> ==&gt;  Preparing: select sys_privilege.* from sys_privilege,sys_role_privilege where sys_role_privilege.privilege_id=sys_privilege.id and sys_role_privilege.role_id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> &lt;==      Total: <span class="number">3</span></span><br><span class="line">  权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">角色名：管理员</span><br><span class="line">权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@<span class="number">63355449</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">785447854</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><font color="black">可以看到，程寻运行时，MyBatis给数据库发了多条sql语句，最终通过预定的映射集合，把这些查出来的数据放进去，之后打包组合成一个<code>List&lt;SysRole&gt;</code>对象返回。</font></p>

</div>




<div>


<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>黄鑫</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/" title="深入理解MyBatis高级结果映射">http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li>
</ul>

</div>

<footer class="post-footer">


<div class="post-tags">
<a href="/tags/MyBatis/" rel="tag"><i class="fa fa-tag"></i> MyBatis</a>

</div>
<div class="post-nav">
<div class="post-nav-next post-nav-item">
<a href="/2019/07/28/MyBatis缓存配置/" rel="next" title="MyBatis缓存配置">
<i class="fa fa-chevron-left"></i> MyBatis缓存配置
</a>

</div>

<span class="post-nav-divider"></span>

<div class="post-nav-prev post-nav-item">
<a href="/2019/07/29/MyBatis集成EhCache缓存框架/" rel="prev" title="MyBatis集成EhCache缓存">
MyBatis集成EhCache缓存 <i class="fa fa-chevron-right"></i>
</a>

</div>
</div>
</footer>
</div>
<span title="post.wordcount">
  5.8k 字
</span>

<span title="post.min2read">
  29 分钟
</span>







</article>

  </div>


          </div>
          


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="黄鑫">
  <p class="site-author-name" itemprop="name">黄鑫</p>
  <div class="site-description motion-element" itemprop="description">Talk is cheap. Show me the code</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0xvdmVySVRlcg==" title="GitHub &rarr; https://github.com/LoverITer"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#搭建实验环境"><span class="nav-number">1.</span> <span class="nav-text">搭建实验环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一对一映射"><span class="nav-number">2.</span> <span class="nav-text">一对一映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一对多映射"><span class="nav-number">3.</span> <span class="nav-text">一对多映射</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
 &copy; 
 <span itemprop="copyrightYear">2019</span> 
 
 <span class="with-love" id="animate">
  <i class="fa fa-heart"></i>
 </span>
<span class="author" itemprop="copyrightHolder">Huangxin</span>
</div>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>



<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("08/01/2019 00:00:00");   //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "网站已运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>

    

  </div>

  
    
    
  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='100' src="/vendors/canvas-nest/canvas-nest.min.js"></script>
  <script size="300" alpha="0.6" zIndex="-1" src="/vendors/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>
  <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>
  <script defer src="/vendors/three/three.min.js"></script>
  <script defer src="/vendors/three/three-waves.min.js"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>


  <script src="/js/exturl.js?v=7.3.0"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  

  

    <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>

  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)

        if(result)$(this).text('复制成功')
        else $(this).text('复制失败')

        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>



  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script>!function(e){var r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){for(var c=0;c<r.length;c++)t=r[c],void 0,0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=r[c];t=o,n=function(){r=r.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}t(),e.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(t,e)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
