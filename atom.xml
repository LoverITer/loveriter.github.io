<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LoveITer</title>
  
  <subtitle>欢迎访问我的个人博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://easyblog.top/"/>
  <updated>2019-08-16T16:52:46.072Z</updated>
  <id>http://easyblog.top/</id>
  
  <author>
    <name>黄鑫</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring和SpringMVC整合</title>
    <link href="http://easyblog.top/2019/08/17/Spring%E5%92%8CSpringMVC%E6%95%B4%E5%90%88/"/>
    <id>http://easyblog.top/2019/08/17/Spring和SpringMVC整合/</id>
    <published>2019-08-16T16:40:01.000Z</published>
    <updated>2019-08-16T16:52:46.072Z</updated>
    
    <content type="html"><![CDATA[<p><font color="black">看到这个标题有些同学有点奇怪，SpringMVC是基于Spring的框架，没有必要整合，关于Spring的IOC和bean在springmvc的配置文件里配置就可以了。如果真的这样，那我们的配置文件就面临着难以维护的致命缺点。<br>  正常来说，我们应该将Spring的容器和SpringMVCc的配置文件分开来，在Spring的容器配置IOC和AOP的相关组件，让他只负责各个bean之间的依赖和横切逻辑，而在SpringMVC的配置文件中只负责handler的配置就完全可以了。 因此所谓的整合，实质上是让Spring和SpringMVC明确分工，各司其职。分工的目的总结来说就是：</font></p><ul> <li><font color="black">Spring配置文件：配置和业务有关的（事务控制、数据源.....）</font></li> <li><font color="black">SpringMVC配置文件：配置和网站转发逻辑和网站功能有关的（视图解析、文件上传、支持ajax.....）</font></li></ul><p><font color="black">好了，废话不多说，下面直接来看看如何把他两有机的整合在一起。</font></p><h4 id="导包"><a href="#导包" class="headerlink" title="导包"></a><font color="green">导包</font></h4><p><font color="black">首先，导入jar包这里使用Maven来管理项目，所需的Maven依赖写法如下:</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.1.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--单元测试--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring start--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Core：spring-core、spring-beans、spring-content、spring-expression--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring核心--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring IOC容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring Bean工厂--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpEL(Spring表达式)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--AOP：spring-aop、spring-aspectj、spring-instrument、spring-instrument-tomcat--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring aop：外部依赖spring-core， (spring-beans，AOP Alliance， CGLIB，Commons Attributes)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--提供对AspectJ的支持，以便可以方便的将面向切面的功能集成进IDE中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aspectj的runtime包(必须)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aspectjweaver是aspectj的织入包(必须)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring Data Access--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring Web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring-mvc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring Test：spring-test--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring End--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Servlet API--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="写配置"><a href="#写配置" class="headerlink" title="写配置"></a><font color="green">写配置</font></h4><h5 id="web-xml的配置"><a href="#web-xml的配置" class="headerlink" title="web.xml的配置"></a><div style="background-color: rgb(0,128,128);width: 100%;line-height: 35px;"><font color="black"><strong>web.xml的配置</strong></font></div></h5><p><font color="black">web.xml应该是整个项目最重要的配置文件了，不过servlet3.0中已经支持注解配置方式了。在servlet3.0以前每个servlet必须要在web.xml中配置servlet及其映射关系。但是在spring框架中就不用了，因为Spring中是依赖注入（Dependency Injection）的也叫控制反转（Inversion of Control）。但是也要配置一个重要的servlet，就是前端控制器（DispatcherServlet）。配置方式与普通的servlet基本相似。</font></p><p><font color="black">配置内容如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置前段控制器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web容器启动的时候就加载SpringMVC--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">springmvc-config.xml是SpringMVC的配置文件，稍后讨论他的配置。</font><br><font color="black">在web.xml中配置Spring容器：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--加载Spring容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">配置监听器：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置监听器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black" style="text-align: left;">注意：如果你的项目里面不使用 WebApplicationContext 就可以不配置listener节点。但是正常情况下，都会配置ContentLoaderListener，具体参考这位老哥的博客：<a href="https://blog.csdn.net/qq_15037231/article/details/78743765。" target="_blank" rel="noopener">https://blog.csdn.net/qq_15037231/article/details/78743765。</a></font></p><p><font color="black">配置字符编码过滤器：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置字符编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">完整的web.xml配置如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置前段控制器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web容器启动的时候就加载SpringMVC--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--加载Spring容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置监听器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置字符编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="springmvc-config-xml的配置"><a href="#springmvc-config-xml的配置" class="headerlink" title="springmvc-config.xml的配置"></a><div style="background-color: rgb(0,128,128);width: 100%;line-height: 35px;"><font color="black"><strong>springmvc-config.xml的配置</strong></font></div></h5><p><font color="black">配置自动扫描：只扫描Controller和ControllerAdvice</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置SpringMVC扫描的范围--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xust.iot"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:include-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.web.bind.annotation.ControllerAdvice"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">注意：当使用&lt; context:component-scan  /&gt;后，就可以将 &lt; context:annotation-config/&gt;移除。</font></p><p><font color="black">配置视图解析器：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"WEB-INF/pages/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">配置全局异常处理器：自己先写一个异常处理的类，然后用@ControllerAdvice标注，有啥异常后面开发的时候再写</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置全局的异常处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exceptionHandler"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.exception.EntireExceptionHandler"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">如果项目中有上传文件的需求，那么还需要配置文件上传解析器，一般使用commons-fileupload来上传文件，需要导入的Maven依赖写法如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--comons-fileupload依赖commons-io,commons-io可以把它看成java IO的加强版--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">文件上传的配置如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*20&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSizePerFile"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*5&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="red">注意：在使用CommonsMultipartResolver时一定要导入commons-fileupload的jar包，否者服务器一启动就会报错。</font></p><p><font color>在上面web.xml中配置的前端控制器拦截了所有的请求，不做特殊处理就会导致部分静态资源无法使用。如果是这种情况就可以使用下面的配置来访问静态资源文件：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置默认对静态文件的处理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><fotn color="black">当然，也可以使用下面的配置方式来处理静态资源：</fotn></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span> <span class="attr">location</span>=<span class="string">"/images/"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span> <span class="attr">location</span>=<span class="string">"/css/"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span> <span class="attr">location</span>=<span class="string">"/js/"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/imgdata/**"</span> <span class="attr">location</span>=<span class="string">"/imgdata/"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">对于静态资源处理如果问题，可以参照这位老哥的博客：<a href="https://www.cnblogs.com/dflmg/p/6393416.html" target="_blank" rel="noopener">https://www.cnblogs.com/dflmg/p/6393416.html</a></font>。</p><p><font color="black">完整的springmvc-config.xml文件的配置如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置SpringMVC扫描的范围--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xust.iot"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:include-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"org.springframework.web.bind.annotation.ControllerAdvice"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置默认对静态文件的处理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mvc的注解驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"WEB-INF/pages/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&amp;lt;!&amp;ndash;文件上传解析器&amp;ndash;&amp;gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*20&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSizePerFile"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*5&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置全局的异常处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exceptionHandler"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.exception.EntireExceptionHandler"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="applicationContext-xml的配置"><a href="#applicationContext-xml的配置" class="headerlink" title="applicationContext.xml的配置"></a><div style="background-color: rgb(0,128,128);width: 100%;line-height: 35px;"><font color="black"><strong>applicationContext.xml的配置</strong></font></div></h5><p><font color="black">配置自动扫描：Spring要扫描的是SpringMVC不扫描的，就是他两扫描的范围互补，因此这里只需要排除SpringMVC扫秒的范围即可。配置如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Spring自动扫描的范围--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xust.iot"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--排除掉SpringMVC扫秒的外，Spring都取扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.web.bind.annotation.ControllerAdvice"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">完整的applicationContext.xml包的配置如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置Spring自动扫描的范围--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xust.iot"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--排除掉SpringMVC扫秒的外，Spring都取扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.web.bind.annotation.ControllerAdvice"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a><font color="green">测试</font></h4><p><font color="black">最后写代码来测试一下</font><br><font color="black">Service层</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.sevice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化UserService......"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello,Spring和SpringMVC整合成功！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">Controller层</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xust.iot.sevice.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化UerController....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,userService.hello());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/oO62Fm17tyiuRgA" target="_blank"><img src="https://i.loli.net/2019/08/16/oO62Fm17tyiuRgA.png"></a></center><p><font color="black">与此同时，控制台的打印的信息如下：</font></p><center><a href="https://sm.ms/image/7SixYhlJGF6UDPc" target="_blank"><img src="https://i.loli.net/2019/08/16/7SixYhlJGF6UDPc.jpg"></a></center><p><font color="black">可以看到，两个类都被注册进了各自应该去的容器中。而且都只初始化了一遍。达到了最初的目的。</font></p><h4 id="Spring与SpringMVC父子容器的关系"><a href="#Spring与SpringMVC父子容器的关系" class="headerlink" title="Spring与SpringMVC父子容器的关系"></a><div style="background-color: rgb(0,128,128);width: 100%;line-height: 35px;"><font color="black"><strong>Spring与SpringMVC父子容器的关系</strong></font></div></h4><p><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;最后，简单的说一下Spring与SpringMVC父子容器的关系</font><br><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;Spring源码中默认规定，当Spring和SpringMVC两个容器共存的时候：</font><br><font color="black">1. Spring和SpringMVC的容器具有父子关系，Spring容器为父容器，SpringMVC为子容器，子容器可以引用父容器中的Bean，而父容器不可以引用子容器中的Bean;</font><br><font color="black">2. Spring容器导入的properties配置文件，只能在Spring容器中用而在SpringMVC容器中不能读取到。 需要在SpringMVC 的配置文件中重新进行导入properties文件，并且同样在父容器Spring中不能被使用，导入后使用@Value(“${key}”)在java类中进行读取。 </font></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;font color=&quot;black&quot;&gt;看到这个标题有些同学有点奇怪，SpringMVC是基于Spring的框架，没有必要整合，关于Spring的IOC和bean在springmvc的配置文件里配置就可以了。如果真的这样，那我们的配置文件就面临着难以维护的致命缺点。&lt;br&gt;
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC异常处理</title>
    <link href="http://easyblog.top/2019/08/15/SpringMVC%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    <id>http://easyblog.top/2019/08/15/SpringMVC异常处理/</id>
    <published>2019-08-15T15:35:59.000Z</published>
    <updated>2019-08-15T16:11:00.149Z</updated>
    
    <content type="html"><![CDATA[<h4 id="重要的接口和类"><a href="#重要的接口和类" class="headerlink" title="重要的接口和类"></a><font color="black">重要的接口和类</font></h4><h5 id="HandlerExceptionResolver"><a href="#HandlerExceptionResolver" class="headerlink" title="HandlerExceptionResolver"></a><font color="black">HandlerExceptionResolver</font></h5><p><font color="black">&nbsp; &nbsp; &nbsp; &nbsp;他是SpringMVC“九大组件”之一,SpringMVC异常处理核心接口。该接口定义了1个解析异常的方法：</font></p><center><a href="https://sm.ms/image/jxXd8YlQ5MkNpyH" target="_blank"><img src="https://i.loli.net/2019/08/15/jxXd8YlQ5MkNpyH.jpg"></a></center><h5 id="ExceptionHandlerExceptionResolver"><a href="#ExceptionHandlerExceptionResolver" class="headerlink" title="ExceptionHandlerExceptionResolver"></a><font color="black">ExceptionHandlerExceptionResolver</font></h5><p><font color="black"> &nbsp; &nbsp; &nbsp; &nbsp;继承自AbstractHandlerMethodExceptionResolver，<font color="red"><strong>该类主要处理Controller中用@ExceptionHandler注解定义的方法。</strong></font></font><font color="black"><strong><font color="red">该类是<code>&lt;annotation-driven/&gt;</code>配置中定义的HandlerExceptionResolver实现类之一，大多数异常处理都是由该类操作。</font></strong></font>　</p><li><font color="black">在Controller中使用@ExceptionHandler</font></li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionHandlerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/handler1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">handler1</span><span class="params">(Model model,@RequestParam(value = <span class="string">"value"</span>,required = <span class="keyword">false</span>)</span> <span class="keyword">int</span> value)</span>&#123;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">10</span>/value;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>,<span class="string">"你好呀！"</span>);</span><br><span class="line">model.addAttribute(<span class="string">"msg1"</span>,<span class="string">"10/"</span>+value+<span class="string">"="</span>);</span><br><span class="line">model.addAttribute(<span class="string">"res"</span>,i);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用<span class="doctag">@ExceptionHandler</span>注解可以告诉SpringMVC这是一个专门处理异常的方法</span></span><br><span class="line"><span class="comment"> * 一个方法可处理多个异常，可以有多个处理异常的类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(ArithmeticException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">exceptionHandler1</span><span class="params">(Exception e, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"在"</span>+<span class="keyword">this</span>.getClass().getName()+<span class="string">"中的异常处理方法"</span>);</span><br><span class="line">ModelAndView mv=<span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>);</span><br><span class="line">mv.addObject(<span class="string">"e"</span>,e);</span><br><span class="line">mv.addObject(<span class="string">"statusCode"</span>,response.getStatus());</span><br><span class="line"><span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">异常后的页面：</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;出错啦&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;出错啦！响应代码：$&#123;status&#125;，错误信息:$&#123;e&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/2kNnAeu8zlpSYq6" target="_blank"><img src="https://i.loli.net/2019/08/15/2kNnAeu8zlpSYq6.gif"></a></center><p><font color="black">&nbsp; &nbsp; &nbsp; &nbsp;像这样在Controller中借助@ExceptionHandler这个注解定义的异常处理方法只能在定义的那个Controller中使用，当Controller类十分多的时候，那么写异常处理方法就是个体力活了，因此SpringMVC就提供了<font size="4"><code>@ControllerAdvice</code></font>这个注解,它只能用在类上，而这个类中的异常处理方法都是全局范围，如下定义一个类专门集中处理异常：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.handleException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(ArithmeticException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleArithmeticException</span><span class="params">(Exception e,HttpServletResponse response)</span></span>&#123;</span><br><span class="line">ModelAndView mv=<span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>);</span><br><span class="line">mv.addObject(<span class="string">"status"</span>, response.getStatus());</span><br><span class="line">mv.addObject(<span class="string">"e"</span>,e);</span><br><span class="line"><span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(NullPointerException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handlerNulPointlException</span><span class="params">(Exception e,HttpServletResponse response)</span></span>&#123;</span><br><span class="line">ModelAndView mv=<span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>);</span><br><span class="line">mv.addObject(<span class="string">"status"</span>, response.getStatus());</span><br><span class="line">mv.addObject(<span class="string">"e"</span>,e);</span><br><span class="line"><span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler</span>(Exception.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handlerException</span><span class="params">(Exception e, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">ModelAndView mv=<span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>);</span><br><span class="line">mv.addObject(<span class="string">"status"</span>, response.getStatus());</span><br><span class="line">mv.addObject(<span class="string">"e"</span>,e);</span><br><span class="line"><span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">一个好的异常处理机制应该是这样的，有一个集中的处理点负责所有的异常处理，在真正的业务逻辑的处理过程中，我只会关心正常的业务流程，一旦遇到异常，我只管抛出对应的异常和相关的信息就行了。</font></p><h5 id="DefaultHandlerExceptionResovler"><a href="#DefaultHandlerExceptionResovler" class="headerlink" title="DefaultHandlerExceptionResovler"></a><font color="black">DefaultHandlerExceptionResovler</font></h5><p><strong><font color="red">&nbsp; &nbsp; &nbsp; &nbsp;HandlerExceptionResolver接口的默认实现之一</font></strong>　，<font color="black">基本上是Spring MVC内部使用，用来处理Spring定义的各种标准异常，将其转化为相对应的HTTP Status Code。其处理的异常类型有：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">handleNoSuchRequestHandlingMethod</span><br><span class="line">handleHttpRequestMethodNotSupported</span><br><span class="line">handleHttpMediaTypeNotSupported</span><br><span class="line">handleMissingServletRequestParameter</span><br><span class="line">handleServletRequestBindingException</span><br><span class="line">handleTypeMismatch</span><br><span class="line">handleHttpMessageNotReadable</span><br><span class="line">handleHttpMessageNotWritable</span><br><span class="line">handleMethodArgumentNotValidException</span><br><span class="line">handleMissingServletRequestParameter</span><br><span class="line">handleMissingServletRequestPartException</span><br><span class="line">handleBindException</span><br></pre></td></tr></table></figure><h5 id="ResponseStatusExceptionResovler"><a href="#ResponseStatusExceptionResovler" class="headerlink" title="ResponseStatusExceptionResovler"></a><font color="black">ResponseStatusExceptionResovler</font></h5><p><font color="black">&nbsp; &nbsp; &nbsp; &nbsp;用来支持@ResponseStatus的使用，处理使用了ResponseStatus注解的异常，根据注解的内容，返回相应的HTTP Status Code和异常页面给客户端。如果Web应用程序中配置了ResponseStatusExceptionResolver，那么我们就可以使用ResponseStatus注解来注解我们自己编写的异常类，并在Controller中抛出该异常类，之后ResponseStatusExceptionResolver就会自动帮我们处理剩下的工作。<strong><font color="red"><code>&lt;annotation-driven/&gt;</code>配置中定义的HandlerExceptionResolver实现类之一。　</font></strong>　<br><font color="black">自定义一个异常</font></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.handleException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseStatus</span>(reason = <span class="string">"用户不存在"</span>,value = HttpStatus.NOT_FOUND)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">另一个自定义异常</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.handleException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseStatus</span>(reason = <span class="string">"输入的登录参数不合法"</span>,value = HttpStatus.BAD_REQUEST)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamterIllegalException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">在Controller中主动抛出这个异常看看效果：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xust.iot.beans.User;</span><br><span class="line"><span class="keyword">import</span> com.xust.iot.handleException.ParamterIllegalException;</span><br><span class="line"><span class="keyword">import</span> com.xust.iot.handleException.UserNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.i18n.SessionLocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/toLogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">checkLogIn</span><span class="params">(@RequestParam(value =<span class="string">"username"</span>,defaultValue = <span class="string">""</span>)</span>String username,Model model) <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">""</span>.equals(username))&#123;</span><br><span class="line">System.out.println(<span class="string">"用户登录失败"</span>);</span><br><span class="line"><span class="keyword">throw</span>  <span class="keyword">new</span> ParamaterIllegalException();</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="string">"admin"</span>.equals(username))&#123;</span><br><span class="line">System.out.println(<span class="string">"用户登录失败"</span>);</span><br><span class="line"><span class="keyword">throw</span>  <span class="keyword">new</span> UserNotFoundException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>,<span class="string">"欢迎你"</span>+username+<span class="string">",现在是北京时间："</span>+<span class="keyword">new</span> SimpleDateFormat(<span class="string">"hh:mm:ss"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line">System.out.println(<span class="string">"用户登录成功"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/Xa1t8Ejl7sxpCiV" target="_blank"><img src="https://i.loli.net/2019/08/15/Xa1t8Ejl7sxpCiV.gif"></a></center><p><font color="blcal">ExceptionHandlerExceptionResolver、DefaultHandlerExceptionResolver和ResponseStatusExceptionResolver这三个类是<font size="4"><strong><code>&lt;mvc:annotation-driver&gt;</code></strong></font>配置后默认的3个实现类，他们的优先级是按书写的顺序由高到底。</font></p><h5 id="SimpleMappingExceptionResovler"><a href="#SimpleMappingExceptionResovler" class="headerlink" title="SimpleMappingExceptionResovler"></a><font color="black">SimpleMappingExceptionResovler</font></h5><p><font color="black">提供了将异常映射为视图的能力，高度可定制化。其提供的能力有：</font></p><ol><li><font color="black">根据异常的类型，将异常映射到视图；</font></li><li><font color="black">可以为不符合处理条件没有被处理的异常，指定一个默认的错误返回；</font></li><li><font color="black">处理异常时，记录log信息；</font></li><li><font color="black">指定需要添加到Modle中的Exception属性，从而在视图中展示该属性。</font><br><font color="black">在Springmvc配置文件中配置SimpleMappingExceptionResovler</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在props标签中配置所有异常后对应的页面,其中:</span></span><br><span class="line"><span class="comment">key表示异常，应该写异常的全类名</span></span><br><span class="line"><span class="comment">&lt;prop&gt;标签体写该异常映射的视图名，只写视图名即可，SpringMVC的视图处理器会自动拼串</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"java.lang.NullPointerException"</span> &gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定取出错误信息的key--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionAttribute"</span> <span class="attr">value</span>=<span class="string">"ex"</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><font color="black">这样，我们把SimpleMappingExceptionResolver配置好了，这个类在配置的时候还有很多的属性可以配置，如下:</font></p><center><a href="https://sm.ms/image/p5PW3qmwVovr7Ih" target="_blank"><img src="https://i.loli.net/2019/08/16/p5PW3qmwVovr7Ih.png"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;重要的接口和类&quot;&gt;&lt;a href=&quot;#重要的接口和类&quot; class=&quot;headerlink&quot; title=&quot;重要的接口和类&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;重要的接口和类&lt;/font&gt;&lt;/h4&gt;&lt;h5 id=&quot;HandlerExceptionRe
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC资源国际化</title>
    <link href="http://easyblog.top/2019/08/15/SpringMVC%E8%B5%84%E6%BA%90%E5%9B%BD%E9%99%85%E5%8C%96/"/>
    <id>http://easyblog.top/2019/08/15/SpringMVC资源国际化/</id>
    <published>2019-08-15T06:13:39.000Z</published>
    <updated>2019-08-15T06:21:10.210Z</updated>
    
    <content type="html"><![CDATA[<h4 id="国际化开发概述"><a href="#国际化开发概述" class="headerlink" title="国际化开发概述"></a><font color="black">国际化开发概述</font></h4><p><font color="black">软件的国际化：软件开发时，要使它能同时应对世界不同地区和国家的访问，并针对不同地区和国家的访问，提供相应的、符合来访者阅读习惯的页面或数据。</font><br><font color="black">国际化(internationalization)又称为 i18n(读法为i 18 n，据说是因为internationalization(国际化)这个单词从i到n之间有18个英文字母，i18n的名字由此而来)</font></p><h4 id="国际化的基本规则"><a href="#国际化的基本规则" class="headerlink" title="国际化的基本规则"></a><font color="black">国际化的基本规则</font></h4><p><font color="black">国际化信息”也称为“本地化信息”，一般需要两个条件才可以确定一个特定类型的本地化信息，它们分别是<code>“语言类型”</code>和<code>“国家/地区的类型”</code>。如中文本地化信息既有中国大陆地区的中文，又有中国台湾、中国香港地区的中文，还有新加坡地区的中文。Java通过<code>java.util.Locale</code>类表示一个本地化对象，它允许通过语言参数和国家/地区参数创建一个确定的本地化对象。</font></p><p><font color="black"><code>语言参数</code>使用ISO标准语言代码表示，这些代码是由ISO-639标准定义的，每一种语言由两个小写字母表示。在许多网站上都可以找到这些代码的完整列表，下面的网址是提供了标准语言代码的信息：<a href="http://www.loc.gov/standards/iso639-2/php/English_list.php。" target="_blank" rel="noopener">http://www.loc.gov/standards/iso639-2/php/English_list.php。</a></font></p><p><font color="black"><code>国家/地区参数</code>也由标准的ISO国家/地区代码表示，这些代码是由ISO-3166标准定义的，每个国家/地区由两个大写字母表示。用户可以从以下网址查看ISO-3166的标准代码：<br><a href="http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html。下面是常用的国家/地区语言参数：" target="_blank" rel="noopener">http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html。下面是常用的国家/地区语言参数：</a></font></p><center><a href="https://sm.ms/image/OEKzenjBUhvIGDq" target="_blank"><img src="https://i.loli.net/2019/08/14/OEKzenjBUhvIGDq.png"></a></center><h4 id="实现一个简单的国际化"><a href="#实现一个简单的国际化" class="headerlink" title="实现一个简单的国际化"></a><font color="black">实现一个简单的国际化</font></h4><p><font color="black"><strong>编写国际化资源文件</strong></font><br><font color="black">国际化资源文件就是用一种key-value的形式把要显示的信息的不同语言的翻译版本写到properties资源文件中：</font><br><font color="black">针对美式英文的资源文件：</font></p><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">login_en_US.properties:</span><br><span class="line">welcomeInfo=Welcome to my personal blog LoveITer</span><br><span class="line">username=USERNAME</span><br><span class="line">password=PASSWORD</span><br><span class="line">loginbtn=LOGIN</span><br><span class="line">placeholder_username=please input username</span><br><span class="line">placeholder_password=please input password</span><br></pre></td></tr></table></figure><p><font color="black">针对简体中文的资源文件：</font></p><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">login_zh_CN.properties</span><br><span class="line">welcomeInfo=欢迎访问我的个人博客LoveITer</span><br><span class="line">username=用户名</span><br><span class="line">password=密码</span><br><span class="line">loginbtn=登录</span><br><span class="line">placeholder_username=请输入用户名</span><br><span class="line">placeholder_password=请输入密码</span><br></pre></td></tr></table></figure><p><font color="black"><strong>注意</strong>：一般情况下我们用<em>._zh_CN.properties表示中文资源文件，</em>.properties表示默认的资源文件。</font></p><p><font color="black">在springmvc配置文件中简单的配置一下，把我们的资源文件交给SpringMVC管理</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--配置国际化资源文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basename"</span> <span class="attr">value</span>=<span class="string">"login"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">编写一个用户登录表单</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"fmt"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;&lt;fmt:message key="welcomeInfo"/&gt;&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">"checkLogin"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;fmt:message key="username"/&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="text" placeholder="&lt;fmt:message key='placeholder_username'/&gt;"/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;fmt:message key="password"/&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="password" placeholder="&lt;fmt:message key='placeholder_password'/&gt;"/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;input type="submit" value="&lt;fmt:message key="loginbtn"/&gt;"/&gt;&lt;/th&gt;&lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">上面的代码中用到了JSTL中的fmt标签<code>&lt;fmt:message&gt;</code>,因此需要导入对应的jar包。</font></p><p><font color="black">测试结果：</font><br><font color="black">我的浏览器默认就是中文，因此显示的就是中文的欢迎信息：</font></p><center><a href="https://sm.ms/image/onXUtpvw8FaiBGf" target="_blank"><img src="https://i.loli.net/2019/08/15/onXUtpvw8FaiBGf.png" width="100%"></a></center><p><font color="black">在火狐浏览器中手动更改语言为英文</font></p><center><a href="https://sm.ms/image/3T5rv9XfGpOkn4W" target="_blank"><img src="https://i.loli.net/2019/08/15/3T5rv9XfGpOkn4W.png" width="100%"></a></center><font color="black">英文环境下就显示的是英文信息：</font><center><a href="https://sm.ms/image/Zwn9L4dFO7b3HIV" target="_blank"><img src="https://i.loli.net/2019/08/15/Zwn9L4dFO7b3HIV.png" width="100%"></a></center><h4 id="资源文件的编码问题"><a href="#资源文件的编码问题" class="headerlink" title="资源文件的编码问题"></a><font color="black">资源文件的编码问题</font></h4><p><font color="black">一般我们采用properties文件来保存资源文件。properties文件是以key-value的形式来保存文件的。login_zh_CN.properties中保存的是经过utf-8编码字后的ASCII字符，Unicode字符中不允许出现中文、日文等其他字符的文字。但是Unicode编码后的文字阅读起来比较困难，在IDEA中，可以在<code>File-&gt;Settings-&gt;Editor-&gt;File Encodings</code>设置中勾选Transparent native-to-ascii conversion,如下图，设置好后点击<code>Apply</code>,然后回到刚才编写的中文资源文件发现中文字符全部乱码了，这时可以在编辑器中直接重新输入中文。虽然我们输入的是中文，但是IDEA已经帮我们做了中文转码。</font></p><center><a href="https://sm.ms/image/rL3PEOA46JomWdF" target="_blank"><img src="https://i.loli.net/2019/08/15/rL3PEOA46JomWdF.png"></a></center><h4 id="在程序中获取国际化信息"><a href="#在程序中获取国际化信息" class="headerlink" title="在程序中获取国际化信息"></a><font color="black">在程序中获取国际化信息</font></h4><p><font color="black">在程序中我们可以通过<code>ResourceBundleMessageSource</code>来获取资源文件的信息：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringMVC会自动把locale信息注入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> locale</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/toLogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">logIn</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">System.out.println(locale);</span><br><span class="line">String welcomeInfo=messageSource.getMessage(<span class="string">"welcomeInfo"</span>,<span class="keyword">null</span>,locale);</span><br><span class="line">String userName=messageSource.getMessage(<span class="string">"username"</span>,<span class="keyword">null</span>,locale);</span><br><span class="line">String password=messageSource.getMessage(<span class="string">"password"</span>,<span class="keyword">null</span>,locale);</span><br><span class="line">System.out.println(welcomeInfo+<span class="string">"----"</span>+userName+<span class="string">"----"</span>+password);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">执行结果：<br>可以看到在不同对语言环境下使用了不同的资源文件。<br></font></p><center><a href="https://sm.ms/image/vjeuX7Rf9AbY4yP" target="_blank"><img src="https://i.loli.net/2019/08/15/vjeuX7Rf9AbY4yP.png"></a></center><h4 id="自定义区域信息解析器"><a href="#自定义区域信息解析器" class="headerlink" title="自定义区域信息解析器"></a><font color="black">自定义区域信息解析器</font></h4><p><font color="black">3个步骤：<br>1、写一个类实现LocaleResolver接口或他的子接口或继承他的实现类，最主要是要实现它的resolveLocale方法<br>2、在springmvc的配置文件中把我们写的区域信息解析器注册给SpringMVC<br>3、启动测试<br></font><br><font color="black" size="4">写一个类实现LocalResolver接口</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.LocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.core.Local;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析locale信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Locale locale=<span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//通过请求解析请求参数中的locale来让用户可以根据自己的习惯选择语言</span></span><br><span class="line">String localeStr=<span class="keyword">null</span>!=request.getParameter(<span class="string">"locale"</span>)?request.getParameter(<span class="string">"locale"</span>):<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="string">""</span>.equals(localeStr))&#123;</span><br><span class="line">locale=<span class="keyword">new</span> Locale(localeStr.split(<span class="string">"_"</span>)[<span class="number">0</span>],localeStr.split(<span class="string">"_"</span>)[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">locale=request.getLocale();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> locale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black" size="4">配置自定义的解析器</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自定义区域信息解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeResolver"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.LocaleResolver.MyLocaleResolver"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><font color="red">注意：解析器的id必须是<code>localeResolver</code>，如果写错了就没有效果了。至于为啥非要这么写请参考SpringMVC源码中的DispatcherServlet这个类。</font></p><p><font color="black">在页面中加入可以切换语言的链接：</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"fmt"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;&lt;fmt:message key="welcomeInfo"/&gt;&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">"checkLogin"</span> method=<span class="string">"post"</span> &gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;fmt:message key="username"/&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="text" placeholder="&lt;fmt:message key='placeholder_username'/&gt;"/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;fmt:message key="password"/&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="password" placeholder="&lt;fmt:message key='placeholder_password'/&gt;"/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;&lt;th&gt;&lt;input type="submit" value="&lt;fmt:message key="loginbtn"/&gt;"/&gt;&lt;/th&gt;&lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;a href="toLogin?locale=zh_CN"&gt;&lt;fmt:message key="Chinese"/&gt;&lt;/a&gt;|</span><br><span class="line">&lt;a href="toLogin?locale=en_US"&gt;&lt;fmt:message key="English"/&gt;&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black" size="4">测试结果：</font></p><center><a href="https://sm.ms/image/y8rxVJRsvbPdHzT" target="_blank"><img src="https://i.loli.net/2019/08/15/y8rxVJRsvbPdHzT.gif"></a></center><h4 id="SessionLocaleResolver"><a href="#SessionLocaleResolver" class="headerlink" title="SessionLocaleResolver"></a>SessionLocaleResolver</h4><center><a href="https://sm.ms/image/jY7ROzmpK6y8WPw" target="_blank"><img src="https://i.loli.net/2019/08/15/jY7ROzmpK6y8WPw.png" width="100%"></a></center><font color="black">从SpringMVC的区域信息的继承图中我么看到了几个特别的区域信息解析器：</font><font color="black">1、AcceptHeaderLocaleResolver：它是SpringMVC默认装配的区域信息解析器，他会默认从 accept-language请求头信息进行解析处理，通常这个头信息包含客户端操作信息的本地标示。它不支持通过链接的方式改变locale信息。2、FixedLocaleResolver：从字面意思就可以知道，这也是一个不支持通过链接的方式改变locale信息的一个解析器，它默认会从操作系统拿locale信息。3、SessionocaleResolver：从session中拿locale信息，允许设置区域信息。4、CookieLocaleResolver：从Cookie中拿locale信息，允许设置区域信息。</font><font color="black">下面我们借助SessionLocaleResolver来实现我们上面自定义区域信息解析器的功能：</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.i18n.SessionLocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/toLogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">logIn</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@RequestParam(value = <span class="string">"locale"</span>,defaultValue = <span class="string">"zh_CN"</span>)</span> String localeStr,</span></span><br><span class="line"><span class="function">Model model,</span></span><br><span class="line"><span class="function">Locale locale,</span></span><br><span class="line"><span class="function">HttpSession session) </span>&#123;</span><br><span class="line"></span><br><span class="line">Locale l=<span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span>!=localeStr&amp;&amp;!<span class="string">""</span>.equals(localeStr))&#123;</span><br><span class="line">   l=<span class="keyword">new</span> Locale(localeStr.split(<span class="string">"_"</span>)[<span class="number">0</span>],localeStr.split(<span class="string">"_"</span>)[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">l=locale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session.setAttribute(SessionLocaleResolver.class.getName() + <span class="string">".LOCALE"</span>,l);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/F38VxtCSmLf27Oi" target="_blank"><img src="https://i.loli.net/2019/08/15/F38VxtCSmLf27Oi.gif"></a></center><h4 id="使用LocaleChangeInterceptor"><a href="#使用LocaleChangeInterceptor" class="headerlink" title="使用LocaleChangeInterceptor"></a><font color="black">使用LocaleChangeInterceptor</font></h4><p><font color="black">通过配置LocaleChangeInterceptor，我们可以动态改变本地语言。它会检测请求中的参数并且改变地区信息。它调用LoacalResolver.setLocal()进行配置。</font></p><center><a href="https://sm.ms/image/a6HbmM9oYiQ3PfJ" target="_blank"><img src="https://i.loli.net/2019/08/15/a6HbmM9oYiQ3PfJ.png"></a></center><font color="black">既然是拦截器，要使用他就需要在springmvc配置文件中配置它，配置也很简单：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeChangeInterceptor"</span>  <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">然后在配合SessionLocaleResovler，实现动态的改变本地信息</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SessionLocaleResolver--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--资源国际化拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeChangeInterceptor"</span>  <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">控制器层的代码瞬间变得极其简练，就一个跳转页面对返回语句</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/toLogin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">logIn</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font>测试结果：</font></p><center><a href="https://sm.ms/image/BDtboiLIyTeFnVA" target="_blank"><img src="https://i.loli.net/2019/08/15/BDtboiLIyTeFnVA.gif"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;国际化开发概述&quot;&gt;&lt;a href=&quot;#国际化开发概述&quot; class=&quot;headerlink&quot; title=&quot;国际化开发概述&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;国际化开发概述&lt;/font&gt;&lt;/h4&gt;&lt;p&gt;&lt;font color=&quot;black&quot;&gt;软件的
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC拦截器</title>
    <link href="http://easyblog.top/2019/08/14/SpringMVC%E6%8B%A6%E6%88%AA%E5%99%A8(Interceptor)/"/>
    <id>http://easyblog.top/2019/08/14/SpringMVC拦截器(Interceptor)/</id>
    <published>2019-08-14T10:13:01.000Z</published>
    <updated>2019-08-16T06:30:10.391Z</updated>
    
    <content type="html"><![CDATA[<h4 id="拦截器概述"><a href="#拦截器概述" class="headerlink" title="拦截器概述"></a><font color="black">拦截器概述</font></h4><p><font color="black">什么是拦截器？</font><br><font color="black">Spring MVC中的拦截器（Interceptor）类似于Servlet中的过滤器（Filter），但是比过滤器的功能更加强大，它主要用于拦截用户请求并作相应的处理。例如通过拦截器可以进行权限验证、记录请求信息的日志、判断用户是否登录等。</font><br><font color="black">要使用Spring MVC中的拦截器，就需要对拦截器类进行定义和配置。通常拦截器类可以通过两种方式来定义：</font><br><font color="black">1.通过实现HandlerInterceptor接口，或继承HandlerInterceptor接口的实现类（如HandlerInterceptorAdapter）来定义。</font></p><p><font color="black">2.通过实现WebRequestInterceptor接口，或继承WebRequestInterceptor接口的实现类来定义。</font></p><center><a href="https://sm.ms/image/D5K69WRPH3j1fry" target="_blank"><img src="https://i.loli.net/2019/08/14/D5K69WRPH3j1fry.png"></a></center>#### <font color="black">实现第一个拦截器</font><font color="black">以实现HandlerInterceptor接口方式为例，自定义拦截器类的代码如下：</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirstInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">   System.out.println(<span class="string">"1.执行目标方法之前......"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回true表示放行，可以去执行目标方法，否者表示不允许执行目标方法</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"3.执行目标方法之后......"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> System.out.println(<span class="string">"5.来到页面之后......"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">上述代码中，自定义拦截器实现了HandlerInterceptor接口，并实现了接口中的三个方法：</font></p><ul><li><font color="black">preHandle()：在目标方法执行之前回执行，有个boolean类型的返回值，当返回true表示放行，即允许执行目标方法;当返回false，表示不放行，即不运行执行目标方法，此时会中断以后的所有过程</font></li><li><font color="black">postHandle()：在目标方法执行结束后会执行，且解析视图之前执行</font></li><li><font color="black">afterCompletion()：在请求到达页面，即视图渲染完成后执行</font></li></ul><p><font color="black">开发拦截器就像开发servlet或者filter一样，都需要在配置文件进行配置，配置代码如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这样配置的拦截器默认拦截所有请求--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.interceptor.MyFirstInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面的代码中，<code>&lt;mvc:interceptors&gt;</code>元素用于配置一组拦截器，子元素<code>&lt;bean&gt;</code>中定义的是全局拦截器，它会拦截所有的请求；而也可以使用<code>&lt;mvc:interceptor&gt;</code>元素中定义指定路径的拦截器，它会对指定路径下的请求生效。<code>&lt;mvc:interceptor&gt;</code>元素的子元素<code>&lt;mvc:mapping&gt;</code>用于配置拦截器作用的路径，该路径在其属性path 中定义。如果在请求路径中包含不需要拦截的内容，还可以通过<code>&lt;mvc:exclude-mapping&gt;</code>元素进行配置。<br><font color="black">注意：<code>&lt;mvc:interceptor&gt;</code>中的子元素必须按照上述代码中的配置顺序进行编写，即<code>&lt;mvc:mapping&gt; &lt;mvc:exclude-mapping&gt; &lt;bean&gt;</code>，否则文件会报错。<font></font></font></p><p><font color="black">下面写一个控制器来测试一下正常情况下单个拦截器的工作流程：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntercrtorTestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/test01"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">handler01</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"2.执行了目标方法......"</span>);</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>,<span class="string">"你好啊！！!"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">目标页面success.jsp</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;成功&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">  System.out.println(<span class="string">"4.来到了success.jsp页面"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">$&#123;msg&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果</font></p><center><a href="https://sm.ms/image/Va7LdD1r8BeoH4C" target="_blank"><img src="https://i.loli.net/2019/08/14/Va7LdD1r8BeoH4C.gif"></a></center><font color="black"><strong></strong></font><h5 id="单个拦截器正常情况下的工作流程："><a href="#单个拦截器正常情况下的工作流程：" class="headerlink" title="单个拦截器正常情况下的工作流程："></a><font color="red"><strong>单个拦截器正常情况下的工作流程：</strong></font></h5><font color="black">1. 拦截器preHandle方法执行，返回true继续以后的过程<br>2. 控制器目标方法执行<br>3. 拦截器postHandle方法执行<br>4. 页面渲染完成来到页面<br>5. 拦截器afterCompletion方法执行<br><center><a href="https://sm.ms/image/sB1Dn4yjaUIVp2W" target="_blank"><img src="https://i.loli.net/2019/08/14/sB1Dn4yjaUIVp2W.png"></a></center></font><h5 id="单个拦截器非正常情况下的工作流程："><a href="#单个拦截器非正常情况下的工作流程：" class="headerlink" title="单个拦截器非正常情况下的工作流程："></a><font color="red"><strong>单个拦截器非正常情况下的工作流程：</strong></font></h5><p><font color="black">单个拦截器的非正常情况分为两种情况：<br>&nbsp;&nbsp;&nbsp;&nbsp;1、拦截器中的preHandler方法返回false;<br>&nbsp;&nbsp;&nbsp;&nbsp;2、虽然preHandler方法返回了true，但是其中有一个过程“炸了”，比如发生了异常没有处理<br>接下来通过代码来测试：</font></p><ul><li><font color="black">第一种情况：preHandler返回false</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirstInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">   System.out.println(<span class="string">"1.执行目标方法之前......"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回true表示放行，可以去执行目标方法，否者表示不允许执行目标方法</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"3.执行目标方法之后......"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> System.out.println(<span class="string">"5.来到页面之后......"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><font color="black">测试结果：</font><br><cneter><a href="https://sm.ms/image/HseDg67ObpnWxC5" target="_blank"><img src="https://i.loli.net/2019/08/14/HseDg67ObpnWxC5.png"></a><br><font color="black">可以看到，后面的过程直接无法执行</font></cneter></p><ul><li><font color="black">第二种情况：preHandle方法放行了，但是有一个过程“炸了”,比如我们在控制器目标方法中制造一个异常：</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntercrtorTestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/test01"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">handler01</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">30</span>/<span class="number">0</span>;</span><br><span class="line">    System.out.println(<span class="string">"2.执行了目标方法......"</span>);</span><br><span class="line">    model.addAttribute(<span class="string">"msg"</span>,<span class="string">"你好啊！！!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/rIp9CMxNjyzHl18" target="_blank"><img src="https://i.loli.net/2019/08/14/rIp9CMxNjyzHl18.png"></a></center><font color="black">可以看到，只要拦截器的prehandle方法放行了，拦截器的afterCompletion方法总会执行/font><h5 id="多个拦截器正常情况下的工作流程："><a href="#多个拦截器正常情况下的工作流程：" class="headerlink" title="多个拦截器正常情况下的工作流程："></a><font color="red"><strong>多个拦截器正常情况下的工作流程：</strong></font></h5><p><font color="black">第二个拦截器：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xust.iot.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySecondInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"1.执行目标方法之前......MySecondInterceptor"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"3.执行目标方法之后......MySecondInterceptor"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"5.来到页面之后......MySecondInterceptor"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">配置第二个拦截器</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--拦截器1--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这样配置的拦截器默认拦截所有请求--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.interceptor.MyFirstInterceptor"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--拦截器2--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用&lt;mvc:interceptor&gt;可以具体配置拦截器拦截那些请求&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/test01"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">"com.xust.iot.interceptor.MySecondInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">执行结果：</font></p><center><a href="https://sm.ms/image/oHbh2ZDez5SMA9L" target="_blank"><img src="https://i.loli.net/2019/08/14/oHbh2ZDez5SMA9L.png"></a></center><p><font color="black">交换拦截器在springmvc配置文件中的定义顺序：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--拦截器2--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用&lt;mvc:interceptor&gt;可以具体配置拦截器拦截那些请求&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/test01"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">"com.xust.iot.interceptor.MySecondInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!--拦截器1--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这样配置的拦截器默认拦截所有请求--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.xust.iot.interceptor.MyFirstInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">执行结果：</font></p><center><a href="https://sm.ms/image/ztTcuoC5vDSd2XA" target="_blank"><img src="https://i.loli.net/2019/08/14/ztTcuoC5vDSd2XA.png"></a></center><p><font color="black">测试结果表明：</font></p><ul><li><font color="black">多个拦截器是有执行的先后顺序的，这个顺序就是定义的先后顺序</font></li><li><font color="black">拦截器的preHandle方法：按照定义顺序顺序执行的</font></li><li><font color="black">拦截器的postHandle方法：按照定义顺序逆序执行的</font></li><li><font color="black">拦截器的preHandle方法：按照定义顺序顺逆序执行的</font></li></ul><h5 id="多个拦截器非正常情况下的工作流程："><a href="#多个拦截器非正常情况下的工作流程：" class="headerlink" title="多个拦截器非正常情况下的工作流程："></a><font color="red"><strong>多个拦截器非正常情况下的工作流程：</strong></font></h5><p><font color="black">1、一个拦截器的preHandle方法返回false的情况：</font></p><center><a href="https://sm.ms/image/RP6drFkEiH5l9Aw" target="_blank"><img src="https://i.loli.net/2019/08/14/RP6drFkEiH5l9Aw.png"></a></center><font color="black">2、所有拦截器的preHandle方法都返回true,但是中间有过程发生了异常：</font><center><a href="https://sm.ms/image/6lL9NUQZFJ5j4mA" target="_blank"><img src="https://i.loli.net/2019/08/14/6lL9NUQZFJ5j4mA.png"></a></center><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a><font color="red" size="5"><strong>小结<strong></strong></strong></font></h4><h5 id="单拦截器的执行顺序"><a href="#单拦截器的执行顺序" class="headerlink" title="单拦截器的执行顺序"></a><font color="black" size="4">单拦截器的执行顺序</font></h5><center><a href="https://sm.ms/image/3zhVr5vL8P9BpeX" target="_blank"><img src="https://i.loli.net/2019/08/14/3zhVr5vL8P9BpeX.jpg" width="100%"></a></center><font color="black">正常情况下会按照：preHandle--->目标方法--->postHnadle--->页面渲染--->afterCompetion执行</font><font color="black">当preHandle返回false,就没有以后流程的事儿了</font><font color="black">当preHandler返回了true,但是中间过程发生异常，会直接结束以后的流程但是afterCompetion总会执行</font><h5 id="多个拦截器的执行顺序"><a href="#多个拦截器的执行顺序" class="headerlink" title="多个拦截器的执行顺序"></a><font color="black" size="4">多个拦截器的执行顺序</font></h5><p><font color="black"><strong>正常情况</strong></font></p><center><a href="https://sm.ms/image/UtwLWDAGilcXm7V" target="_blank"><img src="https://i.loli.net/2019/08/14/UtwLWDAGilcXm7V.png" width="100%"></a></center><font color="black">会按照配置中定义的顺序顺序执行所有拦截器的preHandle方法，然后执行控制器中目标方法，之后按照定义顺序的逆序执行postHandle方法，然后渲染页面，最后按照定义的顺序的逆序执行afterComprtion方法</font><br><font color="black"><strong>有拦截器返回false</strong></font><center><a href="https://sm.ms/image/ZUe2DxdOlHs3VY5" target="_blank"><img src="https://i.loli.net/2019/08/14/ZUe2DxdOlHs3VY5.jpg"></a></center><font color="black">在多个拦截器中只要有一个拦截器的preHandle方法返回了false,那么以后的流程都没有了，会直接回按照这些拦截器配置的定义顺序的逆序执行afterCompetion方法</font></font>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;拦截器概述&quot;&gt;&lt;a href=&quot;#拦截器概述&quot; class=&quot;headerlink&quot; title=&quot;拦截器概述&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;拦截器概述&lt;/font&gt;&lt;/h4&gt;&lt;p&gt;&lt;font color=&quot;black&quot;&gt;什么是拦截器？&lt;/fo
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC文件下载和上传</title>
    <link href="http://easyblog.top/2019/08/13/SpringMVC%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%92%8C%E4%B8%8A%E4%BC%A0/"/>
    <id>http://easyblog.top/2019/08/13/SpringMVC文件下载和上传/</id>
    <published>2019-08-13T14:33:06.000Z</published>
    <updated>2019-08-13T16:12:19.120Z</updated>
    
    <content type="html"><![CDATA[<h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><p><font color="black">文件下载的最重要的一点是设置响应头的<code>Content-disposition</code>为<code>attachmen;filename=要下载的文件的名字</code>,然后得到文件的输入流写入本地即可</font><br><font color="black">1. 常规方法</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第一种文件下载的方法：使用原生的Servlet API</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filename 下载的文件名，SpringMVC会根据请求参数自动注入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/download1"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(@ResuestParam(<span class="string">"filename"</span>)</span>String fileName, </span></span><br><span class="line"><span class="function">HttpServletRequest request, HttpServletResponse response) <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line"></span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line"><span class="comment">//解析文件在服务器中的真实路径</span></span><br><span class="line">String filePath = request.getServletContext().getRealPath(<span class="string">"/download/"</span> + fileName);</span><br><span class="line"><span class="comment">//System.out.println(filePath);</span></span><br><span class="line"></span><br><span class="line">BufferedInputStream bis = <span class="keyword">null</span>;</span><br><span class="line">BufferedOutputStream bos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置响应头告诉客户端浏览器，这个请求是要下载文件</span></span><br><span class="line"><span class="keyword">long</span> fileLength = <span class="keyword">new</span> File(filePath).length();</span><br><span class="line">response.setContentType(<span class="string">"application/x-msdownload;"</span>);</span><br><span class="line">response.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment;filename="</span> + fileName);</span><br><span class="line">response.setHeader(<span class="string">"Content-Length"</span>, String.valueOf(fileLength));</span><br><span class="line"></span><br><span class="line"><span class="comment">//向客户端浏览器写文件数据</span></span><br><span class="line">bis = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(filePath));</span><br><span class="line">bos = <span class="keyword">new</span> BufferedOutputStream(response.getOutputStream());</span><br><span class="line"><span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line"><span class="keyword">while</span> (-<span class="number">1</span> != (len = bis.read(buff, <span class="number">0</span>, buff.length))) &#123;</span><br><span class="line">bos.write(buff, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != bis) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">bis.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != bos) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">bos.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">2. 使用SpringMVC提供的 ResponseEntity&lt;T&gt;类型，使用它可以很方便地定义返回的HttpHeaders和HttpStatus。</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *第二种文件下载的方式：使用SpringMVC提供的esponseEntity类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filename   下载的文件的名字，通过前端页面的请求参数带过来后SpringMVC会自动注入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/download2"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; download(String filename, HttpServletRequest request) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">System.out.println(filename);</span><br><span class="line"><span class="comment">//得到文件在服务器上的真实物理路径</span></span><br><span class="line">String filePath = request.getServletContext().getRealPath(<span class="string">"/download/"</span> + filename);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 两个把下载文件转成byte[]的办法：一种是把要下载的文件封装成一个File对象，把这个对象交给FileCopyUtils.copyToByteArray(file)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 另一种方法是：自己写一个转换的方法，如下</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*FileInputStream fis = new FileInputStream(filePath);</span></span><br><span class="line"><span class="comment">byte[] file = new byte[fis.available()];</span></span><br><span class="line"><span class="comment">fis.read();</span></span><br><span class="line"><span class="comment">fis.close();*/</span></span><br><span class="line"></span><br><span class="line">String downFileName = <span class="keyword">new</span> String(filename.getBytes(<span class="string">"utf-8"</span>), <span class="string">"iso-8859-1"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line"><span class="comment">//这是文件下载关键:设置contentDisposition为attachment</span></span><br><span class="line">headers.setContentDispositionFormData(<span class="string">"attachment"</span>, downFileName);</span><br><span class="line">headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt;(FileCopyUtils.copyToByteArray(file), headers, HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">下载页面</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">pageContext.setAttribute(<span class="string">"ctp"</span>,request.getContextPath());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;下载高清图片&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;高清壁纸下载&lt;/h2&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/18.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=18.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=18.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/13.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=13.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=13.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/14.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=14.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=14.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/15.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=15.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=15.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/16.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=16.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=16.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;th&gt;</span><br><span class="line">&lt;img src=<span class="string">"../..$&#123;ctp&#125;/download/17.jpg"</span> width=<span class="string">"420px"</span> height=<span class="string">"320px"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download1?filename=17.jpg"&gt;使用Servlet API下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;button&gt;&lt;a href="download2?filename=17.jpg"&gt;使用SpringMVC框架下载&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果</font></p><center><a href="https://sm.ms/image/JEgOqwfbFTs1eXx" target="_blank"><img src="https://i.loli.net/2019/08/13/JEgOqwfbFTs1eXx.gif" width="100%"></a></center><h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>文件上传这里使用的是<code>commons-fileupload-1.4</code>,他需要依赖<code>commons-io</code>,他们的Maven依赖如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">1. 单文件上传</font><br><font color="black"><li>上传表单页面</li></font><br><font color="black">文件上传需要将表单的提交方法设置为post，将enctype的值设置为”multipart/form-data”。</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--单文件上传--&gt;</span><br><span class="line">&lt;h3&gt;单文件上传&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">"$&#123;ctp&#125;/uploadImg"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    头像： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;button type="submit"&gt;提交&lt;/button&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p><font color="black"><li>控制器</li></font><br><font color="black">在Controller的处理方法中，使用MultipartFile对象作为参数接收前端上传过来的文件</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单个文件上传</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/uploadImg"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">ImgUpload</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@RequestParam(<span class="string">"username"</span>)</span> String userName,</span></span><br><span class="line"><span class="function">@<span class="title">RequestParam</span><span class="params">(<span class="string">"headerImg"</span>)</span> MultipartFile file,</span></span><br><span class="line"><span class="function">HttpServletRequest request,</span></span><br><span class="line"><span class="function">Model model) </span>&#123;</span><br><span class="line"></span><br><span class="line">String date = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//得到服务器上传文件的文件夹物理路径</span></span><br><span class="line">String realPath = request.getServletContext().getRealPath(<span class="string">"/upload/"</span>);</span><br><span class="line">File dir=<span class="keyword">new</span> File(realPath+date+<span class="string">"//"</span>);</span><br><span class="line"><span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line"><span class="keyword">boolean</span> res=dir.mkdir();</span><br><span class="line"><span class="keyword">if</span>(!res)&#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！请重试！"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析文件后缀名</span></span><br><span class="line">String fileName = file.getOriginalFilename();</span><br><span class="line">String suffix = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</span><br><span class="line"><span class="keyword">if</span>(<span class="string">".jpg"</span>.equals(suffix)||<span class="string">".png"</span>.equals(suffix)||<span class="string">".gif"</span>.equals(suffix)||<span class="string">".jpeg"</span>.equals(suffix)||<span class="string">"bmp"</span>.equals(suffix)) &#123;</span><br><span class="line"><span class="comment">//给上传的文件重新命名</span></span><br><span class="line">File newFileName = <span class="keyword">new</span> File(dir.toString() + <span class="string">"//"</span> + System.currentTimeMillis() + suffix);</span><br><span class="line"><span class="comment">//保存文件到服务器</span></span><br><span class="line">file.transferTo(newFileName);</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传成功！"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>,<span class="string">"文件上传失败！只支持jpeg, jpg, png, gif, bmp 格式的图片文件"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"fileUpLoad"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black"><li>在springmvc配置文件中注册文件上传组件</li></font><br><font color="black">使用MultipartFile对象接收前端上传过来的文件，还需要在springmvc的配置文件中进行如下配置：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/context/spring-context.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--文件上传解析器的id是固定的，必须是multipartResolver--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--上传的文件总大小50M--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*50&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--单个文件最大5M--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSizePerFile"</span> <span class="attr">value</span>=<span class="string">"#&#123;1024*1024*5&#125;"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--默认的字符编码：utf-8--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>多文件上传<br><font color="black">其实多文件上传也很简单，单文件上传是在Controller的处理方法中使用MultipartFile对象作为参数接收前端上传过来的文件，而多文件上传则使用MultipartFile对象数组来接收。</font></li></ol><p><font color="black"><li>页面</li></font><br><font color="black">该页面中有几个name值一样的file类型的input标签，其他跟单文件上传的页面没区别。</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;一次选一个文件，一次提交上传多个文件&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">"$&#123;ctp&#125;/upload2"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    头像： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    图片： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    资料： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    文件： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;button type="submit"&gt;提交&lt;/button&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p><font color="black"><li>控制器</li></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUpLoadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/upload2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String userName,</span></span><br><span class="line"><span class="function"> @<span class="title">RequestParam</span><span class="params">(<span class="string">"headerImg"</span>)</span> MultipartFile[] files,</span></span><br><span class="line"><span class="function"> HttpServletRequest request,</span></span><br><span class="line"><span class="function"> Model model) </span>&#123;</span><br><span class="line">String realPath = request.getServletContext().getRealPath(<span class="string">"/upload/"</span>);</span><br><span class="line">File dir = <span class="keyword">new</span> File(realPath + date +<span class="string">"//"</span>+userName+<span class="string">"//"</span>);</span><br><span class="line"><span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line"><span class="keyword">boolean</span> res = dir.mkdirs();</span><br><span class="line"><span class="keyword">if</span> (!res) &#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！请重试！"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">uploadFile(dir.toString(), file, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"fileUpLoad"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(String path, MultipartFile file, Model model)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">String fileName = file.getOriginalFilename();</span><br><span class="line">String suffix = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</span><br><span class="line"><span class="comment">//给上传的文件重新命名</span></span><br><span class="line">File newFileName = <span class="keyword">new</span> File(path + <span class="string">"//"</span> + System.currentTimeMillis() + suffix);</span><br><span class="line">System.out.println(newFileName);</span><br><span class="line"><span class="comment">//保存文件到服务器</span></span><br><span class="line">file.transferTo(newFileName);</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传成功！"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！"</span> + e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">同样的，使用MultipartFile数组接收前端上传过来的多个文件，也需要在springmvc的配置文件进行配置，具体配置与上述单文件上传的springmvc.xml配置没差别。这样，就可以进行多文件上传了。</font></p><p><strong><font color="black">多种文件上传情景综合</font></strong><br><font color="black">当然，项目开发中，场景可能并不是这么简单，上述的多文件上传是一个个文件选择后一起上传（即多个name相同的input标签），那要是我项目中只要一个input标签就可以一次性多个文件呢？又或者一个页面中既要一个个选择的多文件上传，又要一次性选择的多文件上传，还要有单文件上传呢？没问题，<code>MultipartFile[]</code>通吃，代码也很easy，下面直接上代码。</font></p><p><font color="black">页面</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">   pageContext.setAttribute(<span class="string">"ctp"</span>,request.getContextPath());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;文件上传&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">"$&#123;ctp&#125;/upload3"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &lt;!--一次选择一个文件的多文件上传--&gt;</span><br><span class="line">    头像： &lt;input type=<span class="string">"file"</span> name=<span class="string">"headerImg"</span>/&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--一次选择一个文件的多文件上传 --&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"img"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"img"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"img"</span>/&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--一次选多个文件的多文件上传 --&gt;</span><br><span class="line">    图片：&lt;input type=<span class="string">"file"</span> name=<span class="string">"pic"</span> multiple/&gt;&lt;br/&gt;</span><br><span class="line">    用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;button type="submit"&gt;提交&lt;/button&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">$&#123;msg&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="4">控制器</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/upload3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String userName,</span></span><br><span class="line"><span class="function"> @<span class="title">RequestParam</span><span class="params">(<span class="string">"headerImg"</span>)</span> MultipartFile[] files1,</span></span><br><span class="line"><span class="function"> @<span class="title">RequestParam</span><span class="params">(<span class="string">"img"</span>)</span> MultipartFile[] files2,</span></span><br><span class="line"><span class="function"> @<span class="title">RequestParam</span><span class="params">(<span class="string">"pic"</span>)</span> MultipartFile[] files3,</span></span><br><span class="line"><span class="function"> HttpServletRequest request,</span></span><br><span class="line"><span class="function"> Model model) </span>&#123;</span><br><span class="line">String realPath = request.getServletContext().getRealPath(<span class="string">"/upload/"</span>);</span><br><span class="line">File dir = <span class="keyword">new</span> File(realPath + date +<span class="string">"//"</span>+userName+<span class="string">"//"</span>);</span><br><span class="line"><span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line"><span class="keyword">boolean</span> res = dir.mkdirs();</span><br><span class="line"><span class="keyword">if</span> (!res) &#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！请重试！"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (MultipartFile file : files1) &#123;</span><br><span class="line">uploadFile(dir.toString(), file, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file : files2) &#123;</span><br><span class="line">uploadFile(dir.toString(), file, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (MultipartFile file : files3) &#123;</span><br><span class="line">uploadFile(dir.toString(), file, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"fileUpLoad"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(String path, MultipartFile file, Model model)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">String fileName = file.getOriginalFilename();</span><br><span class="line">String suffix = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</span><br><span class="line"><span class="comment">//给上传的文件重新命名</span></span><br><span class="line">File newFileName = <span class="keyword">new</span> File(path + <span class="string">"//"</span> + System.currentTimeMillis() + suffix);</span><br><span class="line">System.out.println(newFileName);</span><br><span class="line"><span class="comment">//保存文件到服务器</span></span><br><span class="line">file.transferTo(newFileName);</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传成功！"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">model.addAttribute(<span class="string">"msg"</span>, <span class="string">"文件上传失败！"</span> + e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果<font></font></font></p><center><a href="https://sm.ms/image/IWrjyb6CkhRYOPa" target="_blank"><img src="https://i.loli.net/2019/08/13/IWrjyb6CkhRYOPa.gif"></a></center><p><font color="black">MultipartFile[]就是如此强大，不管单个多个，逻辑处理一样，所以建议在项目开发中使用MultipartFile[]作为文件的接收参数。</font></p><h4 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a><font color="red">拓展</font></h4><p><font color="black"><strong>1、MutipartFile类的一些常用方法：</strong></font></p><ul><li><font color="black"><strong>String getContentType()  //获取文件MIME类型</strong></font></li><li><font color="black"><strong>InputStream getInputStream()  //获取文件流</strong></font></li><li><font color="black"><strong>String getName()  //获取表单中文件组件的名字</strong></font></li><li><font color="black"><strong>String getOriginalFilename()  //获取上传文件的原名</strong></font></li><li><font color="black"><strong>long getSize()  //获取文件的字节大小，单位byte</strong></font></li><li><font color="black"><strong>boolean isEmpty() //是否为空</strong></font></li><li><font color="black"><strong>void transferTo(File dest)   //保存文件到服务器指定路径</strong></font></li></ul><p><font color="black"><strong>2、CommonsMultipartResolver的属性解析</strong></font></p><ul><li><font color="black"><strong>defaultEncoding：表示用来解析request请求的默认编码格式，当没有指定的时候根据Servlet规范会使用默认值ISO-8859-1。当request自己指明了它的编码格式的时候就会忽略这里指定的defaultEncoding。</strong></font></li><li><font color="black"><strong>uploadTempDir：设置上传文件时的临时目录，默认是Servlet容器的临时目录。</strong></font></li><li><font color="black"><strong>maxUploadSize：设置允许上传的总的最大文件大小，以字节为单位计算。当设为-1时表示无限制，默认是-1。</strong></font></li><li><font color="black"><strong>maxUploadSizePerFile：跟maxUploadSize差不多，不过maxUploadSizePerFile是限制每个上传文件的大小，而maxUploadSize是限制总的上传文件大小。</strong></font></li><li><font color="black"><strong>maxInMemorySize：设置在文件上传时允许写到内存中的最大值，以字节为单位计算，默认是10240。</strong></font></li><li><font color="black"><strong>resolveLazily：为true时，启用推迟文件解析，以便在UploadAction中捕获文件大小异常。</strong></font></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;文件下载&quot;&gt;&lt;a href=&quot;#文件下载&quot; class=&quot;headerlink&quot; title=&quot;文件下载&quot;&gt;&lt;/a&gt;文件下载&lt;/h4&gt;&lt;p&gt;&lt;font color=&quot;black&quot;&gt;文件下载的最重要的一点是设置响应头的&lt;code&gt;Content-dispositio
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC对Ajax异步请求的支持</title>
    <link href="http://easyblog.top/2019/08/11/SpringMVC%E5%AF%B9Ajax%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82%E7%9A%84%E6%94%AF%E6%8C%81/"/>
    <id>http://easyblog.top/2019/08/11/SpringMVC对Ajax异步请求的支持/</id>
    <published>2019-08-11T15:46:55.000Z</published>
    <updated>2019-08-13T16:06:54.894Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Ajax异步请求概念"><a href="#Ajax异步请求概念" class="headerlink" title="Ajax异步请求概念"></a><font color="black">Ajax异步请求概念</font></h4><h5 id="AJAX-Ansyc-Javascript-And-Xml-异步请求"><a href="#AJAX-Ansyc-Javascript-And-Xml-异步请求" class="headerlink" title="AJAX: Ansyc Javascript And Xml (异步请求)."></a><font color="black">AJAX: Ansyc Javascript And Xml (异步请求).</font></h5><p><font color="black">异步是指基于Ajax的应用与服务器通信的方法。对于传统的Web应用，每次用户发送请求或向服务器请求获得新数据时，浏览器都会完全丢弃当前页面，而等待重新加载的页面。在服务器完全响应之前，用户浏览器将是一片空白，用户的动作必须中断。异步是指用户发送请求后，完全无须等待，请求在后台发送，不会阻塞用户的当前活动，用户无须等待第一次请求得到完全响应，就可以立即发送第二次请求。简单的说,异步请求不会刷新当前html页面。<br>异步指的是服务器端响应数据的获取方式。</font></p><p><font size="black">同步：</font></p><center><a href="https://sm.ms/image/LpqeiH1gnAcmvDy" target="_blank"><img src="https://i.loli.net/2019/08/11/LpqeiH1gnAcmvDy.png" width="100%"></a></center><p><font size="black">异步：</font></p><center><a href="https://sm.ms/image/tDIUm2LGMx6uC8c" target="_blank"><img src="https://i.loli.net/2019/08/11/tDIUm2LGMx6uC8c.png" width="100%"></a></center><h5 id="异步-amp-同步的区别"><a href="#异步-amp-同步的区别" class="headerlink" title="异步&amp;同步的区别"></a><font color="black">异步&amp;同步的区别</font></h5><p><font color="black">1.同步请求：</font></p><p><font color="black">请求的过程：浏览器(当前的html页面会丢弃) —&gt; http协议 —&gt; Web服务器(tomcat)</font></p><p>响应的过程：Web服务器(tomcat) —&gt; http协议 –&gt; 返回一个新html页面.<br></p><p><font color="black">2.异步请求：</font></p><p><font color="black">请求的过程：浏览器(当前的html页面不会丢弃) —&gt; Ajax引擎(http协议) —&gt; Web服务器(tomcat)</font></p><p>响应的过程：Web服务器(tomcat) —&gt; 准备部分数据 –&gt; Ajax引擎(http协议) –&gt; DOM编程.</p><p>总而言之，异步请求只是局部刷新页面，同步请求会全部刷新当前的页面</p><h4 id="jQuery框架的异步请求和处理"><a href="#jQuery框架的异步请求和处理" class="headerlink" title="jQuery框架的异步请求和处理"></a><font color="black">jQuery框架的异步请求和处理</font></h4><p><strong><font color="black">1.$.ajax([settings]) </font></strong>—jQuery核心处理异步请求的方法：<br>语法：</p><blockquote><p>$.ajax([settings])</p></blockquote><p><font color="black">最简单的情况下，$.ajax() 可以不带任何参数直接使用。具体语法格式都有哪些参数请参照：<a href="https://www.w3school.com.cn/jquery/ajax_ajax.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/jquery/ajax_ajax.asp</a></font></p><p><strong><font color="black">2.$.post()</font></strong><br><font color="black"> $.post() 方法通过 HTTP POST 请求从服务器上请求数据。<br>语法：</font></p><blockquote><p> $.post(url, data, function(data, status){<br>// status(状态码): success 、error<br>// data : 响应数据<br>}, dataType);</p></blockquote><p><font color="black">必需的 URL 参数规定您希望请求的 URL。<br>可选的 data 参数规定连同请求发送的数据。<br>可选的 function 参数是请求成功后所执行的函数名,其中data是响应的数据，status是状态码<br>可选的dataType参数是服务器响应返回的数据</font></p><p><strong><font color="black">3.$.get()</font></strong><br><font color="black"> $.get() 方法通过 HTTP GET 请求从服务器上请求数据。</font></p><blockquote><p>$.get(url, data, function(data, status){<br>// status(状态码): success 、error<br>// data : 响应数据<br>}, dataType);</p></blockquote><p><font color="black">必需的 URL 参数规定您希望请求的 URL。<br>可选的 data 参数规定连同请求发送的数据。<br>可选的 function 参数是请求成功后所执行的函数名,其中data是响应的数据，status是状态码<br>可选的dataType参数是服务器响应返回的数据</font></p><h4 id="springMVC支持ajax异步请求和处理返回json数据"><a href="#springMVC支持ajax异步请求和处理返回json数据" class="headerlink" title="springMVC支持ajax异步请求和处理返回json数据"></a><font color="black">springMVC支持ajax异步请求和处理返回json数据</font></h4><h5 id="数据绑定-RequestBody-ResponseBody"><a href="#数据绑定-RequestBody-ResponseBody" class="headerlink" title="数据绑定@RequestBody/@ResponseBody"></a><font color="black">数据绑定@RequestBody/@ResponseBody</font></h5><p><strong>&lt;/font size=4&gt;@RequestBody</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;功能 ：用于将HttpServletRequest的getInputStream()的内容绑定到方法入参<br>例如：</p><blockquote><p>@RequestMapping(value = “/hello”)<br> public String handleRequest(@RequestBody String body){<br>         //body参数就被请求参数自动绑定<br>}</p></blockquote><p><strong>&lt;/font size=4&gt;@ResponseBody</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;功能：被ResponseBody修饰的方法的返回值会被作为响应体</p><blockquote><p>@RequestMapping(value = “/hello”)<br>@ResponseBody<br> public User handleRequest(Ueser user){</p><p>  return User;      //返回值会被作为响应体，而且如果返回值是对象时SpringMVC会自动转换成JSON给页面<br>}</p></blockquote><h5 id="使用-RequestBody-ResponseBody来支持Ajax"><a href="#使用-RequestBody-ResponseBody来支持Ajax" class="headerlink" title="使用@RequestBody/@ResponseBody来支持Ajax"></a><font color="black">使用@RequestBody/@ResponseBody来支持Ajax</font></h5><p><font color="black">可以使用@RequestBody来自动获取Ajax上传的数据，同时也可以使用@ResponseBody，把要返回的对象自动拼成JSON的格式返回。当然，需要加入几个jackson的包，这里加入了：<br>jackson-core-2.9.3.jar、jackson-annotations-2.9.3.jar、jackson-databind-2.9.3.jar，Maven依赖如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--jackson的三个依赖包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ResponseBody:用于将ResponseBody方法的返回值作为响应体</span></span><br><span class="line"><span class="comment"> * RequestBody:用于将HttpServletRequest的getInputStream()内容绑定到入参</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> users</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/getAllUserByAJAX"</span>, produces = <span class="string">"application/json;charset=UTF-8"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUserByAJAX</span><span class="params">(@ModelAttribute(<span class="string">"users"</span>)</span> List&lt;User&gt; users) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> users;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RequestBody：将请求体的数据绑定到入参</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testRequestBody"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">testRequestBody</span><span class="params">(@RequestBody User user, Model model)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"请求的数据："</span>+user);</span><br><span class="line">model.addAttribute(<span class="string">"requestInfo"</span>, user);</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提前把全部信息查询好放在隐含模型中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>(<span class="string">"users"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAll</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">IUserService userService = <span class="keyword">new</span> IUserServiceImpl();</span><br><span class="line">List&lt;User&gt; lists = userService.getUser(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">model.addAttribute(<span class="string">"users"</span>, lists);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black"> 1. 通过AJAX获得服务器数据的页面：</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.Date"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">  pageContext.setAttribute(<span class="string">"ctp"</span>, request.getContextPath());</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;ajax&lt;/title&gt;</span><br><span class="line">&lt;script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">   $().ready(function () &#123;</span><br><span class="line">$(<span class="string">"#first"</span>).click(function () &#123;</span><br><span class="line">alert(<span class="string">"adacd"</span>);</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url: <span class="string">"$&#123;ctp&#125;/getAllUserByAJAX"</span>,</span><br><span class="line">type: <span class="string">"GET"</span>,</span><br><span class="line">success: function (data) &#123;</span><br><span class="line"><span class="comment">//console.log(data)</span></span><br><span class="line">$.each(data, function () &#123;</span><br><span class="line"><span class="keyword">var</span> userInfo = <span class="keyword">this</span>.name + <span class="string">"---"</span> + <span class="keyword">this</span>.age + <span class="string">"---"</span> + <span class="keyword">this</span>.email;</span><br><span class="line">$(<span class="string">"#user"</span>).append(userInfo + <span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;%=<span class="keyword">new</span> Date()%&gt;</span><br><span class="line">&lt;div id=<span class="string">"user"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;a id="first" href="$&#123;ctp&#125;/getAllUserByAJAX"&gt;获取全部用户信息&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>测试结果</strong></p><center><a href="https://sm.ms/image/mYgvTEf1IOryKUM" target="_blank"><img src="https://i.loli.net/2019/08/11/mYgvTEf1IOryKUM.gif" width="100%"></a></center><p><font color="black">2. 通过AJAX向服务器发JSON数据，服务器返回JSON数据</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">   pageContext.setAttribute(<span class="string">"ctp"</span>, request.getContextPath());</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">$().ready(function () &#123;</span><br><span class="line">   $(<span class="string">"#first"</span>).click(function () &#123;</span><br><span class="line"><span class="comment">//点击发送JSON数据给服务器</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url: <span class="string">"$&#123;ctp&#125;/testRequestBody"</span>,</span><br><span class="line">type: <span class="string">"POST"</span>,</span><br><span class="line">contentType:<span class="string">"application/json"</span>,     <span class="comment">//请求的文本格式：json</span></span><br><span class="line">data: JSON.stringify(&#123;name: $(<span class="string">"#username"</span>).val(), age: $(<span class="string">"#userage"</span>).val(), email: $(<span class="string">"#userEmail"</span>).val()&#125;),  <span class="comment">//给服务器提交的数据</span></span><br><span class="line">dataType: <span class="string">"json"</span>,     <span class="comment">//服务器返回的数据类型</span></span><br><span class="line">success: function (data) &#123;</span><br><span class="line"><span class="keyword">var</span> userInfo = data.name + <span class="string">"---"</span> + data.age + <span class="string">"---"</span> + data.email;</span><br><span class="line">$(<span class="string">"#users"</span>).append(userInfo + <span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">"$&#123;ctp&#125;/testRequestBody"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">&lt;input id=<span class="string">"username"</span> name=<span class="string">"username"</span> type=<span class="string">"text"</span>/&gt;</span><br><span class="line">&lt;input id=<span class="string">"userage"</span> name=<span class="string">"age"</span> type=<span class="string">"text"</span>/&gt;</span><br><span class="line">&lt;input id=<span class="string">"userEmail"</span> name=<span class="string">"enail"</span> type=<span class="string">"email"</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;button type="button"&gt;&lt;a id="first" href="$&#123;ctp&#125;/testRequestBody"&gt;AJAX发送JSON数据给服务器&lt;/a&gt;&lt;/button&gt;</span><br><span class="line">&lt;div id=<span class="string">"users"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>测试结果</strong></p><center><a href="https://sm.ms/image/5BKupvAXGmfeJnU" target="_blank"><img src="https://i.loli.net/2019/08/11/5BKupvAXGmfeJnU.gif" width="100%"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Ajax异步请求概念&quot;&gt;&lt;a href=&quot;#Ajax异步请求概念&quot; class=&quot;headerlink&quot; title=&quot;Ajax异步请求概念&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;Ajax异步请求概念&lt;/font&gt;&lt;/h4&gt;&lt;h5 id=&quot;AJAX-A
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC 数据绑定&amp;数据格式化&amp;数据校验</title>
    <link href="http://easyblog.top/2019/08/09/SpringMVC%20%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A&amp;%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96&amp;%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C/"/>
    <id>http://easyblog.top/2019/08/09/SpringMVC 数据绑定&amp;数据格式化&amp;数据校验/</id>
    <published>2019-08-09T10:29:31.000Z</published>
    <updated>2019-08-16T06:29:39.554Z</updated>
    
    <content type="html"><![CDATA[<h4 id="数据绑定流程"><a href="#数据绑定流程" class="headerlink" title="数据绑定流程"></a><font color="black">数据绑定流程</font></h4><ol><li>Spring MVC将ServletRequest对象及目标方法的入参实例传给WebDataBinderFactory实例，创建出DataBinder(数据绑定的核心部件)</li><li>DataBinder调用转配在SpringMVC上下文中的ConversionService组件进行数据类型转换、数据格式化。并将servlet中的请求信息填充到入参对象中</li><li>调用Validator组件对已经绑定好的请求消息的入参进行数据合法性校验，并最终生成数据绑定结果BindingResult对象</li><li>Spring MVC抽取BindingResult中的入参对象和检验错误对象，将他们赋给处理方法的响应入参</li><li>Spring MVC通过反射机制对目标方法进行解析，将请求消息绑定到处理方法的入参中。</li></ol><h4 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a><font color="black">数据转换</font></h4><h5 id="2-1-ConversionService"><a href="#2-1-ConversionService" class="headerlink" title="2.1 ConversionService"></a><font color="black">2.1 ConversionService</font></h5><ul><li>Spring MVC 上下文中内建了很多转换器，可完成大多数 Java 类型的转换工作。</li><li>Spring3.0 添加了一个通用的类型转换模块，位于 org.springframework.core.convert 包中</li><li><strong><font size="4">ConversionService 接口是类型转换的核心接口</font></strong></li></ul><table border="1px"><tr><th>Modifier and Type </th><th>Method and Description</th></tr><tr><td>boolean </td><td>canConvert(Class<?> sourceType, Class<?> targetType)判断是否可以将一个 java 类转换为另一个 java 类</td></tr><tr><td>boolean</td><td> canConvert(TypeDescriptor sourceType, TypeDescriptor targetType)</td></tr>需转换的类将以成员变量的方式出现在宿主类中，TypeDescriptor 不但描述了需转换类的信息，还描述了从宿主类的上下文信息，如成员变量上的注解，成员是否是数组、集合或 Map 的方式呈现等<tr><td><t> T</t></td><td> convert(Object source, Class<t> targetType)将原类型对象转换为目标类型对象. </t></td></tr><tr><td>Object</td><td> convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)将对象从原类型对象转换为目标类型对象，此时往往会用到所在宿主类的上下文信息</td></tr></table><h5 id="2-2-自定义类型转换器"><a href="#2-2-自定义类型转换器" class="headerlink" title="2.2 自定义类型转换器"></a><font color="black">2.2 自定义类型转换器</font></h5><p><font color="black">Spring 在 org.springframework.core.convert.converter 包中定义了 3 种类型转换器接口，实现任意一个转换器接口都可以作为自定义转换器注册到 ConversionServiceFactroyBean 中：</font></p><ul><li><font color="red" size="4">Converter&lt;S,T&gt;：将S类型对象转换为T类型对象</font></li><li>ConverterFactory：将相同系列多个Converter封装在一起.如果希望将一种类<br>型的对象转换为另一种类型及其子类的对象（例如将 String 转换为 Number 及<br>Number 子类（Integer、Long、Double 等）对象）可使用该转换器工厂类</li><li>GenericConverter：会根据源类对象及目标类对象所在的宿主类找那个的上下文信息进行类型转换</li></ul><p>ConverstionServiceFactoryBean 的 converters 属性可以接受 Converter、ConverterFactory、GenericConverter 或 ConditionalGenericConverter 接口的实现类，并把这些转换器的转换逻辑统一封装到一个 ConverstionService 实例对象中(GenericConversionService),Spring 在 Bean属性配置及 Spring MVC 请求消息绑定时将利用这个 ConversionService 实例完成类型转换工作。</p><p>实际应用中常用的是Converter&lt;S,T&gt;，下面通过他实现一个自定义的类型转换器：<br>关键步骤：</p><ol><li><strong>实现Converter接口，他有两个泛型，S:是转换前的了类型，T:是转换后的类型 ，实现Converter接口的conver方法，在方法中定制对S类型如何转换换成T类型的规则</strong></li><li><strong>在springmvc配置文件中将自定义的Converter配置在ConversionService中</strong></li><li><strong>告诉SpringMVC使用我们自定义的类型转换器</strong></li></ol><p>假设处理方法有一个 User 类型的入参，我们希望将一个格式化的请求字符串直接转为 User对象，该字符串格式如（小明:男:软件工程:软工3306班:1134556）</p><ul><li><p>编写自定义类型转换器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Student;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToStudentConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在这个方法中定义转换的规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">convert</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        <span class="comment">//param==&gt;小明:男:软件工程:软工3306班:17033309</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != param &amp;&amp; !<span class="string">""</span>.equals(param)) &#123;</span><br><span class="line">            String[] pa=param.split(<span class="string">":"</span>);</span><br><span class="line">            student.setName(pa[<span class="number">0</span>]);</span><br><span class="line">            student.setGender(pa[<span class="number">1</span>]);</span><br><span class="line">            student.setSclass(pa[<span class="number">2</span>]);</span><br><span class="line">            student.setMajor(pa[<span class="number">3</span>]);</span><br><span class="line">            student.setSid(pa[<span class="number">4</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在SpringMVC配置文件中将自定义的Converter方在IOC容器中交给Spring管理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--该 标 签 会 创 建 并 注 册 一 个 默 认 的 DefaultAnnotationHandlerMapping 和一个ReqeustMappingHandlerAdpter实现，除此之外&lt;mvc:annotaion-driven/&gt;标签还会注册一个默认的ConversionService（FormattingConversionServiceFactoryBean）以满足大多数类型转换 的需求 ，当用到自定义类型转换器时，需要用</span></span><br><span class="line"><span class="comment">&lt;mvc:annotation-driven conversion-service=”xxx”/&gt;覆盖默认--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置自定义的类型转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.xzy.converter.StringToStudentConverter"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>用<code>&lt;mvc:annotation-driven conversion-service=”xxx”/&gt;</code>覆盖默认的类型转换器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在&lt;mvc:annotation-driver中配置conversion-service覆盖默认的转换器&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><p>控制器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.contorller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Student;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/addStudent"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addStudent</span><span class="params">(@RequestParam(<span class="string">"stuInfo"</span>)</span> Student student, Model model) </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"封装的"</span> + student);</span><br><span class="line">        model.addAttribute(<span class="string">"stuinfo"</span>,student);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font size="4">测试结果：</font></p><center><a href="https://sm.ms/image/QulCxTK7yh9q6eD" target="_blank"><img src="https://i.loli.net/2019/08/09/QulCxTK7yh9q6eD.gif"></a></center><h4 id="数据格式化"><a href="#数据格式化" class="headerlink" title="数据格式化"></a><font color="black">数据格式化</font></h4><p>Spring 使用转换器进行源类型对象到目标类型对象的转换，Spring 的转换不提供输入及<br>输出信息格式化工作，像日期、时间、数字、货币等数据都具有一定格式的，在不同的本地化环境中，同一类型的数还会相应地呈现不同的显示格式。<br>如何从格式化的数据中获取真正的数据以完成数据绑定，并将处理完成的数据输出为格<br>式化的数据，是 spring 格式化框架要解决的问题，Spring 引入了一个新的格式化框架，这个框架位于 org.springframework.format 类包中，其中最重要的一个接口 Formatter<t><br>Spring 的 org.springframework.format.datetime 包中提供了一个用于时间对象格式化的<br><code>DateFormatter 实现类</code>，而 org.springframework.format.number 包中提供了 3 个用于数字<br>对象格式化的实现类。</t></p><ul><li><code>NumberFormatter</code>:用于数字类型对象的格式化</li><li><code>CurrencyFormatter</code>:用于货币类型对象的格式化</li><li><code>PercentFormatter</code>: 用于百分数数字类型对象的格式化</li></ul><p>示例：<br>有一个员工类employee.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.NumberFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mame;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    <span class="keyword">private</span>  Date birth;    <span class="comment">//生日</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//表示3位一个逗号，保留两位小数</span></span><br><span class="line">    <span class="meta">@NumberFormat</span>(pattern = <span class="string">"#,###.##"</span>)</span><br><span class="line">    <span class="keyword">private</span> Double salary;  <span class="comment">//薪水</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">//省略getter、setter</span></span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"employee&#123;"</span> +</span><br><span class="line">                <span class="string">"mame='"</span> + mame + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birth="</span> + birth +</span><br><span class="line">                <span class="string">", salary="</span> + salary +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要使注解可以发挥作用还需要在注解中配置如下信息：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.xzy.converter.StringToStudentConverter"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;对属性对象的输入/输出进行格式化，从其本质上讲依然属于 “类型转换” 的范畴。Spring 在格式化模块中定义了一个实现 ConversionService 接口的FormattingConversionService 实现类，该实现类扩展了GenericConversionService，因此它既具有类型转换的功能，又具有格式化的功能。<br>&nbsp;&nbsp;&nbsp;&nbsp;FormattingConversionService 拥有FormattingConversionServiceFactroyBean 工厂类，后者用于在 Spring 上下文中构造前者FormattingConversionServiceFactroyBean 内部已经注册了 :<br>NumberFormatAnnotationFormatterFactroy：<br>支持对数字类型的属性使用 <font color="red">@NumberFormat </font>注解JodaDateTimeFormatAnnotationFormatterFactroy：支持对日期类型的属性使用  <font color="red">@DateTimeFormat  </font>注解<br>装配了 FormattingConversionServiceFactroyBean 后，就可 以在 Spring MVC 入<br>参绑定及模型数据输出时使用注解驱动了。<br><code>&lt;mvc:annotation-driven/&gt;</code>默认创建的ConversionService 实例即为 FormattingConversionServiceFactroyBean.</p><h4 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a><font color="black">数据校验</font></h4><p>应用程序在执行业务逻辑前，必须通过数据校验保证接收到的输入数据是正确合法的，如代表生日的日期应该是一个过去的时间、工资的数值必须是一个整数等。一般情况下，应用程序的开发时分层的，不同层的代码由不同的开发人员负责。很多时候，同样的数据验证会出现在不同的层中，这样就会导致代码冗余，违反了DRY原则。为了避免这样的情况，最好将验证逻辑和响应的域模型进行绑定，将代码验证的逻辑集中起来管理。</p><h5 id="JSR-303"><a href="#JSR-303" class="headerlink" title="JSR-303"></a><font color="black">JSR-303</font></h5><p>  JSR-303是Java为Bean数据合法校验锁提供的标准框架，它已经包含在JavaEE 6.0中。JSR-303通过在Bean属性上标注类似于@NotNull、@Max等标准的注解指定校验规则，并通过标准的验证接口对Bean进行验证。可以通过<a href="http://jcp.org/en/jsr/detail?id=303了解更多详细内容。" target="_blank" rel="noopener">http://jcp.org/en/jsr/detail?id=303了解更多详细内容。</a><br>JSR-303定义了一套可标注在成员变量、属性方法上的校验注解：</p><center><a href="https://sm.ms/image/IiaoJEY3H4ZeM7V" target="_blank"><img src="https://i.loli.net/2019/08/09/IiaoJEY3H4ZeM7V.png"></a></center>JSR-303 支持 XML 风格的和注解风格的验证，接下来我们首先看一下如何和 Spring 集成。1. 导入jar包,此处使用 Hibernate-validator 实现（版本：hibernate-validator-6.0.17.Final-dist.zip），他的Maven依赖如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.17.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>在Spring配置中添加JSR-303验证框架支持</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置对JSR-303的支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"validator"</span> <span class="attr">class</span>=<span class="string">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"providerClass"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.validator.HibernateValidator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>通过 ConfigurableWebBindingInitializer 注册 validator</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册validator--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"webBinding"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.bind.support.ConfigurableWebBindingInitializer"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"conversionService"</span> <span class="attr">ref</span>=<span class="string">"conversionService"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validator"</span> <span class="attr">ref</span>=<span class="string">"validator"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用 JSR-303 验证框架注解为模型对象指定验证信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Size</span>(min = <span class="number">7</span>,max=<span class="number">10</span>)</span><br><span class="line"><span class="keyword">private</span> String sid;    <span class="comment">//学号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Pattern</span>(regexp = <span class="string">"/^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]&#123;8&#125;$/"</span>)</span><br><span class="line"><span class="keyword">private</span> String phone;   <span class="comment">//手机号码</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@NotBlank</span></span><br><span class="line"><span class="keyword">private</span> String sclass;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line"><span class="keyword">private</span> String major;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//省略getter、setter</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line"><span class="string">"姓名：'"</span> + name + <span class="string">'\''</span> +</span><br><span class="line"><span class="string">", 学号：'"</span> + sid + <span class="string">'\''</span> +</span><br><span class="line"><span class="string">", 手机：'"</span> +phone + <span class="string">'\''</span> +</span><br><span class="line"><span class="string">", 班级：'"</span> + sclass + <span class="string">'\''</span> +</span><br><span class="line"><span class="string">", 专业：'"</span> + major + <span class="string">'\''</span> +</span><br><span class="line"><span class="string">'&#125;'</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>控制器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Vaild就是告诉SpringMVC 把数据绑定好后要根据Bean里面的校验规则校验</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/addStudent"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addStudent2</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@Valid @ModelAttribute Student student,</span></span></span><br><span class="line"><span class="function"><span class="params">Errors error,</span></span></span><br><span class="line"><span class="function"><span class="params">Model model)</span> </span>&#123;</span><br><span class="line">logger.info(student);</span><br><span class="line">model.addAttribute(<span class="string">"student"</span>, student);</span><br><span class="line"><span class="keyword">if</span> (error.hasErrors()) &#123;</span><br><span class="line">System.out.println(error);</span><br><span class="line">logger.error(error);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"add"</span>;        <span class="comment">//如果有错误，就返回填写页面重新填写</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;formName&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginForm</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@PathVariable String formName,</span></span></span><br><span class="line"><span class="function"><span class="params">Model model)</span></span>&#123;</span><br><span class="line">System.out.println(formName);</span><br><span class="line">Student student= <span class="keyword">new</span> Student();</span><br><span class="line">model.addAttribute(<span class="string">"student"</span>,student);</span><br><span class="line"><span class="comment">// 动态跳转页面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> formName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>通过在命令对象上注解@Valid 来告诉 Spring MVC 此命令对象在绑定完毕后需要进行 JSR-303验证，如果验证失败会将错误信息添加到 Errors 错误对象中。</p><ol start="5"><li>验证失败后回到填写表单的页面（/WEB-INF/jsp/pages/add.jsp）<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"fmt"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"form"</span> uri=<span class="string">"http://www.springframework.org/tags/form"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form:form modelAttribute=<span class="string">"student"</span> method=<span class="string">"post"</span> action=<span class="string">"addStudent.htm"</span>&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;姓名:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:input path="name"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:errors path="name" cssStyle="color:red"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;学号:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:input path="sid"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:errors path="sid" cssStyle="color:red"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;手机:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:input path="phone"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:errors path="phone" cssStyle="color:red"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;班级:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:input path="sclass"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:errors path="sclass" cssStyle="color:red"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;专业:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:input path="major"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;form:errors path="major" cssStyle="color:red"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;&lt;input type="submit" value="提交"/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li></ol><p><font size="4">测试结果：</font></p><center><a href="https://sm.ms/image/pEfGCSsAtqbuwi5" target="_blank"><img src="https://i.loli.net/2019/08/09/pEfGCSsAtqbuwi5.gif"></a></center><h5 id="自定义国际化错误消息提示"><a href="#自定义国际化错误消息提示" class="headerlink" title="自定义国际化错误消息提示"></a><font color="black">自定义国际化错误消息提示</font></h5><p>在上面的程序中有一个不好的地方，错误消息不是 我们自定义的，而且都是英文的，下面我们来看看如何在通过国际化配置文件实现自定义国际化错误消息提示。<br>使用 <code>System.out.println(&quot;错误码：&quot;+fieldError.getCodes());</code>可以得到错误的错误码，每种错误都定义了4中错误码，如下：</p><center><a href="https://sm.ms/image/AOBwYaGI9RQids4" target="_blank"><img src="https://i.loli.net/2019/08/09/AOBwYaGI9RQids4.png"></a></center>他们从上到下所包含的范围由小到大，我们在写国际化配置文件的时候，每条配置的key必须是4个code中的一个code。<p><code>error_en_US.properties</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NotBlank.student.name=name must not be empty</span><br><span class="line">Size.student.sid=the length must between &#123;2&#125; and &#123;1&#125;</span><br><span class="line">Pattern.student.phone=please write a right phone number</span><br><span class="line">NotBlank.student.sclass=class must not be empty</span><br><span class="line">NotEmpty.student.major=major must not be empty</span><br></pre></td></tr></table></figure><p><code>error_zh_CN.properties</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NotBlank.student.name=姓名不能为空!</span><br><span class="line">Size.student.sid=长度应该在&#123;2&#125;和&#123;1&#125;之间!</span><br><span class="line">Pattern.student.phone=请填写正确的手机号码!</span><br><span class="line">NotBlank.student.sclass=班级不能为空!</span><br><span class="line">NotEmpty.student.major=专业不能为空!</span><br></pre></td></tr></table></figure><p>在springmvc.xml文件中配置国际化资源：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置国际化资源--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basenames"</span> <span class="attr">value</span>=<span class="string">"error"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  &lt;property name="basenames" value="message"/&gt;--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useCodeAsDefaultMessage"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheSeconds"</span> <span class="attr">value</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--配置字符编码为UTF-8：注意properties的编码格式也应该是UTF-8的，否者即使你设置了字符编码过滤器也会乱码--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 主要用于获取请求中的locale信息，将其转为Locale对像，获取LocaleResolver对象--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeChangeInterceptor"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 配置SessionLocaleResolver用于将Locale对象存储于Session中供后续使用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"SessionLocaleResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：</p><center><a href="https://sm.ms/image/zrhlDwuCYSIEaRe" target="_blank"><img src="https://i.loli.net/2019/08/09/zrhlDwuCYSIEaRe.gif"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;数据绑定流程&quot;&gt;&lt;a href=&quot;#数据绑定流程&quot; class=&quot;headerlink&quot; title=&quot;数据绑定流程&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;数据绑定流程&lt;/font&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;Spring MVC将ServletReq
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC自定义视图和视图解析器</title>
    <link href="http://easyblog.top/2019/08/08/SpringMVC%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E5%92%8C%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8/"/>
    <id>http://easyblog.top/2019/08/08/SpringMVC自定义视图和视图解析器/</id>
    <published>2019-08-08T14:36:02.000Z</published>
    <updated>2019-08-14T14:23:57.950Z</updated>
    
    <content type="html"><![CDATA[<h4 id="自定义视图解析器："><a href="#自定义视图解析器：" class="headerlink" title="自定义视图解析器："></a><font color="balck"><strong>自定义视图解析器：</strong></font></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.View;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义视图解析器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewResolver</span> <span class="keyword">implements</span> <span class="title">ViewResolver</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> order = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (viewName.startsWith(<span class="string">"my:"</span>)) &#123;</span><br><span class="line">            <span class="comment">//返回自定义的视图对象</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MyView();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//不能处理就不要强行处理了，返回null让别的视图处理器来处理</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(<span class="keyword">int</span> order)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.order = order;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义视图："><a href="#自定义视图：" class="headerlink" title="自定义视图："></a><font color="balck"><strong>自定义视图：</strong></font></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义视图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">implements</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回的文本类型：text/html</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"text/html"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">     <span class="comment">// 渲染视图:在这个方法中写你对这个视图的渲染效果</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(Map&lt;String, ?&gt; map, HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"方法中保存的数据："</span> + map);</span><br><span class="line">        httpServletResponse.setContentType(<span class="string">"text/html"</span>);</span><br><span class="line">        PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">        out.write(<span class="string">"&lt;h3&gt;精彩内容即将呈现...Loading&lt;/h3&gt;"</span>);</span><br><span class="line">        List&lt;Object&gt; lists= (List&lt;Object&gt;) map.get(<span class="string">"video"</span>);</span><br><span class="line">        out.write(<span class="string">"&lt;ul&gt;"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Object object:lists)&#123;</span><br><span class="line">            out.write(<span class="string">"&lt;li&gt;&lt;a href='download'&gt;"</span>+object+<span class="string">"&lt;/a&gt;&lt;/li&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        out.write(<span class="string">"&lt;/ul&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="balck">好了，现在视图处理和视图都定义好，这样我们的视图解析器就可以工作了吗？非也！虽然我们实现了ViewRelover接口.但是对于SpringMVC来说他就是一个普通的java类，SpringMVC如何知道去哪里调用我们的视图解析器呢?解决的方法是：在springmvc配置文件中配置我们的视图解析器，交给Spring IOC容器管理。</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置自定义的视图解析器:</span></span><br><span class="line"><span class="comment">       springmvc中视图解析器得到视图时优先级高的会先去尝试解析，order的数值越小，优先级越高</span></span><br><span class="line"><span class="comment">       自定义的视图解析器需要实现Orderd接口，默认的视图解析器InternalResourceViewResolver的优先级最低</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.xzy.view.MyViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"order"</span> <span class="attr">value</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black"><strong>注意：自定义的视图解析器必须要实现ordered接口，以给我们自定义的视图解析器指定优先级，优先级的规则是值越小，优先级高；SpringMVC默认的视图解析器<code>InternalResourceViewResolver</code>的优先级是最低的。</strong></font></p><h4 id="编写控制器"><a href="#编写控制器" class="headerlink" title="编写控制器"></a><font color="balck"><strong>编写控制器</strong></font></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.contorller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/viewhandler"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">myViewTest</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; vnames=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        vnames.add(<span class="string">"java疯狂讲义300集"</span>);</span><br><span class="line">        vnames.add(<span class="string">"java从入门到如入土！！！"</span>);</span><br><span class="line">        vnames.add(<span class="string">"Spring,SpringMVC从入门到放弃！！！"</span>);</span><br><span class="line">        vnames.add(<span class="string">"MySql从删库到跑路！！！"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"video"</span>,vnames);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"my:/hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font size="4" color="black">测试结果：</font><br><a href="https://sm.ms/image/ko3CSMwgs1UAI6j" target="_blank"><img src="https://i.loli.net/2019/08/08/ko3CSMwgs1UAI6j.png"></a><br><strong><font size="5" color="red">总结自定义视图处理器和视图的步骤：</font></strong><br><strong></strong></p><ol><li><strong>编写视图处理器（实现ViewReslover接口的resolveViewName方法）和视图（实现View接口的两个方法：getContentType()、render()）</strong></li><li><strong>视图解析器必须放在IOC容器中</strong></li><li><strong>视图处理器除了要实现ViewReslover接口，还应该实现ordered接口，已给我们定义的视图解析器指定优先级，这个很关键.</strong></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;自定义视图解析器：&quot;&gt;&lt;a href=&quot;#自定义视图解析器：&quot; class=&quot;headerlink&quot; title=&quot;自定义视图解析器：&quot;&gt;&lt;/a&gt;&lt;font color=&quot;balck&quot;&gt;&lt;strong&gt;自定义视图解析器：&lt;/strong&gt;&lt;/font&gt;&lt;/h4&gt;&lt;
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC视图解析</title>
    <link href="http://easyblog.top/2019/08/07/SpringMVC%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90/"/>
    <id>http://easyblog.top/2019/08/07/SpringMVC视图解析/</id>
    <published>2019-08-07T06:41:44.000Z</published>
    <updated>2019-08-11T16:11:46.026Z</updated>
    
    <content type="html"><![CDATA[<h3 id="SpringMVC视图解析"><a href="#SpringMVC视图解析" class="headerlink" title="SpringMVC视图解析"></a>SpringMVC视图解析</h3><p> &nbsp; &nbsp; &nbsp;对于控制器的目标方法，无论其返回值是String、View、ModelMap或是ModelAndView，SpringMVC都会在内部将它们封装为一个ModelAndView对象进行返回。<br>     &nbsp; &nbsp; &nbsp; Spring MVC 借助视图解析器（ViewResolver）得到最终的视图对象（View），最终的视图可以是JSP也可是Excell、 JFreeChart等各种表现形式的视图。</p><h4 id="视图（View）"><a href="#视图（View）" class="headerlink" title="视图（View）"></a>视图（View）</h4><blockquote><p> 视图的作用是渲染模型数据，将模型里的数据以某种形式呈现给客户。 为了实现视图模型和具体实现技术的解耦，Spring在org.springframework.web.servlet包中定义了一个高度抽象的View接口。<br>   视图对象由视图解析器负责实例化。由于视图是无状态的，所以他们不会有线程安全的问题。所谓视图是无状态的，是指对于每一个请求，都会创建一个View对象。<br>　JSP是最常见的视图技术。 </p></blockquote><center><a href="https://sm.ms/image/h1GdgDwFS4OeMLy" target="_blank"><img src="https://i.loli.net/2019/08/07/h1GdgDwFS4OeMLy.png"></a></center><h4 id="视图解析器（ViewResolver）和视图（View）"><a href="#视图解析器（ViewResolver）和视图（View）" class="headerlink" title="视图解析器（ViewResolver）和视图（View）"></a>视图解析器（ViewResolver）和视图（View）</h4><ul><li><strong>springMVC用于处理视图最重要的两个接口是<code>ViewResolver</code>和<code>View</code>。</strong><center><a href="https://sm.ms/image/ocemL4slE7KxngD" target="_blank"><img src="https://i.loli.net/2019/08/07/ocemL4slE7KxngD.png"></a></center></li></ul><p><font color="red"><strong>所以视图解析器的作用就是通过视图名（处理方法的返回值）生成View对象</strong></font>，所有的视图解析器都必须实现ViewResolver接口。<br>　　 SpringMVC为逻辑视图名的解析提供了不同的策略，可以在Spring WEB上下文中配置一种或多种解析策略，并指定他们之间的先后顺序。每一种映射策略对应一个具体的视图解析器实现类。程序员可以选择一种视图解析器或混用多种视图解析器。可以通过order属性指定解析器的优先顺序，order越小优先级越高，SpringMVC会按视图解析器顺序的优先顺序对逻辑视图名进行解析，直到解析成功并返回视图对象，否则抛出ServletException异常。<br>在项目中可以配置<code>InternalResourceViewResolver</code>作为视图解析器,在springmvc.xml中可以做如下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewHandler"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"WEB-INF/pages/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span>  <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="forward-和redirect"><a href="#forward-和redirect" class="headerlink" title="forward: 和redirect:"></a>forward: 和redirect:</h4><p>一般情况下，控制器方法返回字符串类型的值会被当成逻辑视图名处理，会经过视图解析器拼串，但如果返回的字符串中带forward:或redirect:前缀时，SpringMVC会对它们进行特殊处理：将forward: 和redirect: 当成指示符，其后的字符串作为URL 来处理。示例如下：<br><code>index.html</code></p><figure class="highlight htmlbars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SpringMVC给页面输出数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler1"</span>&gt;</span>handler1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler2"</span>&gt;</span>handler2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler3"</span>&gt;</span>handler3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler4"</span>&gt;</span>handler4<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><code>hello.jsp</code>，在当前项目的根路径下，和index.html同级</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Hello&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;h1&gt;这是hello.jsp&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>ViewTestController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.Contorller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewTestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * handler1把请求转发到hello.jsp页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"handler1"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/hello.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * handler把请求转发给handler1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"handler2"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:handler1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重定向到hello.jsp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler3"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">handler3</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"handler3"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/hello.jsp"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重定向到handler3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler4"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"handler4"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:handler3"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果:</p><p><a href="https://sm.ms/image/WS3iPsRax8ogvHu" target="_blank"><img src="https://i.loli.net/2019/08/07/WS3iPsRax8ogvHu.png" alt="QQ截图20190807154131.png"></a></p><p><a href="https://sm.ms/image/IDgLj7QWA5c1NwM" target="_blank"><img src="https://i.loli.net/2019/08/07/IDgLj7QWA5c1NwM.png" alt="QQ截图20190807154027.png"></a></p><p>按F12打开开发者工具，可以看到确实两次重定向<br><a href="https://sm.ms/image/TxW72zqBuSrUlt3" target="_blank"><img src="https://i.loli.net/2019/08/07/TxW72zqBuSrUlt3.png"></a></p><h4 id="SpringMVC视图的解析流程-结合源码分析"><a href="#SpringMVC视图的解析流程-结合源码分析" class="headerlink" title="SpringMVC视图的解析流程(结合源码分析)"></a>SpringMVC视图的解析流程(结合源码分析)</h4><ul><li>源码中把任何返回返回值封装为ModelAndView的实现：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">handleInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.checkRequest(request);</span><br><span class="line">     ModelAndView mav;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.synchronizeOnSession) &#123;</span><br><span class="line">         HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">         <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">             Object mutex = WebUtils.getSessionMutex(session);</span><br><span class="line">             <span class="keyword">synchronized</span>(mutex) &#123;</span><br><span class="line">               mav = <span class="keyword">this</span>.invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             mav = <span class="keyword">this</span>.invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         mav = <span class="keyword">this</span>.invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span>(!response.containsHeader(<span class="string">"Cache-Control"</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.getSessionAttributesHandler(handlerMethod).hasSessionAttributes()) &#123;        <span class="keyword">this</span>.applyCacheSeconds(response,<span class="keyword">this</span>.cacheSecondsForSessionAttributeHandlers);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">this</span>.prepareResponse(response);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> mav;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ul><p>这里以发出了一个GET请求为例：<br>首先<code>FrameworkServlet类</code>会来处理这个GET请求<br><code>doGet</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.processRequest(request, response);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><code>processRequest</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">//省略.....</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//它本类中的这个方法是个抽象方法，实现这个方法的类是DispatcherServlet</span></span><br><span class="line">            <span class="keyword">this</span>.doService(request, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ServletException var16) &#123;</span><br><span class="line">            failureCause = var16;</span><br><span class="line">            <span class="keyword">throw</span> var16;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var17) &#123;</span><br><span class="line">           <span class="comment">//省略.....var17);</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           <span class="comment">//省略.....</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>DispatcherServlet 类</code><br><code>doService方法</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//省略.....</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//给request域中设置了一些东西</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//调用doDispatch方法处理</span></span><br><span class="line">        <span class="keyword">this</span>.doDispatch(request, response);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>doDispatch方法</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//省略......</span></span><br><span class="line">       <span class="keyword">this</span>.processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">        <span class="comment">//省略......</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>processDispatchResult方法</code>,这个方法就是最终将数据交给页面的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response, @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv, @Nullable Exception exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> errorView = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//如果这里出现了异常就处理异常</span></span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line"><span class="keyword">this</span>.logger.debug(<span class="string">"ModelAndViewDefiningException encountered"</span>, exception);</span><br><span class="line"> mv = ((ModelAndViewDefiningException)exception).getModelAndView();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   Object handler = mappedHandler != <span class="keyword">null</span> ? mappedHandler.getHandler() : <span class="keyword">null</span>;</span><br><span class="line">   <span class="comment">//如果自己配置了自定义的HandlerExceptionResolver将会在这个方法里处理</span></span><br><span class="line">   mv = <span class="keyword">this</span>.processHandlerException(request, response, handler, exception);</span><br><span class="line">             errorView = mv != <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mv != <span class="keyword">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">              <span class="comment">//调用render方法进行视图渲染</span></span><br><span class="line">             <span class="keyword">this</span>.render(mv, request, response);</span><br><span class="line">            <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">                WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.logger.trace(<span class="string">"No view rendering, null ModelAndView returned."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//省略......</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>DispatcherServlet 类 的<code>render方法</code>并没有继承View接口的render,和View接口的render不是一回事，这个render仅仅是为了命名统一而起的一个名字</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="comment">//省略......</span></span><br><span class="line">   <span class="comment">//从ModelView中拿到视图名</span></span><br><span class="line">    String viewName = mv.getViewName();</span><br><span class="line">     View view;</span><br><span class="line">     <span class="keyword">if</span> (viewName != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">//这一步就是得到一个View对象，resolveViewName的实现看下边</span></span><br><span class="line">          view = <span class="keyword">this</span>.resolveViewName(viewName, mv.getModelInternal(), locale, request);</span><br><span class="line">  <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Could not resolve view with name '"</span> + mv.getViewName() + <span class="string">"' in servlet with name '"</span> + <span class="keyword">this</span>.getServletName() + <span class="string">"'"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     view = mv.getView();</span><br><span class="line">     <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"ModelAndView ["</span> + mv + <span class="string">"] neither contains a view name nor a View object in servlet with name '"</span> + <span class="keyword">this</span>.getServletName() + <span class="string">"'"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//省略......</span></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//省略......</span></span><br><span class="line">        <span class="comment">//调用了View接口的render方法，这里实际上调用的是视图在渲染时会把Model传入</span></span><br><span class="line">       view.render(mv.getModelInternal(), request, response);</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception var8) &#123;</span><br><span class="line">      <span class="comment">//省略......</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>resolveViewName方法，循环遍历你配置的视图解析器，viewResolvers是进过order排序的，这一步就是ViewResolvers是如何通过视图名产生View对象的关键</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">resolveViewName</span><span class="params">(String viewName,Map&lt;String, Object&gt; model, Locale locale, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//遍历我们配置的视图解析器</span></span><br><span class="line">    <span class="keyword">for</span> (ViewResolver viewResolver : <span class="keyword">this</span>.viewResolvers) &#123;</span><br><span class="line">       <span class="comment">//ViewResolver根据方法的返回值，得到一个View对象，这块又有一个resolveViewName，具体的实现请往下看</span></span><br><span class="line">       View view = viewResolver.resolveViewName(viewName, locale);</span><br><span class="line">       <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> view;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>InternalResourceViewResolver</code>继承了<code>AbstractCachingViewResolver</code>，resolveViewName方法首先会判断有没有缓存，要是有缓存，它会先去缓存中通过viewName查找是否有View对象的存在，要是没有，它会通过viewName创建一个新的View对象，并将View对象存入缓存中，这样再次遇到同样的视图名的时候就可以直接在缓存中取出View对象了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="comment">//判断有缓存中有没有view对象，有就直接拿来用</span></span><br><span class="line">     <span class="keyword">if</span> (!isCache()) &#123;</span><br><span class="line">         <span class="keyword">return</span> createView(viewName, locale);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> &#123;</span><br><span class="line">        Object cacheKey = getCacheKey(viewName, locale);</span><br><span class="line">        View view = <span class="keyword">this</span>.viewAccessCache.get(cacheKey);</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">synchronized</span> (<span class="keyword">this</span>.viewCreationCache) &#123;</span><br><span class="line">              view = <span class="keyword">this</span>.viewCreationCache.get(cacheKey);</span><br><span class="line">              <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="comment">//根据方法的返回值创建出View对象</span></span><br><span class="line">               view = createView(viewName, locale);</span><br><span class="line">               <span class="keyword">if</span> (view == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.cacheUnresolved) &#123;</span><br><span class="line">                    view = UNRESOLVED_VIEW;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.viewAccessCache.put(cacheKey, view);</span><br><span class="line">                    <span class="keyword">this</span>.viewCreationCache.put(cacheKey, view);</span><br><span class="line">                    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                    logger.trace(<span class="string">"Cached view ["</span> + cacheKey + <span class="string">"]"</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">               &#125;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> (view != UNRESOLVED_VIEW ? view : <span class="keyword">null</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>createView的实现细节：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">createView</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.canHandle(viewName, locale)) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        String forwardUrl;</span><br><span class="line">         <span class="comment">//如果方法得到返回值是以redirect：开始的</span></span><br><span class="line">        <span class="keyword">if</span> (viewName.startsWith(<span class="string">"redirect:"</span>)) &#123;</span><br><span class="line">           forwardUrl = viewName.substring(<span class="string">"redirect:"</span>.length());</span><br><span class="line">           RedirectView view = <span class="keyword">new</span> RedirectView(forwardUrl,             <span class="keyword">this</span>.isRedirectContextRelative(), <span class="keyword">this</span>.isRedirectHttp10Compatible());</span><br><span class="line">            String[] hosts = <span class="keyword">this</span>.getRedirectHosts();</span><br><span class="line">            <span class="keyword">if</span> (hosts != <span class="keyword">null</span>) &#123;</span><br><span class="line">               view.setHosts(hosts);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">this</span>.applyLifecycleMethods(<span class="string">"redirect:"</span>, view);</span><br><span class="line">             <span class="comment">//如果方法的返回值是以forward:开始的</span></span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewName.startsWith(<span class="string">"forward:"</span>)) &#123;</span><br><span class="line">            forwardUrl = viewName.substring(<span class="string">"forward:"</span>.length());</span><br><span class="line">            InternalResourceView view = <span class="keyword">new</span> InternalResourceView(forwardUrl);</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">this</span>.applyLifecycleMethods(<span class="string">"forward:"</span>, view);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">//其他情况的处理,这里又有一个createView，它调用了父类的createView创建了一个默认的View对象</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.createView(viewName, locale);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下都是解析视图名的实现细节，感兴趣的可以看一下。</p><p>父类<code>AbstractCachingViewResolver类</code>的createView实现细节：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">createView</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> loadView(viewName, locale);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>InternalResourceViewResolver</code>继承了<code>UrlBasedViewResolver</code><br><code>UrlBasedViewResolver类</code>中loadView方法的实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">loadView</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        AbstractUrlBasedView view = buildView(viewName);</span><br><span class="line">        View result = applyLifecycleMethods(viewName, view);</span><br><span class="line">        <span class="keyword">return</span> (view.checkResource(locale) ? result : <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>UrlBasedViewResolver的buildView方法会获取一个View对象，这个对象会将视图以什么格式呈现给用户，例如如果是jsp显示呈现给用户的话，那这个view对象就是JstlView，默认的是JstlView。在这个方法中我们看到了getPrefix() + viewName + getSuffix()这样一段代码，这就是对视图路径的一个拼接了，getPrefix()方法获取前缀，也就是我们在配置文件中配置的<code>&lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/PAGE/&quot;/&gt;</code>的value中的值了,getSuffix()方法就是获取后缀值了，也就是我们在配置文件中配置的<code>&lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</code>的value中的值。这样就将将视图的物理路径找到了，并赋值到View的URL属性中去。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> AbstractUrlBasedView <span class="title">buildView</span><span class="params">(String viewName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Class&lt;?&gt; viewClass = <span class="keyword">this</span>.getViewClass();</span><br><span class="line">   Assert.state(viewClass != <span class="keyword">null</span>, <span class="string">"No view class"</span>);</span><br><span class="line">   AbstractUrlBasedView view = (AbstractUrlBasedView)BeanUtils.instantiateClass(viewClass);</span><br><span class="line">   view.setUrl(<span class="keyword">this</span>.getPrefix() + viewName + <span class="keyword">this</span>.getSuffix());</span><br><span class="line">   String contentType = <span class="keyword">this</span>.getContentType();</span><br><span class="line">   <span class="keyword">if</span> (contentType != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view.setContentType(contentType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    view.setRequestContextAttribute(<span class="keyword">this</span>.getRequestContextAttribute());</span><br><span class="line">    view.setAttributesMap(<span class="keyword">this</span>.getAttributesMap());</span><br><span class="line">    Boolean exposePathVariables = <span class="keyword">this</span>.getExposePathVariables();</span><br><span class="line">    <span class="keyword">if</span> (exposePathVariables != <span class="keyword">null</span>) &#123;</span><br><span class="line">        view.setExposePathVariables(exposePathVariables);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   Boolean exposeContextBeansAsAttributes = <span class="keyword">this</span>.getExposeContextBeansAsAttributes();</span><br><span class="line">    <span class="keyword">if</span> (exposeContextBeansAsAttributes != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.setExposeContextBeansAsAttributes(exposeContextBeansAsAttributes);</span><br><span class="line">     &#125;</span><br><span class="line">    String[] exposedContextBeanNames = <span class="keyword">this</span>.getExposedContextBeanNames();</span><br><span class="line">    <span class="keyword">if</span> (exposedContextBeanNames != <span class="keyword">null</span>) &#123;</span><br><span class="line">        view.setExposedContextBeanNames(exposedContextBeanNames);</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就这样我们得到了一个View对象，这个视图的name就是逻辑视图名，因为当将View对象放在缓存的时候，我们可以通过逻辑视图名在缓存中找出View对象。我们在获取到View对象的时候，我们还要将View进行渲染，并呈现给用户。</p><p>View是个接口,AbstractView实现了render方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(@Nullable Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">         <span class="keyword">this</span>.logger.debug(<span class="string">"View "</span> + <span class="keyword">this</span>.formatViewName() + <span class="string">", model "</span> + (model != <span class="keyword">null</span> ? model : Collections.emptyMap()) + (<span class="keyword">this</span>.staticAttributes.isEmpty() ? <span class="string">""</span> : <span class="string">", static attributes "</span> + <span class="keyword">this</span>.staticAttributes));</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="comment">//主要是将一些属性填充到Map中</span></span><br><span class="line">   Map&lt;String, Object&gt; mergedModel = <span class="keyword">this</span>.createMergedOutputModel(model, request, response);</span><br><span class="line">    <span class="comment">//对response头进行了一些属性设置</span></span><br><span class="line">    <span class="keyword">this</span>.prepareResponse(request, response);</span><br><span class="line">    <span class="comment">//渲染给页面输出的所有model数据</span></span><br><span class="line">    <span class="keyword">this</span>.renderMergedOutputModel(mergedModel, <span class="keyword">this</span>.getRequestToExpose(request), response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后一行的renderMergedOutputModel方法由AbstractView的孙子类InternalResourceView实现InternalResourceView的renderMergedOutputModel方法帮我们获取到视图的物理路径，然后将这段路径传给RequestDispatcher对象，再调用RequestDispatcher的forward方法将页面呈现给用户，这样就走完了视图的解析了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">renderMergedOutputModel</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Expose the model object as request attributes.</span></span><br><span class="line">     exposeModelAsRequestAttributes(model, request);</span><br><span class="line">    <span class="comment">// Expose helpers as request attributes, if any.</span></span><br><span class="line">    exposeHelpers(request);</span><br><span class="line">    <span class="comment">// Determine the path for the request dispatcher.</span></span><br><span class="line">    String dispatcherPath = prepareForRendering(request, response);</span><br><span class="line">    <span class="comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).</span></span><br><span class="line">    RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);</span><br><span class="line">    <span class="keyword">if</span> (rd == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Could not get RequestDispatcher for ["</span> + getUrl() + <span class="string">"]: Check that the corresponding file exists within your web application archive!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// If already included or response already committed, perform include, else forward.</span></span><br><span class="line">        <span class="keyword">if</span> (useInclude(request, response)) &#123;</span><br><span class="line">            response.setContentType(getContentType());</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">             logger.debug(<span class="string">"Including resource ["</span> + getUrl() + <span class="string">"] in InternalResourceView '"</span> + getBeanName() + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            rd.include(request, response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Note: The forwarded resource is supposed to determine the content type itself.</span></span><br><span class="line">          <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">"Forwarding to resource ["</span> + getUrl() + <span class="string">"] in InternalResourceView '"</span> + getBeanName() + <span class="string">"'"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">             <span class="comment">//对请求进行转发，至此结束了视图解析解析过程</span></span><br><span class="line">           rd.forward(request, response);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>最后一句话总结：<br><font color="red">视图解析器只是为了得到视图对象；视图对象才是真正的转发（将模型数据发在request域中数据）或重定向到页面（视图对象才是真正的渲染视图）。</font></strong></p><center><a href="https://sm.ms/image/uheCvrxoblOK73t" target="_blank"><img src="https://i.loli.net/2019/08/07/uheCvrxoblOK73t.png"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;SpringMVC视图解析&quot;&gt;&lt;a href=&quot;#SpringMVC视图解析&quot; class=&quot;headerlink&quot; title=&quot;SpringMVC视图解析&quot;&gt;&lt;/a&gt;SpringMVC视图解析&lt;/h3&gt;&lt;p&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;对于控制器
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC处理模型参数</title>
    <link href="http://easyblog.top/2019/08/07/SpringMVC-%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0/"/>
    <id>http://easyblog.top/2019/08/07/SpringMVC-处理模型参数/</id>
    <published>2019-08-07T06:14:42.000Z</published>
    <updated>2019-08-15T06:16:28.409Z</updated>
    
    <content type="html"><![CDATA[<h4 id="SpringMVC-提供了以下几种途径输出模型数据"><a href="#SpringMVC-提供了以下几种途径输出模型数据" class="headerlink" title="SpringMVC 提供了以下几种途径输出模型数据:"></a>SpringMVC 提供了以下几种途径输出模型数据:</h4><ul><li><strong><font color="red" size="4">ModelAndView</font></strong>: 处理方法返回值类型为 ModelAndView时, 方法体即可通过该对象添加模型数据</li><li><strong><font color="red" size="4">Map、Model以及ModelMap</font></strong>:入参为org.springframework.ui.Model、org.springframework.ui.ModelMap 或 Java.uti.Map 时，处理方法返回时，Map中的数据会自动添加到模型中。</li><li><strong><font color="red" size="4">@SessionAttributes</font></strong>: 将模型中的某个属性暂存到HttpSession 中，以便多个请求之间可以共享这个属性</li><li><strong><font color="red" size="4"> @ModelAttribute</font></strong>: 方法入参标注该注解后, 入参的对象就会放到数据模型中。</li><li>当然，除了上面这些SpringMVC提供的几种方法，SpringMVC支持直接使用Servlet几个原生API来给页面传值: <code>HttpServletRequest request</code>、<code>HttpservletResponse response</code>、<code>HttpSession session</code>、<code>InputStream/Reader 对应request.getInputStream()</code>、<code>OutputStream/Writer 对应response.getOutputStram()</code><hr></li></ul><h4 id="servlet原生API给页面传值"><a href="#servlet原生API给页面传值" class="headerlink" title="servlet原生API给页面传值"></a><font color="green">servlet原生API给页面传值</font></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 使用servlet原生API给页面输出数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"handler01"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">handler01</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                         HttpSession session)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">     request.setAttribute(<span class="string">"msg"</span>,<span class="string">"你好，这是HelloController"</span>);</span><br><span class="line">     session.setAttribute(<span class="string">"msg"</span>,<span class="string">"json123"</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>页面测试代码:<code>success.jsp</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;成功&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;table border=<span class="string">"1px"</span> width=<span class="string">"70%"</span> &gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;域&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;值&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;requestScope&lt;/th&gt;</span><br><span class="line">            &lt;td&gt;$&#123;requestScope.msg&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;sessionScope&lt;/th&gt;</span><br><span class="line">            &lt;td&gt;$&#123;sessionScope.msg&#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;applicationScope&lt;/th&gt;</span><br><span class="line">            &lt;td&gt;$&#123;applicationScope.msg&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;pageScope&lt;/th&gt;</span><br><span class="line">            &lt;td&gt;$&#123;pageScope.msg&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>测试结果：<br><a href="https://sm.ms/image/eXMQwoIg9RShkpB" target="_blank"><img src="https://i.loli.net/2019/08/07/eXMQwoIg9RShkpB.png"></a></p><h4 id="Model、Map、ModelMap"><a href="#Model、Map、ModelMap" class="headerlink" title="Model、Map、ModelMap"></a><font color="green">Model、Map、ModelMap</font></h4><p>首先通过通过源码看看他们三者的关系：<br><code>ModelMap类</code><br><a href="https://sm.ms/image/uYWZTjhPgtSNFGd" target="_blank"><img src="https://i.loli.net/2019/08/07/uYWZTjhPgtSNFGd.png"></a></p><p><code>Model接口</code><br><a href="https://sm.ms/image/y4p71xTtdgYvLhE" target="_blank"><img src="https://i.loli.net/2019/08/07/y4p71xTtdgYvLhE.png"></a></p><p><code>ExtendModelMap类</code><br><a href="https://sm.ms/image/2m6PHJQB1YnsNxr" target="_blank"><img src="https://i.loli.net/2019/08/07/2m6PHJQB1YnsNxr.png"></a></p><p><code>BindingAwareModelMap类</code><br><a href="https://sm.ms/image/xNhiS56XRomwGry" target="_blank"><img src="https://i.loli.net/2019/08/07/xNhiS56XRomwGry.png"></a></p><p>通过打开源码，我们不难总结出如下继承关系 ：<br><cneter><a href="https://sm.ms/image/PdKHb7CpqkMWYDR" target="_blank"><img src="https://i.loli.net/2019/08/14/PdKHb7CpqkMWYDR.jpg" width="100%"></a></cneter></p><p><font size="4">接下来看看他们的用法：</font><br><font size="3">示例代码</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用Model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler02"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler02</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Model"</span>+model.getClass());</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"大家好！这是handler02"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"id"</span>,<span class="number">18</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用Map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler03"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler03</span><span class="params">(Map&lt;String,String&gt; map)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Map:"</span>+map.getClass());</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"handler03"</span>);</span><br><span class="line">        map.put(<span class="string">"logged"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用ModelMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler04"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler04</span><span class="params">(ModelMap modelMap)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ModelMap:"</span>+modelMap.getClass());</span><br><span class="line">        modelMap.addAttribute(<span class="string">"msg"</span>,<span class="string">"handler04"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>页面代码和上面样</p><p>测试结果：<br>页面的显示：<br><a href="https://sm.ms/image/WvtYzBmaxk7LfMK" target="_blank"><img src="https://i.loli.net/2019/08/07/WvtYzBmaxk7LfMK.png"></a></p><p><a href="https://sm.ms/image/YpJWiH5dQwhSykj" target="_blank"><img src="https://i.loli.net/2019/08/07/YpJWiH5dQwhSykj.png"></a></p><p><a href="https://sm.ms/image/vIikTXWz3tnCubS" target="_blank"><img src="https://i.loli.net/2019/08/07/vIikTXWz3tnCubS.png"></a></p><p>控制台打印的信息:<br><a href="https://sm.ms/image/TvnF316kMtj2lw7" target="_blank"><img src="https://i.loli.net/2019/08/07/TvnF316kMtj2lw7.png"></a></p><blockquote><p> <strong>从测试结果可以总结出：<br>Model(SpringMVC接口)其中一个实现类是ExtendedModelMap<br>ModelMap是Map(JDK的接口)Map的一个实现类,并且ModelMap被ExtendedModelMap<br>ExtendedModelMap被BindingAwareModelMap继承<br>Model、Map、ModelMap不论用哪个，最终工作的都是BindingAwareModelMap,而且从测试结果可以看到通过这三个设置的值，SpringMVC都把他们放在了request域中。</strong></p></blockquote><h4 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a><font color="green">ModelAndView</font></h4><blockquote><p>目标方法的返回值可以是ModelAndView类型，从名字上就可以看到，这是一个既包括模型(Model)又有视图(View)的一个类， 然而事实也确实如此，他的model就可以理解为送给页面的数据，他的View可以理解为目标页面地址。但我们在他的model中放入值后，SpringMVC会把ModelAndView的model中数据放在request域对象中。</p></blockquote><p><font size="3">示例代码</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法的返回值可以是 ModelAndView类型，这样我们可以把值设置在model中</span></span><br><span class="line"><span class="comment"> * 然后springmvc会把ModelAndView的model中数据放在request域对象中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/handler05"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handler05</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView(<span class="string">"success"</span>);</span><br><span class="line">    mv.addObject(<span class="string">"msg"</span>,<span class="string">"handler05"</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：<br><a href="https://sm.ms/image/qjsTKIJvu4V7Qa6" target="_blank"><img src="https://i.loli.net/2019/08/07/qjsTKIJvu4V7Qa6.png"></a></p><h4 id="使用-SessionAttributes注解"><a href="#使用-SessionAttributes注解" class="headerlink" title="使用@SessionAttributes注解"></a><font color="green">使用@SessionAttributes注解</font></h4><p>如果希望在多个请求之间共用某个模型属性数据，则可以在控制器类标注一个 @SessionAttributes，SpringMVC 会将模型中对应的属性暂存到 HTTPSession 中。<br>@SessionAttributes 除了可以通过属性名指定需要放到会话中的属性外，还可以通过模型属性的对象类型指定哪些模型属性需要放到会话中。</p><ol><li>@SessionAttributes(types=User.class)会将隐含模型中所有类型为 User 的属性添加到会话中</li><li>@SessionAttributes(value={“user1”, “user2”})将名为 user1 和 user2 的模型属性添加到会话中</li><li>@SessionAttributes(types={“User.class”, “Dept.class”})将模型中所有类型为 User 及 Dept 的属性添加到会话中</li><li>@SessionAtributes(value={“user1”, “user2”}, types={Dept.class})将名为 user1 和 user2 的模型属性添加到会话中，同时将所有类型为 Dept 的模型属性添加到会话中<br><strong>总之：<br>当使用@SessionAttributes注解时就是告诉SpringMVC,当@SessionAttributes中的value值和BindingAwareModelMap的key一样时，那么在session也你也给我保存一份相同的值</strong><br><font size="4">示例代码：</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用的时候一定要注意@SessionAttributes只能用在类上</span></span><br><span class="line"><span class="meta">@SessionAttributes</span>(value=&#123;<span class="string">"id"</span>,<span class="string">"logged"</span>&#125;)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler0"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sessionAttributesTest</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"handler0"</span>);   <span class="comment">//这个会在request中显示</span></span><br><span class="line">        model.addAttribute(<span class="string">"logged"</span>,<span class="keyword">new</span> Date());   <span class="comment">//会在session中显示</span></span><br><span class="line">        model.addAttribute(<span class="string">"id"</span>,<span class="string">"001"</span>);         <span class="comment">//会在session中显示</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>页面代码对success.jsp中的sessionScope稍作修改：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;tr&gt;</span><br><span class="line">     &lt;th&gt;sessionScope&lt;/th&gt;</span><br><span class="line">     &lt;td&gt;$&#123;sessionScope.msg&#125; | $&#123;sessionScope.id&#125; |$&#123;sessionScope.logged&#125;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br></pre></td></tr></table></figure><p>测试结果：<br><a href="https://sm.ms/image/rpLn2aQ73EdJcPS" target="_blank"><img src="https://i.loli.net/2019/08/07/rpLn2aQ73EdJcPS.png"></a></p><h4 id="使用-ModelAttribute注解"><a href="#使用-ModelAttribute注解" class="headerlink" title="使用@ModelAttribute注解"></a>使用@ModelAttribute注解</h4><p>先来看看ModelAttribute的定义：<br><a href="https://sm.ms/image/LZCvYSrNxUJts8m" target="_blank"><img src="https://i.loli.net/2019/08/07/LZCvYSrNxUJts8m.png"></a><br>查看 @ModelAttribute注解定义可以看到这个注解可以用在方法和参数中。 在 SpringMVC 的 Controller 中使用 @ModelAttribute 时，应用情况包括下面几种：<br>1、应用在方法上。<br>2、应用在方法的参数上。<br>3、应用在方法上，并且方法也使用了@RequestMapping</p><p><font size="4">示例代码：</font><br>修改图书信息的页面：</p><figure class="highlight htmlbars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SpringMVC给页面输出数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!--    &lt;a href="handler01"&gt;原生API输出数据&lt;/a&gt;&lt;br/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler02"</span>&gt;</span>Model输出数据<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler03"</span>&gt;</span>Map输出数据<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler04"</span>&gt;</span>ModelMap输出数据<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"handler05"</span>&gt;</span>ModelAndView带回返回值<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>--&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>更新图书信息<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"update"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        书名：<span class="tag">&lt;<span class="name">label</span>&gt;</span>西游记<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        作者：<span class="tag">&lt;<span class="name">label</span>&gt;</span>吴承恩<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">placeholder</span>=<span class="string">"输入价格..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        库存：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"stock"</span> <span class="attr">placeholder</span>=<span class="string">"输入库存..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        销量：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"sales"</span> <span class="attr">placeholder</span>=<span class="string">"输入销量..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提交信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>提交图书修改信息后的页面：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: Administrator</span><br><span class="line">  Date: <span class="number">2019</span>/<span class="number">8</span>/<span class="number">7</span></span><br><span class="line">  Time: <span class="number">10</span>:<span class="number">34</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;更新图书&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;div style=<span class="string">"height: 200px;width: 100%"</span>&gt;</span><br><span class="line">        &lt;h3&gt;提交的书籍的信息：&lt;/h3&gt;</span><br><span class="line">        &lt;table border=<span class="string">"1px"</span> width=<span class="string">"50%"</span>&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;书名&lt;/th&gt;&lt;td&gt;$&#123;book.name&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;作者&lt;/th&gt;&lt;td&gt;$&#123;book.author&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;价格&lt;/th&gt;&lt;td&gt;$&#123;book.price&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;库存&lt;/th&gt;&lt;td&gt;$&#123;book.stock&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;销量&lt;/th&gt;&lt;td&gt;$&#123;book.sales&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>如果没有使用@ModelAttribute，那么要更新数据信息，必须要全字段更新，即使你不需要更新的的字段，你也要填写，这显然不和常理，因为如果你不填写这个值，值就会为null。最主要是因为SpringMVC在封装提交的信息的时候只会new一个Book对象，里面的属性的值初始就是null。你没有填写也只会以null存到数据库。<br><strong>不使用@ModelAttribute进行非全字段更新</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(Book book)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"更新图书的信息......页面提交过来的图书信息："</span>+book);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"updateBook"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>测试结果:<br>页面的显示：<br><a href="https://sm.ms/image/VEDqmp1C9kXRhM5" target="_blank"><img src="https://i.loli.net/2019/08/07/VEDqmp1C9kXRhM5.png"></a></p><p><a href="https://sm.ms/image/FmjsoYHJQc7DCBA" target="_blank"><img src="https://i.loli.net/2019/08/07/FmjsoYHJQc7DCBA.png"></a></p><p>看看控制台的打印信息：<br><a href="https://sm.ms/image/PCKZOAcpzXdSfrT" target="_blank"><img src="https://i.loli.net/2019/08/07/PCKZOAcpzXdSfrT.png"></a></p><p>可以看到果然不出预料的出问题了，更新信息后书名和作者的信息没了。这就相当于你更改了一下你的QQ密码，然后你的QQ号没了！这是很可怕的事情。<br>使用@ModelAttribute解决问题：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.Contorller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> bean.Address;</span><br><span class="line"><span class="keyword">import</span> bean.Book;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用在方法上：这个方法就会优先于该类中的左右处理器方法先执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getBook</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="comment">//模拟从数据库中查询图书数据</span></span><br><span class="line">        Book book=<span class="keyword">new</span> Book();</span><br><span class="line">        book.setName(<span class="string">"西游记"</span>);</span><br><span class="line">        book.setPrice(<span class="number">9.98</span>);</span><br><span class="line">        book.setAuthor(<span class="string">"吴承恩"</span>);</span><br><span class="line">        book.setSales(<span class="number">300</span>);</span><br><span class="line">        book.setStock(<span class="number">400</span>);</span><br><span class="line">        System.out.println(<span class="string">"数据库中查询到Book的信息："</span>+book);</span><br><span class="line">        map.put(<span class="string">"book"</span>,book);</span><br><span class="line">        System.out.println(<span class="string">"ModelAttribute将查询到的图书信息保存起来.......："</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可以告诉SpringMVC,你不要去new Book对象了，我已经从数据库中查询到了，你直接拿过去用就好了。</span></span><br><span class="line"><span class="comment">     * 问题是：如何告诉SpringMVC来用这个已经处理好的Book对象呢？</span></span><br><span class="line"><span class="comment">     * 这就是<span class="doctag">@ModelAttribute</span>在参数位置的用法：</span></span><br><span class="line"><span class="comment">     * 下面的<span class="doctag">@ModelAttribute</span>("book")，就是告诉SpringMVC，去拿一个key为</span></span><br><span class="line"><span class="comment">     * book的值，你不要重新new一个Book对象了，这样做的好处是可以只更改有更新的数据，没有更新的就保持原始值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(@ModelAttribute(<span class="string">"book"</span>)</span> Book book)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"更新图书的信息......页面提交过来的图书信息："</span>+book);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"updateBook"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>测试结果：<br>页面展示的结果：</p><p><a href="https://sm.ms/image/oHbxw4j9AdvWeis" target="_blank"><img src="https://i.loli.net/2019/08/07/oHbxw4j9AdvWeis.png"></a></p><p>控制台打印的信息：<br><a href="https://sm.ms/image/TODtoyBfzX9N4si" target="_blank"><img src="https://i.loli.net/2019/08/07/TODtoyBfzX9N4si.png"></a></p><p>而且从控制台打印的信息来看，被@ModelAttribute标识的方法确实是在处理器方法之前执行了</p><h5 id="Modelattribute的原理"><a href="#Modelattribute的原理" class="headerlink" title="@Modelattribute的原理"></a>@Modelattribute的原理</h5><p>废话不多说，直接看代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.Contorller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> bean.Address;</span><br><span class="line"><span class="keyword">import</span> bean.Book;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: HuangXin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: Created in 10:33 2019/8/7</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object obj1;</span><br><span class="line">    <span class="keyword">private</span> Object b1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可以告诉SpringMVC,你不要去new Book对象了，我已经从数据库中查询到了，你直接拿过去用就好了。</span></span><br><span class="line"><span class="comment">     * 问题是：如何告诉SpringMVC来用这个已经处理好的Book对象呢？</span></span><br><span class="line"><span class="comment">     * 这就是<span class="doctag">@ModelAttribute</span>在参数位置的用法：</span></span><br><span class="line"><span class="comment">     * 下面的<span class="doctag">@ModelAttribute</span>("book")，就是告诉SpringMVC，你去拿一个key为book的值，</span></span><br><span class="line"><span class="comment">     * 你不要重新new一个Book对象了</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(@ModelAttribute(<span class="string">"book"</span>)</span> Book book, Map&lt;String,Object&gt; model)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"处理器方法的map:"</span>+model.getClass());</span><br><span class="line">        System.out.println(<span class="string">"book==b1=&gt;"</span>+(book==b1));</span><br><span class="line">        System.out.println(<span class="string">"obj1==model=&gt;"</span>+(obj1==model));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"更新图书的信息......页面提交过来的图书信息："</span>+book);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"updateBook"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用在方法上：这个方法就会优先于该类中的左右处理器方法先执行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getBook</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="comment">//模拟从数据库中拿数据</span></span><br><span class="line">        Book book=<span class="keyword">new</span> Book();</span><br><span class="line">        book.setName(<span class="string">"西游记"</span>);</span><br><span class="line">        book.setPrice(<span class="number">9.98</span>);</span><br><span class="line">        book.setAuthor(<span class="string">"吴承恩"</span>);</span><br><span class="line">        book.setSales(<span class="number">300</span>);</span><br><span class="line">        book.setStock(<span class="number">400</span>);</span><br><span class="line">        System.out.println(<span class="string">"数据库中查询到Book的信息："</span>+book);</span><br><span class="line"></span><br><span class="line">        obj1=map;</span><br><span class="line">        b1=book;</span><br><span class="line">        map.put(<span class="string">"book"</span>,book);</span><br><span class="line">        System.out.println(<span class="string">"@ModelAttribute中的map:"</span>+map.getClass());</span><br><span class="line">        System.out.println(<span class="string">"ModelAttribute将查询到的图书信息保存起来.......："</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：<br><a href="https://sm.ms/image/26Zl3AnfXPmDoNg" target="_blank"><img src="https://i.loli.net/2019/08/07/26Zl3AnfXPmDoNg.png"></a></p><p>最后总结为一张图：<br><a href="https://sm.ms/image/2TzY8fFvo6yJmdO" target="_blank"><img src="https://i.loli.net/2019/08/07/2TzY8fFvo6yJmdO.png"></a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;SpringMVC-提供了以下几种途径输出模型数据&quot;&gt;&lt;a href=&quot;#SpringMVC-提供了以下几种途径输出模型数据&quot; class=&quot;headerlink&quot; title=&quot;SpringMVC 提供了以下几种途径输出模型数据:&quot;&gt;&lt;/a&gt;SpringMVC 
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC获取请求参数</title>
    <link href="http://easyblog.top/2019/08/06/Springmvc/"/>
    <id>http://easyblog.top/2019/08/06/Springmvc/</id>
    <published>2019-08-06T11:24:59.000Z</published>
    <updated>2019-08-11T16:11:46.079Z</updated>
    
    <content type="html"><![CDATA[<h4 id="第一种方式：方法的形参上给一个和请求参数同名的参数"><a href="#第一种方式：方法的形参上给一个和请求参数同名的参数" class="headerlink" title="第一种方式：方法的形参上给一个和请求参数同名的参数"></a>第一种方式：方法的形参上给一个和请求参数同名的参数</h4><h5 id="1-获得普通类型的参数值"><a href="#1-获得普通类型的参数值" class="headerlink" title="1.获得普通类型的参数值"></a>1.获得普通类型的参数值</h5><p><font size="4">示例代码</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第1种获得请求参数的方式：在方法的形参上给一个和请求参数同名的参数，</span></span><br><span class="line"><span class="comment"> *  之后SpringMVC会帮我们自动注入参数值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/welcome"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">welcome</span><span class="params">(String username, Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"用户名："</span>+username);</span><br><span class="line">    model.addAttribute(<span class="string">"username"</span>,username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-获得POJO类型的值"><a href="#2-获得POJO类型的值" class="headerlink" title="2.获得POJO类型的值"></a>2.获得POJO类型的值</h5><p><font size="4">示例代码：</font><br>新建Book.java以及Address.java两个POJO<br><code>Book.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;   <span class="comment">//库存</span></span><br><span class="line">    <span class="keyword">private</span> Integer sales;   <span class="comment">//销量</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Address address;  <span class="comment">//地址</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略getter、setter方法，并且重写toString()方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Address.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String county;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略getter、setter方法，并且重写toString()方法</span></span><br></pre></td></tr></table></figure><p>写一个简单的表单：<br><code>index.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SpringMvc获取参数<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>录入书籍信息<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"book"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        书名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">placeholder</span>=<span class="string">"输入书名..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">placeholder</span>=<span class="string">"输入作者..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">placeholder</span>=<span class="string">"输入价格..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        库存：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"stock"</span> <span class="attr">placeholder</span>=<span class="string">"输入库存..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        销量：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"sales"</span> <span class="attr">placeholder</span>=<span class="string">"输入销量..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span>省&amp;nbsp;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span>市&amp;nbsp;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"address.county"</span> /&gt;</span>(区/县)&amp;nbsp;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提交信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>提交后的页面：<br><code>book.jsp</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span></span><br><span class="line">    <span class="keyword">import</span>=<span class="string">"com.xzy.bean.*"</span></span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;SpringMVC获取参数&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;div style=<span class="string">"height: 200px;width: 100%"</span>&gt;</span><br><span class="line">        &lt;h3&gt;提交的书籍的信息：&lt;/h3&gt;</span><br><span class="line">        &lt;table border=<span class="string">"1px"</span> width=<span class="string">"50%"</span>&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;书名&lt;/th&gt;&lt;td&gt;$&#123;book.name&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;作者&lt;/th&gt;&lt;td&gt;$&#123;book.author&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;价格&lt;/th&gt;&lt;td&gt;$&#123;book.price&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;库存&lt;/th&gt;&lt;td&gt;$&#123;book.stock&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;销量&lt;/th&gt;&lt;td&gt;$&#123;book.sales&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;&lt;th&gt;地区&lt;/th&gt;&lt;td&gt;$&#123;book.address&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>提供一个控制器：<br><code>BookContorller.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Book;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookContorller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * SprningMVC帮我们自动注入参数到POJO类型中，而且还可以级联注入</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/book"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addbook</span><span class="params">(Book book, HttpServletRequest request)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印得到的book信息</span></span><br><span class="line">        System.out.println(book);</span><br><span class="line">        request.setAttribute(<span class="string">"book"</span>,book);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"book"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：<br><img src="https://i.loli.net/2019/08/06/faohYdzNDuIHK8X.png" alt="QQ截图20190804124754.png"><br><img src="https://i.loli.net/2019/08/06/WJq562cSw3K4Ven.png" alt="20190804124807.png"></p><h4 id="第二种方式：使用Spring提供的注解"><a href="#第二种方式：使用Spring提供的注解" class="headerlink" title="第二种方式：使用Spring提供的注解"></a>第二种方式：使用Spring提供的注解</h4><h5 id="1-使用-RequestParam-获取参数"><a href="#1-使用-RequestParam-获取参数" class="headerlink" title="1. 使用@RequestParam 获取参数"></a>1. 使用@RequestParam 获取参数</h5><p>分析<code>@RequestParam</code>的源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestParam &#123;</span><br><span class="line">    <span class="comment">//默认值就是它，表示请求参数的key</span></span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"name"</span>)</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">//请求参数的值</span></span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;  </span><br><span class="line">    </span><br><span class="line">   <span class="comment">//设置这个参数是否必须，required=false表示这个参数不是必须的</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;   </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//参数的默认值</span></span><br><span class="line">    <span class="function">String <span class="title">defaultValue</span><span class="params">()</span> <span class="keyword">default</span> "\n\t\t\n\t\t\n\ue000\ue001\ue002\n\t\t\t\t\n"</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font size="4">示例代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RequestParam设置获取参数的key为user,required=false表示这个参数不是必须的，</span></span><br><span class="line"><span class="comment"> * defaultValue是这个参数的默认值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RequestParam</span>(value = "user", required = false, defaultValue = "") String username；</span></span><br><span class="line"><span class="comment"> * 等价于以前写的：</span></span><br><span class="line"><span class="comment"> * String user=null!=request.getParameter("user")?request.getParameter("user"):"";</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/welcome3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">welocme3</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestParam(value = <span class="string">"user"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">""</span>)</span> String username, Model model) </span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"用户名："</span> + username);</span><br><span class="line"></span><br><span class="line">    model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-使用-RequestHeader获得请求的头部信息"><a href="#2-使用-RequestHeader获得请求的头部信息" class="headerlink" title="2.使用@RequestHeader获得请求的头部信息"></a>2.使用@RequestHeader获得请求的头部信息</h5><p><code>@RequestHeader</code>和<code>@ReuqestParma</code>的实现方式如出一辙，使用方法也基本相同。<br><font size="4">示例代码1：</font>使用RequestHeader注解获得浏览器的信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  <span class="doctag">@RequestHeader</span>(value = "User-Agent",required = false,defaultValue = "") String userAgent</span></span><br><span class="line"><span class="comment">    *  获取请求头中的值，相当于以前写的：</span></span><br><span class="line"><span class="comment">    *  String header=null!=request.getHeader("User-Agent")?      request.getHeader("User-Agent"):"";</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userAgent</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/welcome4"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">welocme4</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">           @RequestParam(value = <span class="string">"user"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">""</span>)</span> String username,</span></span><br><span class="line"><span class="function">           @<span class="title">RequestHeader</span><span class="params">(value = <span class="string">"User-Agent"</span>,defaultValue = <span class="string">""</span>)</span> String userAgent,</span></span><br><span class="line"><span class="function">           Model model) </span>&#123;</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">"用户名："</span> + username);</span><br><span class="line">       System.out.println(<span class="string">"User-Agent"</span>+userAgent);</span><br><span class="line">       model.addAttribute(<span class="string">"userAgent"</span>,userAgent);</span><br><span class="line">       model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><font size="4">示例代码2：</font>使用RequestHeader注解获取请求头部的Cookie信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用RequestHeader获得请求头中的Cookie的全部信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> cookie</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/welcome5"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">welocome5</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">           @RequestParam(value = <span class="string">"user"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">""</span>)</span> String username,</span></span><br><span class="line"><span class="function">           @<span class="title">RequestHeader</span><span class="params">(value = <span class="string">"Cookie"</span>,required = <span class="keyword">false</span>,defaultValue = <span class="string">""</span>)</span> String cookie,</span></span><br><span class="line"><span class="function">            Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">"用户名："</span> + username);</span><br><span class="line">       model.addAttribute(<span class="string">"cookie"</span>,cookie);</span><br><span class="line">       model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h5 id="3-使用CookieValue获得请求头部的JSESSIONID"><a href="#3-使用CookieValue获得请求头部的JSESSIONID" class="headerlink" title="3.使用CookieValue获得请求头部的JSESSIONID"></a>3.使用CookieValue获得请求头部的JSESSIONID</h5><p><font size="4">示例代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用SpringMVC提供的<span class="doctag">@CookieValue</span>注解，可以只获的JSESSIONID的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cookie</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/welcome6"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">welocome6</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @RequestParam(value = <span class="string">"user"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">""</span>)</span> String username,</span></span><br><span class="line"><span class="function">            @<span class="title">CookieValue</span><span class="params">(value = <span class="string">"JSESSIONID"</span> ,required = <span class="keyword">false</span>,defaultValue = <span class="string">""</span>)</span> String cookie,</span></span><br><span class="line"><span class="function">            Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"用户名："</span> + username);</span><br><span class="line">        model.addAttribute(<span class="string">"cookie"</span>,cookie);</span><br><span class="line">        model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"cookie："</span>+cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;第一种方式：方法的形参上给一个和请求参数同名的参数&quot;&gt;&lt;a href=&quot;#第一种方式：方法的形参上给一个和请求参数同名的参数&quot; class=&quot;headerlink&quot; title=&quot;第一种方式：方法的形参上给一个和请求参数同名的参数&quot;&gt;&lt;/a&gt;第一种方式：方法的形参
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC 对Ant风格和Rest风格支持</title>
    <link href="http://easyblog.top/2019/08/04/SpringMVC%E6%94%AF%E6%8C%81%E7%9A%84%E5%87%A0%E7%A7%8D%E9%A3%8E%E6%A0%BC%E7%9A%84URL%E5%BD%A2%E5%BC%8F/"/>
    <id>http://easyblog.top/2019/08/04/SpringMVC支持的几种风格的URL形式/</id>
    <published>2019-08-04T10:16:40.000Z</published>
    <updated>2019-08-17T16:27:16.664Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Ant风格的URL形式"><a href="#Ant风格的URL形式" class="headerlink" title="Ant风格的URL形式"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">Ant风格的URL形式</font></div></h4><p><font color="black">Ant风格的URL指的是URL的路径可以写成模糊路径，然后Spring MVC会帮我们匹配，</font></p><ul><li><font color="black"><strong>  ?：匹配一个字符</strong></font></li><li><font color="black"> <strong> *: 匹配多个字符以及一层URL路径</strong></font></li><li><font color="black"> <strong> **:可以匹配多个字符以及多层路径</strong></font></li><li><font color="black"><strong> 匹配的规则：以最精确的路径为准，就是说当有多个路径可以匹配的时候，以最精确的路径为目标去访问</strong></font></li></ul><p><font color="black">示例代码：</font><br><font color="black">新建AntTestServlet.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Ant风格的URL指的是URL的路径可以写成模糊路径，然后Spring MVC会帮我们匹配</span></span><br><span class="line"><span class="comment"> *     ?：匹配一个字符</span></span><br><span class="line"><span class="comment"> *     *: 匹配多个字符以及一层URL路径</span></span><br><span class="line"><span class="comment"> *     **:可以匹配多个字符以及多层路径</span></span><br><span class="line"><span class="comment"> * 匹配的规则：以最精确的路径为准，就是说当有多个路径可以匹配的时候，以最精确的路径为目标去访问</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/ant"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AntTestServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"访问了handler1()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//?可以匹配一个字符（“/”除外）,0个和多个都不行</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"访问了handler2()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//*可以匹配任意多个字符</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/handler*"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"访问了handler3()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 匹配一层路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test/*/handler*"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"访问了handler4()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *匹配多层路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test/**/handler*"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"访问了handler5()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font size="4">测试结果:</font></p><center><a href="https://sm.ms/image/RUYOz6G7yvfMgaF" target="_blank"><img src="https://i.loli.net/2019/08/17/RUYOz6G7yvfMgaF.gif"></a></center><h4 id="PathVariable-路径占位符"><a href="#PathVariable-路径占位符" class="headerlink" title="@PathVariable  路径占位符"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">@PathVariable  路径占位符</font></div></h4><p><font color="black">使用<strong>@PathVariable </strong>注解可以获得路径中占位符的值</font><br><font color="black">示例代码:</font></p><center><a href="https://sm.ms/image/zXY6i7qFnoJahHW" target="_blank"><img src="https://i.loli.net/2019/08/17/zXY6i7qFnoJahHW.png"></a></center><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/S3JlFHu7EZ8qB5o" target="_blank"><img src="https://i.loli.net/2019/08/17/S3JlFHu7EZ8qB5o.gif"></a></center><h4 id="REST风格的URL形式"><a href="#REST风格的URL形式" class="headerlink" title="REST风格的URL形式"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">REST风格的URL形式</font></div></h4><p><font color="black">编写一个控制器BooKContorller，模拟业务处理，里面写上增删改查的基本方法，然后定义不同的方法只有不同的请求才可以访问。</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookContorller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"book/&#123;bookId&#125;"</span>,method = RequestMethod.PUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">addBook</span><span class="params">(Model model,@PathVariable String bookId)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"添加了一本书,书的Id是："</span>+bookId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"book/&#123;bookId&#125;"</span>,method = RequestMethod.DELETE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">deleteBook</span><span class="params">(Model model,@PathVariable String bookId)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"删除了一本书,书的Id是："</span>+bookId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"book/&#123;bookId&#125;"</span>,method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">updateBook</span><span class="params">(Model model,@PathVariable String bookId)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"更新了一本书,书的Id是："</span>+bookId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"book/&#123;bookId&#125;"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">getBook</span><span class="params">(Model model,@PathVariable String bookId)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"查询了一本书,书的Id是："</span>+bookId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">但是页面上只能发出GET 和POST两种请求，如何解决delete和put请求呢？<br>对于这个问题，SpringMVC中也给予了支持，即<code>org.springframework.web.filter.HiddenHttpMethodFilter</code>这个过滤器，只需要我们在web.xml中配置一个关于请求方法的过滤器：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Http所有method的过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">然后在一个带有POST请求的表单里加入<code>&lt;input name=&quot;_method&quot; value=&quot;请求方法名&quot;&gt;</code>，value后面就填写需要的请求方法名即可。</font></p><figure class="highlight htmlbars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>@RequestMapping测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"book/1"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"bookId"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>查询一本书<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"book/1"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"delete"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>删除一本书<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"book/1"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>增加一本书<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"book/1"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>更新一本书<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><font color="black">运行后会有一个问题：GET和POST的参数可以正常处理，但是当DELETE和PUT请求的时候，就会有下面的异常：</font></p><center><a href="https://sm.ms/image/NYGuWnpH94rJ7Fc" target="_blank"><img src="https://i.loli.net/2019/08/17/NYGuWnpH94rJ7Fc.png"></a></center><font color="black">这是由于8.0以上的Tomcat不允许除了POST和GET以外的其他请求来访问JSP页面，解决的办法也很简单，如下：</font><center><a href="https://sm.ms/image/1GlWr423nIOPTeB" target="_blank"><img src="https://i.loli.net/2019/08/17/1GlWr423nIOPTeB.png"></a></center><p><font color="black">解决这个问题后，最终的测试结果如下图：</font></p><center><a href="https://sm.ms/image/Tc1xWmrANPdVuho" target="_blank"><img src="https://i.loli.net/2019/08/17/Tc1xWmrANPdVuho.gif"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Ant风格的URL形式&quot;&gt;&lt;a href=&quot;#Ant风格的URL形式&quot; class=&quot;headerlink&quot; title=&quot;Ant风格的URL形式&quot;&gt;&lt;/a&gt;&lt;div style=&quot;background-color: rgb(0,128,128);line-hei
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>RequestMapping注解</title>
    <link href="http://easyblog.top/2019/08/04/SpringMVC%20RequestMapping%E6%B3%A8%E8%A7%A3/"/>
    <id>http://easyblog.top/2019/08/04/SpringMVC RequestMapping注解/</id>
    <published>2019-08-04T10:14:34.000Z</published>
    <updated>2019-08-17T16:33:02.568Z</updated>
    
    <content type="html"><![CDATA[<p><font color="black">@RequestMapping注解是一个十分强大的注解，Spring MVC使用@RequestMapping注解为控制器指定可以处理那些URL请求，在控制器的类上或类中的方法上均可以使用这个注解：</font></p><li><font color="black">在类上使用可以提供初步的映射信息。相当于一个根路径</font></li> <li><font color="black">在方法上使用提供更进一步的细分映射信息。</font></li><p><font color="black">这是一个只在方法上使用的例子：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet0</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">sayHello</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到请求，正在处理......."</span>);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"This is a Spring MVC Web"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">这是一个在类和方法同时使用的例子：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/welcome"</span>)   <span class="comment">//这个相当于是基准路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到请求，正在处理......"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"Welcome to SpringMVC!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><font size="5" color="black"><code>@Requestmapping</code>的属性</font></strong>:</p><table><thead><th><font color="black">属性</font></th><th><font color="black">作用</font></th></thead><tbody><tr><td><font color="black">value</font></td><td><font color="black">默认的属性就是value,他就是一个URL路径，可以在一个方法上或类上给多个value值</font></td></tr><tr><td><font color="black">method</font></td><td><font color="black">用来定义接收浏览器发来的何种请求。在Spring中，使用枚举类RequestMethod来封装了HTTP协议的所有请求方式。最基本的有GET、POST、DELETE、PUT</font></td></tr><tr><td><font color="black">params</font></td><td><font color="black">表示请求参数，也就是追加在URL上的键值对，多个请求参数以&隔开</font></td></tr><tr><td><font color="black">headers</font></td><td><font color="black">该属性表示请求头，通过 @RequestMapping 中的 headers 属性，可以限制客户端发来的请求</font></td></tr><tr><td><font color="black">consumes</font></td><td><font color="black">规定请求头的Content-Type</font></td></tr><tr><td><font color="black">produces</font></td><td><font color="black">告诉浏览器返回的内容是什么，给响应头中加上Content-Type</font></td></tr></tbody></table><p><font color="black">示例代码：</font><br><font color="black">method:限定请求方法</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">HelloServlet.java</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定只有GET请求才可一访问</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/handler1"</span>,method= RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler1</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到请求，正在处理......"</span>);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"这是一个只有GET请求才可以访问页面"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定只有POST请求才可以来访问</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/handler2"</span>,method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handler2</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到请求，正在处理......"</span>);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"这是一个只有POST请求才可以访问页面"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;@RequestMapping测试&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;a href="hello"&gt;1.只在方法方法上用@RequestMapping注解&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="home/hello"&gt;2.在类和方法上同时用@RequestMapping注解&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="home/handler1"&gt;3.通过GET方法来访问&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;form action=<span class="string">"home/handler2"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        &lt;button type="submit"&gt;4.POST提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">parmars:限定参数</font><br><font color="black">parmars支持简单的表达式计算，例如:</font><br><font color="black">eg1:params = {“username”}   ,表示请求的路径中必须要有username这个关键字，如果没有就会报异常</font></p><p><font color="black">eg2:params = {“!username”}   ,表示请求的路径中不能有username这个关键字，如果有这个参数就会报异常</font><br><font color="black">eg2:params = {“username”,”age=20”,”pwd”}   ,表示请求的路径中必须要有username、age、pwd这三个关键字，并且age必须是20，如果没有或age的值不等就会报异常</font></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;@RequestMapping测试&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;a href="hello"&gt;1.只在方法方法上用@RequestMapping注解&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="home/hello"&gt;2.在类和方法上同时用@RequestMapping注解&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="home/handler1"&gt;3.通过GET方法来访问&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;form action=<span class="string">"home/handler2"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        &lt;button type="submit"&gt;4.POST提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;a href="home/handler3?username=hx"&gt;5.限定请求参数1&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="home/handler4?username=hx&amp;age=20&amp;pwd=123456"&gt;5.限定请求参数2&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><font color="black">headers:限定请求头部</font><br><font color="black">示例一：</font></p><center><a href="https://sm.ms/image/1eHFbVnQzvOElcU" target="_blank"><img src="https://i.loli.net/2019/08/17/1eHFbVnQzvOElcU.png"></a></center><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/CwKeEJLh1B67itm" target="_blank"><img src="https://i.loli.net/2019/08/17/CwKeEJLh1B67itm.png"></a></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;font color=&quot;black&quot;&gt;@RequestMapping注解是一个十分强大的注解，Spring MVC使用@RequestMapping注解为控制器指定可以处理那些URL请求，在控制器的类上或类中的方法上均可以使用这个注解：&lt;/font&gt;&lt;/p&gt;
&lt;li&gt;&lt;f
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC的运行流程</title>
    <link href="http://easyblog.top/2019/08/03/SpringMVC%E5%85%A5%E9%97%A8/"/>
    <id>http://easyblog.top/2019/08/03/SpringMVC入门/</id>
    <published>2019-08-03T15:24:58.000Z</published>
    <updated>2019-08-17T10:13:05.268Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Spring-MVC体系结构："><a href="#Spring-MVC体系结构：" class="headerlink" title="Spring MVC体系结构："></a><font color="balck">Spring MVC体系结构：</font></h4><p>SpringMVC 是基于 Model2 实现的技术框架</p><center><a href="https://sm.ms/image/QmpvIBLbyPDluGk.png" target="_blank"><img src="https://i.loli.net/2019/08/08/QmpvIBLbyPDluGk.png" width="100%"></a></center><ul><h5>  <strong><font size="4" color="black">一个请求在SpringMVC中经历的过程：</font></strong></h5> <li><font color="black">请求旅程的第一站是 Spring 的<strong> DispatcherServlet</strong>。与大多数基于 Java 的 Web 框架一样，Spring MVC 所有的请求都会通过一个<strong>前端控制器（front controller）</strong>Servlet。前端控制器是常用的 Web 应用程序模式，在这里一个单实例的 Servlet 将请求委托给应用程序的其他组件来执行实际的处理。在 Spring MVC 中，DispatcherServlet 就是前端控制器。</font></li><li> <font color="black">DispatcherServlet 的任务是将请求发送给<strong> Spring MVC 控制器（controller）</strong>。控制器是一个用于处理请求的 Spring 组件。在典型的应用程序中可能会有多个控制器，DispatcherServlet 需要知道应该将请求发送给哪个控制器。所以 DispatcherServlet 以会查询一个或多个<strong>处理器映射（handler mapping）</strong> 来确定请求的下一站在哪里。处理器映射会根据请求所携带的 URL 信息来进行决策。</font></li><li> <font color="black">一旦选择了合适的控制器，DispatcherServlet 会将请求发送给选中的控制器 。到了控制器，请求会卸下其负载（用户提交的信息）并耐心等待控制器处理这些信息。（实际上，设计良好的控制器本身只处理很少甚至不处理工作，而是将业务逻辑委托给一个或多个服务对象进行处理。）</font></li><li><font color="black">控制器在完成逻辑处理后，通常会产生一些信息，这些信息需要返回给用户并在浏览器上显示。这些信息被称为<strong>模型（model）</strong>。不过仅仅给用户返回原始的信息是不够的——这些信息需要以用户友好的方式进行格式化，一般会是 HTML。所以，信息需要发送给一个视图（view），通常会是 JSP。</font></li><li><font color="black">控制器所做的最后一件事就是将<strong>模型数据</strong>打包，并且标示出用于渲染输出的视图名。它接下来会将请求连同模型和视图名发送回 DispatcherServlet 。</font></li><li><font color="black">这样，控制器就不会与特定的视图相耦合，传递给 DispatcherServlet 的视图名并不直接表示某个特定的 JSP。实际上，它甚至并不能确定视图就是 JSP。相反，它仅仅传递了一个逻辑名称，个名字将会用来查找产生结果的真正视图。DispatcherServlet 将会使用视图解析器（viewResolver）来将逻辑视图名匹配为一个特定的视图实现，它可能是也可能不是 JSP。</font></li><li> <font color="black">既然 DispatcherServlet 已经知道由哪个视图渲染结果，那请求的任务基本上也就完成了。它的最后一站是视图的实现（可能是 JSP） ，在这里它交付模型数据。请求的任务就完成了。视图将使用模型数据渲染输出，这个输出会通过响应对象传递给客户端（不会像听上去那样硬编码） 。</font></li><li> <font color="black">可以看到，请求要经过很多的步骤，最终才能形成返回给客户端的响应。大多数的步骤都是在 Spring 框架内部完成的，也就是上图所示的组件中。</font></li></ul><h4 id="第一个SpringMVC程序"><a href="#第一个SpringMVC程序" class="headerlink" title="第一个SpringMVC程序"></a><font color="black">第一个SpringMVC程序</font></h4><h5 id="第一步：配置环境（新建Web工程-导包-配置Tomcat）"><a href="#第一步：配置环境（新建Web工程-导包-配置Tomcat）" class="headerlink" title="第一步：配置环境（新建Web工程+导包+配置Tomcat）"></a><font color="black">第一步：配置环境（新建Web工程+导包+配置Tomcat）</font></h5><p><font color="black">在IDEA中新建MavenWeb工程，新建好后导包，使用SpringMVC所需要的基本的Maven依赖如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">pom.xml中的依赖</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span></span></span><br><span class="line">  &lt;spring.version&gt;5.1.4.RELEASE&lt;/spring.version&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Servlet JSP依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/jstl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-web --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="第二步：配置DispatcherServlet"><a href="#第二步：配置DispatcherServlet" class="headerlink" title="第二步：配置DispatcherServlet"></a><font color="black">第二步：配置DispatcherServlet</font></h5><p><font color="black">通过DispatcherServlet这个名字可以大概了解到，这就是一个servlet,因此要想使一个sevlet起作用无非两种方法：一种是在servle类的头部加<code>@WebServlet</code>注解，二是在web.xml文件中配置<code>&lt;servlet&gt;</code>和<code>servlet-mapping</code>，第一种方法在这里显然不可行，人家源码肯定不能让改，那就需要在web.xml配置它，配置如下:</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置前段控制器DispatcherServlet到web.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--初始化参数：是springMVC配置文件的类路径，也可以不配这个，在笔记最后有说明--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--url路径表示拦截所有的请求</span></span><br><span class="line"><span class="comment"> /和/*都是拦截所有的请求</span></span><br><span class="line"><span class="comment"> /*的拦截范围更大，会拦截*.jsp,而/不会拦截*.jsp</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">接着在src/resources下新建<code>springmvc.xml</code>，配置springmvc：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xzy.contorller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 当请求的中径没有对应的controller 那么就访问静态资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置一个视图解析器：会帮我们拼接页面地址--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jspViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="第三步：在webapp包下新建一个index-html以及hello-jsp，随便写点啥"><a href="#第三步：在webapp包下新建一个index-html以及hello-jsp，随便写点啥" class="headerlink" title="第三步：在webapp包下新建一个index.html以及hello.jsp，随便写点啥"></a><font color="black">第三步：在webapp包下新建一个index.html以及hello.jsp，随便写点啥</font></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"hello"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">         pageEncoding=<span class="string">"UTF-8"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align="center"&gt;第一个Spring mVC&lt;/h1&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    $&#123;msg&#125;&lt;br/&gt;</span><br><span class="line">    $&#123;teacher.name&#125;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;img src=<span class="string">"img/a1.jpg"</span>/&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h5 id="第四步：新建一个Controller，比如就叫HelloController"><a href="#第四步：新建一个Controller，比如就叫HelloController" class="headerlink" title="第四步：新建一个Controller，比如就叫HelloController"></a><font color="black">第四步：新建一个Controller，比如就叫<font size="4"><code>HelloController</code></font></font></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到请求，正在处理......"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"Welcome to SpringMVC!"</span>);</span><br><span class="line">        <span class="comment">/* &lt;property name="prefix" value="/WEB-INF/pages/"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;property name="suffix" value=".jsp"/&gt;</span></span><br><span class="line"><span class="comment">          在xml配置的视图解析器会自动帮我们拼接页面地址：prefix+返回值+suffix</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font size="4">测试结果：</font></p><center><a href="https://sm.ms/image/V4ql3BYfvhtmSJ6" target="_blank"><img src="https://i.loli.net/2019/08/08/V4ql3BYfvhtmSJ6.png"></a></center><p><font color="black">总结在做的时候的几细节</font><br>1.</p><blockquote><p><font color="black">Spring MVC 下Web项目的运行流程：</font><br><font color="black">1).点击<a href="http://localhost/SpringMVC_01_war_exploded/后浏览器把请求给服务器" target="_blank" rel="noopener">http://localhost/SpringMVC_01_war_exploded/后浏览器把请求给服务器</a></font><br><font color="black">2).服务器中由于配置了SpringMVC的Dispatcherservlet，他可以拦截到所有的请求</font><br><font color="black">3).Dispatcherservlet拦截到请求后查看请求地址和@RequestMapping()中的那个地址(对应的方法)匹配，如果没找到，又没有配置<code>&lt;mvc:defalut-servlet-handler/&gt;</code>那就“炸了”!</font><br><font color="black">4).如果前端控制器找到目标处理器和方法后，在执行目标方法前拦截器的preHnalde方法会执行，然后利用反射调用方法</font><br><font color="black">5).方法执行完成会有返回值（视图名），SpringMVC认为这就是方法执行完后要去的页面，最终会把它封装成一个ModelAndView对象</font><br><font color="black">6).拿到ModelAndView对象后，视图解析器(ViewResolver)会根据ModelAndView解析出实际的视图(View)对象</font><br><font color="black">7).得到视图对象后，调用该View对象的render方法来渲染视图，视图渲染完成后前段控制器就会使用转发的方式到目标页面，之后拦截器的afterCompletion方法会被调用</font></p></blockquote><p>2.<br><font color="black">关于springmvc.xml配置文件的配置：</font><br><font color="black">在web.xml配置前段控制器又这么一段配置，他的作用是告诉服务器去哪里加载对于前端控制器的配置文件：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line">  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">  &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure><p><font color="black">如果我们没有写他会发生什么呢？会发生异常：</font></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">08</span>-<span class="number">03</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">16</span> <span class="string">[INFO]</span>-<span class="string">[org.springframework.web.servlet.DispatcherServlet]</span> Initializing Servlet 'app'</span><br><span class="line">  <span class="number">2019</span>-<span class="number">08</span>-<span class="number">03</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">16</span> <span class="string">[ERROR]</span>-<span class="string">[org.springframework.web.servlet.DispatcherServlet]</span> Context initialization failed</span><br><span class="line">  org.springframework.beans.factory.BeanDefinitionStoreException: IOException parsing XML document from ServletContext resource <span class="string">[/WEB-INF/app-servlet.xml]</span>; nested exception is java.io.FileNotFoundException: Could not open ServletContext resource <span class="string">[/WEB-INF/app-servlet.xml]</span></span><br><span class="line">at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:<span class="number">344</span>)</span><br><span class="line">at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:<span class="number">304</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:<span class="number">188</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:<span class="number">224</span>)</span><br></pre></td></tr></table></figure><p><font color="black">一大堆异常信息反正就是告诉中我们启动的时候没有找不到配置文件的路径，SpringMVC默认会在<code>/WEB-INF目录下</code>默认加载一个文件叫<code>app-servlet.xml</code>的文件，然而也没有找到，从而无法完成初始化。从这里我们知道，在web.xml中配置前端控制器的时候也可以不写初始化参数，但是我们必须将springmvc配置文件放在WEB-INF目录下，并且文件的必须名字是：<font color="red" size="4">在web.xml中前端控制器的<code>&lt;servlet-name&gt;</code>+<code>-servlet.xml</code></font>,这是规定，不可随便来，你想节省一些操作就得按人家的要求来。</font></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Spring-MVC体系结构：&quot;&gt;&lt;a href=&quot;#Spring-MVC体系结构：&quot; class=&quot;headerlink&quot; title=&quot;Spring MVC体系结构：&quot;&gt;&lt;/a&gt;&lt;font color=&quot;balck&quot;&gt;Spring MVC体系结构：&lt;/font
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="SpringMVC" scheme="http://easyblog.top/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>认识Spring框架</title>
    <link href="http://easyblog.top/2019/08/01/%E8%AE%A4%E8%AF%86Spring%E6%A1%86%E6%9E%B6/"/>
    <id>http://easyblog.top/2019/08/01/认识Spring框架/</id>
    <published>2019-08-01T11:24:59.000Z</published>
    <updated>2019-08-16T07:05:15.063Z</updated>
    
    <content type="html"><![CDATA[<p>Spring 框架是 Java 应用最广的框架，它的成功来源于理念，而不是技术本身，它的理念包括 IoC (Inversion of Control，控制反转) 和 AOP(Aspect Oriented Programming，面向切面编程)。</p><h4 id="什么是-Spring"><a href="#什么是-Spring" class="headerlink" title="什么是 Spring?"></a><font color="black">什么是 Spring?</font></h4><p>1). Spring 是一个轻量级的 DI / IoC 和 AOP 容器的开源框架，来源于 Rod Johnson 在其著作《Expert one on one J2EE design and development》中阐述的部分理念和原型衍生而来。<br>2).Spring 提倡以“最少侵入”的方式来管理应用中的代码，这意味着我们可以随时安装或者卸载 Spring<br>3).适用范围：任何 Java 应用<br>4).Spring 的根本使命：简化 Java 开发</p><h4 id="Spring-中常用术语："><a href="#Spring-中常用术语：" class="headerlink" title="Spring 中常用术语："></a><font color="black">Spring 中常用术语：</font><ul></ul></h4><li><strong><font color="red">框架</font></strong>：是能完成一定功能的半成品。框架能够帮助我们完成的是：项目的整体框架、一些基础功能、规定了类和对象如何创建，如何协作等，当我们开发一个项目时，框架帮助我们完成了一部分功能，我们自己再完成一部分，那这个项目就完成了。</li><li><strong><font color="red">非侵入式设计</font></strong>：从框架的角度可以理解为：无需继承框架提供的任何类这样我们在更换框架时，之前写过的代码几乎可以继续使用。</li><li><strong><font color="red">轻量级和重量级</font></strong>：轻量级是相对于重量级而言的，轻量级一般就是非入侵性的、所依赖的东西非常少、资源占用非常少、部署简单等等，其实就是比较容易使用，而重量级正好相反。</li><li><strong><font color="red">JavaBean</font></strong>：即符合 JavaBean 规范的 Java 类</li><li><strong><font color="red">POJO</font></strong>：即 Plain Old Java Objects，简单老式 Java 对象它可以包含业务逻辑或持久化逻辑，但不担当任何特殊角色且不继承或不实现任何其它Java框架的类或接口。</li>> 注意：bean 的各种名称——虽然 Spring 用 bean 或者 JavaBean 来表示应用组件，但并不意味着 Spring 组件必须遵循 JavaBean 规范，一个 Spring 组件可以是任意形式的 POJO。<li><strong><font color="red">容器</font></strong>：在日常生活中容器就是一种盛放东西的器具，从程序设计角度看就是装对象的的对象，因为存在放入、拿出等操作，所以容器还要管理对象的生命周期。<h4 id="Spring-的优势"><a href="#Spring-的优势" class="headerlink" title="Spring 的优势"></a><font color="black">Spring 的优势</font><ul></ul></h4></li><li><strong><font color="red">低侵入 / 低耦合</font></strong> （降低组件之间的耦合度，实现软件各层之间的解耦）</li><li><strong><font color="red">声明式事务管理</font></strong>（基于切面和惯例）</li><li><strong><font color="red">方便集成其他框架</font></strong>（如MyBatis、Hibernate）</li><li><strong><font color="red">降低 Java 开发难度</font></strong></li><li>Spring 框架中包括了 J2EE 三层的每一层的解决方案（一站式）</li><h4 id="Spring能帮我们做什么"><a href="#Spring能帮我们做什么" class="headerlink" title="Spring能帮我们做什么?"></a><font color="black">Spring能帮我们做什么?</font></h4><p>①.Spring 能帮我们根据配置文件<strong><font color="red">创建及组装对象之间的依赖关系。</font></strong><br>②.Spring <strong><font color="red">面向切面编程能帮助我们无耦合的实现日志记录，性能统计，安全控制。</font></strong><br>③.Spring 能非常简单的帮我们<strong><font color="red">管理数据库事务。</font></strong><br>④.Spring 还<strong><font color="red">提供了与第三方数据访问框架</font></strong>（如Hibernate、JPA）无缝集成，而且自己也提供了一套JDBC访问模板来方便数据库访问。<br>⑤.Spring 还<strong><font color="red">提供与第三方Web（如Struts1/2、JSF）框架无缝集成，而且自己也提供了一套Spring MVC框架，来方便web层搭建。</font></strong><br>⑥.Spring 能方便的与Java EE（如Java Mail、任务调度）整合，与更多技术整合（比如缓存框架）。</p><h4 id="Spring的框架体系结构："><a href="#Spring的框架体系结构：" class="headerlink" title="Spring的框架体系结构："></a><font color="green">Spring的框架体系结构：</font></h4><center><a href="https://sm.ms/image/fJtpaAD2kgbEoC9" target="_blank"><img src="https://i.loli.net/2019/08/07/fJtpaAD2kgbEoC9.png"></a></center><blockquote><ul><li>Data Access/Integration层包含有JDBC、ORM、OXM、JMS和Transaction模块。</li><li>Web层包含了Web、Web-Servlet、WebSocket、Web-Porlet模块。</li><li>AOP模块提供了一个符合AOP联盟标准的面向切面编程的实现。</li><li>Core Container(核心容器)：包含有Beans、Core、Context和SpEL模块。</li><li>Test模块支持使用JUnit和TestNG对Spring组件进行测试。</li></ul></blockquote><p><font color="black">下面介绍这5个部分的jar以及依赖关系</font></p><h5 id="Core"><a href="#Core" class="headerlink" title="Core"></a><strong><font size="5" color="black">Core</font></strong></h5><ul>core部分包含4个模块:<li><font color="black">spring-core：这个jar 文件包含Spring 框架基本的核心工具类。Spring 其它组件要都要使用到这个包里的类，是其它组件的基本核心。外部依赖Commons Logging， (Log4J)。</font></li><li><font color="black">spring-beans：这个jar 文件是所有应用都要用到的，它包含访问配置文件、创建和管理bean 以及进行Inversion ofControl / Dependency Injection（IoC/DI）操作相关的所有类。如果应用只需基本的IoC/DI 支持，引入spring-core.jar 及spring-beans.jar 文件就可以了。</font></li><li><font color="black">spring-context：spring的context上下文即IoC容器</font></li><li><font color="black">spring-expression：一个强大的表达式语言，用于在运行时查询和处理对象图。该语言支持设置和获取属性值；属性赋值，方法调用，访问数组的内容，收集和索引器，逻辑和算术运算，命名变量，并从Spring的IOC容器的名字对象检索，它也支持列表选择和投影以及常见的列表聚合。</font></li></ul><font color="black">它们的依赖关系</font><center><a href="https://sm.ms/image/L5HkeilJMW9KSqE" target="_blank"><img src="https://i.loli.net/2019/08/07/L5HkeilJMW9KSqE.png"></a></center><font color="black">Maven依赖写法如下：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Core：spring-core、spring-beans、spring-content、spring-expression--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring核心--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring IOC容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring Bean工厂--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpEL(Spring表达式)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a><strong><font size="5" color="black">AOP</font></strong></h5><ul><font color="black">aop部分包含4个模块:</font><li><font color="black">spring-aop：这个jar 文件包含在应用中使用Spring 的AOP 特性时所需的类和源码级元数据支持。使用基于AOP 的Spring特性，如声明型事务管理（Declarative Transaction Management），也要在应用里包含这个jar包。外部依赖spring-core， (spring-beans，AOP Alliance， CGLIB，Commons Attributes)</font></li><li><font color="black">spring-aspects：提供对AspectJ的支持，以便可以方便的将面向切面的功能集成进IDE中，比如Eclipse AJDT。</font></li><li><font color="black">spring-instrument：提供一些类级的工具支持和ClassLoader级的实现，用于服务器</font></li><li><font color="black">spring-instrument-tomcat：针对tomcat的instrument实现</font></li></ul><font color="black">它们的依赖关系</font><center><a href="https://sm.ms/image/S7glAo4NLy21n8C" target="_blank"><img src="https://i.loli.net/2019/08/07/S7glAo4NLy21n8C.png"></a></center><font color="black">Maven依赖写法如下：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--AOP：spring-aop、spring-aspectj、spring-instrument、spring-instrument-tomcat--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring aop：外部依赖spring-core， (spring-beans，AOP Alliance， CGLIB，Commons Attributes)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--提供对AspectJ的支持，以便可以方便的将面向切面的功能集成进IDE中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aspectj的runtime包(必须)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aspectjweaver是aspectj的织入包(必须)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-instrument<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Data-Access"><a href="#Data-Access" class="headerlink" title="Data Access"></a><strong><font size="5" color="black">Data Access</font></strong></h5><ul><font color="black">data access部分包含5个模块</font><li><font color="black">spring-jdbc：这个jar 文件包含对Spring 对JDBC 数据访问进行封装的所有类。</font></li><li><font color="black">spring-tx：为JDBC、Hibernate、JDO、JPA、Beans等提供的一致的声明式和编程式事务管理支持。</font></li><li><font color="black">spring-orm：包含Spring对DAO特性集进行了扩展，使其支持iBatis(MyBatis)、JDO、OJB、TopLink， 因为Hibernate已经独立成包了，现在不包含在这个包里了。这个jar文件里大部分的类都要依赖spring-dao.jar里的类，用这个包时你需要同时包含spring-dao.jar包。</font></li><li><font color="black">spring-oxm：Spring 对Object/XMl的映射支持,可以让Java与XML之间来回切换。</font></li><li><font color="black">spring-jms：这个jar包提供了对JMX 1.0/1.2的支持类。java消息服务与Spring-massaging对应。外部依赖spring-beans，spring-aop， JMXAPI。</font></li></ul><font color="black">它们的依赖关系</font><center><a href="https://sm.ms/image/TJpHVwaIQZSGNYF" target="_blank"><img src="https://i.loli.net/2019/08/07/TJpHVwaIQZSGNYF.png"></a></center><font color="black">Maven依赖写法如下：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-oxm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Web"><a href="#Web" class="headerlink" title="Web"></a><strong><font size="5" color="black">Web</font></strong></h5><ul><font color="black">web部分包含4个模块</font><li><font color="black">spring-web：这个jar 文件包含Web 应用开发时，用到Spring 框架时所需的核心基础类，包括自动载入Web ApplicationContext 特性的类、Struts 与JSF 集成类、文件上传的支持类、Filter 类和大量工具辅助类。</font></li><li><font color="black">spring-webmvc：这个jar 文件包含Spring MVC 框架相关的所有类。包括框架的Servlets，Web MVC框架，控制器和视图支持。当然，如果你的应用使用了独立的MVC 框架，则无需这个JAR 文件里的任何类。外部依赖spring-web, (spring-support，Tiles，iText，POI)。</font></li><li><font color="black">spring-webmvc-portlet：基于portlet的mvc实现</font></li><li><font color="black">spring-websocket：Spring4以后为web应用提供的高效通信工具</font></li><li><font color="black">spring-messaging：Spring4以后提供用于构建基于消息的应用程序</font></li><li><font color="black">spring-struts：与struts的集成，不推荐，spring4不再提供</font></li><font color="black">它们的依赖关系</font><center><a href="https://sm.ms/image/hRxDqY5cN19sUj8" target="_blank"><img src="https://i.loli.net/2019/08/07/hRxDqY5cN19sUj8.png"></a></center><font color="black">Maven依赖写法如下：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring Web：spring-web、spring-webmvc、spring-webmvc-portlet--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Test"><a href="#Test" class="headerlink" title="Test"></a><strong><font size="5" color="black">Test</font></strong></h5><ul><font color="black">test部分只有一个模块，我将spring-context-support也放在这吧</font><li><font color="black">spring-test：Spring-test支持spring组建junit或TestNG的集成测试和单元测试。它提供了一致spring ApplicationContext的加载和上下文的缓存。他还提供了可以用来测试代码隔离的模拟对象。</font></li><li><font color="black">spring-context-support：包含支持缓存Cache（ehcache）、JCA、JMX、 邮件服务（Java Mail、COS Mail）、任务计划Scheduling（Timer、Quartz）方面的类。</font></li><font color="black">它们的依赖关系</font><center><a href="https://sm.ms/image/yLUt2bvmcPBSTMw" target="_blank"><img src="https://i.loli.net/2019/08/07/yLUt2bvmcPBSTMw.png"></a></center><font color="black">Maven依赖写法如下：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring Test：spring-test--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></ul></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Spring 框架是 Java 应用最广的框架，它的成功来源于理念，而不是技术本身，它的理念包括 IoC (Inversion of Control，控制反转) 和 AOP(Aspect Oriented Programming，面向切面编程)。&lt;/p&gt;
&lt;h4 id=&quot;什
      
    
    </summary>
    
      <category term="Spring框架" scheme="http://easyblog.top/categories/Spring%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Spring" scheme="http://easyblog.top/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>深入理解MyBatis高级结果映射</title>
    <link href="http://easyblog.top/2019/07/28/%E6%B7%B1%E7%90%86%E8%A7%A3MyBatis%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84/"/>
    <id>http://easyblog.top/2019/07/28/深理解MyBatis高级结果映射/</id>
    <published>2019-07-28T10:26:33.000Z</published>
    <updated>2019-08-17T16:32:56.871Z</updated>
    
    <content type="html"><![CDATA[<h4 id="搭建实验环境"><a href="#搭建实验环境" class="headerlink" title="搭建实验环境"></a><font color="black">搭建实验环境</font></h4><ul> <li><font color="black">1).新建数据库mybatis6 </font></li> <li><font color="black">2). 新建表：sys_user、sys_role、sys_user_role,sys_privilege、sys_role_privilege</font></li> <font color="black">sql脚本如下：</font><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  user_name <span class="built_in">varchar</span>(<span class="number">255</span>) ,</span><br><span class="line">  user_password <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  user_email <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  user_info <span class="built_in">text</span> <span class="keyword">comment</span> <span class="string">'用户简介'</span>,</span><br><span class="line">  head_img <span class="built_in">blob</span> <span class="keyword">comment</span> <span class="string">'头像'</span>,</span><br><span class="line">  create_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  role_name <span class="built_in">varchar</span>(<span class="number">255</span>) ,</span><br><span class="line">  <span class="keyword">enable</span> <span class="built_in">int</span> <span class="keyword">comment</span> <span class="string">'有效标志'</span>,</span><br><span class="line">  create_by <span class="built_in">bigint</span> <span class="keyword">comment</span> <span class="string">'创建人'</span>,</span><br><span class="line">  create_time datetime</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_privilege(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>  auto_increment,</span><br><span class="line">  privilege_name <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">comment</span> <span class="string">'权限名称'</span>,</span><br><span class="line">  privilege_url <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_role(</span><br><span class="line">  user_id <span class="built_in">bigint</span> ,</span><br><span class="line">  role_id <span class="built_in">bigint</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role_privilege(</span><br><span class="line">  role_id <span class="built_in">bigint</span>,</span><br><span class="line">  privilege <span class="built_in">bigint</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'admin'</span>,<span class="string">'123456'</span>,<span class="string">'adimin@mybatis.tk'</span>,<span class="string">'管理员'</span>,<span class="literal">null</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user <span class="keyword">values</span>(<span class="string">'1002'</span>,<span class="string">'testuser'</span>,<span class="string">'123456'</span>,<span class="string">'test@mybatis.tk'</span>,<span class="string">'测试用户'</span>,<span class="literal">null</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'管理员'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'普通用户'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'2019-7-30 10:05:56'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1'</span>,<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1'</span>,<span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_role <span class="keyword">values</span> (<span class="string">'1001'</span>,<span class="string">'2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'用户管理'</span>,<span class="string">'/user'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'角色管理'</span>,<span class="string">'/roles'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'系统管理'</span>,<span class="string">'/system'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'4'</span>,<span class="string">'系统维护'</span>,<span class="string">'/system-a'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_privilege <span class="keyword">values</span>(<span class="string">'5'</span>,<span class="string">'单位管理'</span>,<span class="string">'/company'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'3'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'4'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_role_privilege <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'5'</span>);</span><br></pre></td></tr></table></figure> <li><font color="black">3).新建每个 表对应的实体JavaBean</font></li> <font color="black">SysUser.java</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String userPassword;</span><br><span class="line">    <span class="keyword">private</span> String userEmail;</span><br><span class="line">    <span class="keyword">private</span> String userInfo;</span><br><span class="line">    <span class="keyword">private</span> String headImg;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> SysRole role;   <span class="comment">//用户的角色</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; roleList;   <span class="comment">//用户角色结合和</span></span><br><span class="line">    <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure><p> <font color="black"> SysRole.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRole</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> enable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> createBy;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SysPrivilege&gt; privilegeList;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure><p> <font color="black">SysUserRole.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserRole</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">      <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure><p> <font color="black">SysPrivilege.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysPrivilege</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String privilegeName;</span><br><span class="line">    <span class="keyword">private</span> String privilegeUrl;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure><p>  <font color="black">SysRolePrivilege.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.orecal.bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRolePrivilege</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line">    <span class="keyword">private</span> Long privilegeId;</span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br></pre></td></tr></table></figure> <li> <font color="black">4).新建SysUserMapper接口</font> </li> <li> <font color="black">5). 新建mybaits配置文件</font></li><center><a href="https://sm.ms/image/x7XPCpa4IKySBJr" target="_blank"><img src="https://i.loli.net/2019/08/17/x7XPCpa4IKySBJr.gif"></a></center></ul><h4 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">一对一映射</font></div></h4><p><font color="black">Mybatis中的映射方式有两种，一种是通过resultType自动映射，另一种是通过resultMap自己设置映射规则。resultMap又有两种映射方式：<strong>嵌套结果映射</strong>和<strong>嵌套查询映射</strong>。</font></p><ul><li><font color="black"><strong>嵌套结果映射:</strong>给数据库发一条复杂的sql语句把查询到的结果根据映射规则映射到不同的对象中</font></li><li><font color="black"><strong>嵌套查询映射：</strong>会发多条sql简单的语句，Mybatis会把多条sql语句的查询据结果封装到一个对象中。如果在mybatis全局配置中设置了延迟加载：`<setting name="lazyLoadingEnabled" value="true">        <!--aggressvieLazyLoading当这个参数为true的时候，对任意延迟属性都会完全的加载，当为false时会按需加载-->        <setting name="aggressiveLazyLoading" value="false">`        那么还可以按需给数据库发sql语句，即当没有用到这个表中的数据的时候，Mybatis压根就不会给数据库法sql语句，即使已在xml文件中已经配置了sql语句，这是MyBatis中非常强大的一个功能。</setting></setting></font></li></ul><font color="black">配置xml文件：<br>通过resultMap一对一映射，在SysUser实体类中新增一个属性<code>private SysRole role</code> 标识用户的角色，然后在SysUserMapper.xml中写如下映射<code>userRoleMap</code>：</font><p></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecla.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--sys_user表中原有的属性--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           id:id元素是一个很特殊的元素，如果设置了它，MyBayis会比较每次返回来的数据的id,如果id相同，MyBatis就会认为这是同一条数据，然后就会把这两条数据合并；如果没有设置id,MyBatis会比较resultMap下所有的字段属性，只要有一个不同就不会合并。</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--role字段在sys_user表中没有，而且role他是一个复杂的类型，没法直接映射，最简单的可以通过如下这种方式来映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">       select</span><br><span class="line">          sys_user.*,sys_role.role_name</span><br><span class="line">        from</span><br><span class="line">          sys_user,sys_role</span><br><span class="line">        where</span><br><span class="line">       sys_user.id=#&#123;id&#125; and sys_role.role_name=sys_user.user_info</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">在SysUserMapper接口中增加方法：<code>public SysUser selectUserAndRoleById(Long id);</code></font><br><font color="black">测试方法：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">           SysUser user = sum.selectUserAndRoleById(<span class="number">1002L</span>);</span><br><span class="line">           System.out.println(user);</span><br><span class="line">           <span class="comment">//log.info(sum);</span></span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><font color="black">这是日志的打印结果：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 10:16:52 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] ==&gt;  Preparing: select sys_user.*,sys_role.role_name from sys_user,sys_role where sys_user.id=? and sys_role.role_name=sys_user.user_info </span><br><span class="line">  2019-07-31 10:16:52 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 10:16:53 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=null, roleName=&apos;普通用户&apos;, enable=0, createBy=0, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 10:16:53 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 10:16:53 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br></pre></td></tr></table></figure><p><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;改进上面的映射方法：上面的映射方法虽然可以使用，但是耦合性太高，而且最大的问题是配置文件不能复用，啥意思?就是说，如果我现在需要一个单独查用户的方法，那我还得专门为查用户写一个sql配置，这样做非常的糟糕，当项目非常大的时候，配置文件的重复配置代码将会非常的多，那么如何解决这个问题呢?我们接着往下看:</font><br><font color="black">在SysUserMapper.xml中增加一个专门为查用户的映射<code>userMap</code>：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUser"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">      select * from sys_user where id=#&#123;id&#125;;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">然后刚才的上面的<code>userRoleMap</code>就可以修改成下面的样子：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      使用resultMap可以自定义结果集的映射关系</span></span><br><span class="line"><span class="comment">         type:这个样映射到那个pojo</span></span><br><span class="line"><span class="comment">         id：给这个映射关系起的一个唯一的标识</span></span><br><span class="line"><span class="comment">         extends:resultMap可以继承别的map已经定义好的关系，比如下面的userMap在上门已经定义了，在下面可以继承后直接使用</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">          sys_user.*,sys_role.role_name</span><br><span class="line">        from</span><br><span class="line">          sys_user,sys_role</span><br><span class="line">        where</span><br><span class="line">          sys_user.id=#&#123;id&#125; and sys_role.role_name=sys_user.user_info</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">使用association元素替代上面的role.XXX:</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"> <span class="comment">&lt;!--使用association和一个复杂的类型进行关联</span></span><br><span class="line"><span class="comment">       property:pojo中对应的属性名，必填</span></span><br><span class="line"><span class="comment">       javaType:这个属性对应的pojo类型</span></span><br><span class="line"><span class="comment">       resultMap:可以使用这个属性配置已有的map，</span></span><br><span class="line"><span class="comment">                 如果要引用当前mapper中的resultMap，直接引用</span></span><br><span class="line"><span class="comment">                 如果引用别的mapper中的resultMap，要指定namespace以及引用的那个map的id</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap2"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">可是这样还是不行，实际的开发中，肯定会有关于单独查询sys_role的需求，而且人家sys_role肯定也会有单独的mapper,这样就又会存在重复配置的问题，解决这个问题需要用到association元素的另一个功能,具体看代码：</font><br><font color="black">新建SysRoleMapper.xml,并配置<code>roleMap</code>如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SysRoleMapper.xml</span><br><span class="line"><span class="comment">&lt;!--根据id查询角色--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span> <span class="attr">id</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enable"</span> <span class="attr">column</span>=<span class="string">"enable"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        select * from sys_role where id=#&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">这样我们在<code>SysUserMapper.xml</code>就可以把刚才的配置彻底抽取了出来：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--在association中使用resultMap属性指定要关联的Map</span></span><br><span class="line"><span class="comment">            resultMap=目标map的namespace.目标map的id   在同一个mapper中也可以这么使用，但是只用指定id就够了</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.roleMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">这样就彻底把模块与模块分开了,当然我们也可以顺便实现以下<code>selectRoleById</code>,下面是配置后的运行时打印的日志的部分：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] ==&gt; Preparing: select sys_user.*,sys_role.role_name from sys_user,sys_role where sys_user.id=? and sys_role.role_name=sys_user.user_info </span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById2] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=1002, roleName=&apos;普通用户&apos;, enable=0, createBy=0, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 10:57:08 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 10:57:08 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p><font color="black">可以看到，日志的打印结果相同，但是修改后的方式肯定比一开始的方法要好，因为这样就把各个查询模块化了，就像搭积木，一个个简单的“积木块”最后通过合理的组织，就可以实现不同的复杂查询。</font><br><font color="black"><strong>一对一的嵌套查询映射</strong></font><br><font color="black">上面这种方法是嵌套结果映射，就是直接给数据库发一条sql语句，数据库返回数据后Mybatis根据映射规则，把数据映射到不同的对象中。而嵌套查询映射则是多次给数据库发简单的sql语句，然后把不同的数据映射到一个对象中。</font></p><blockquote><p> <font color="black"> 1.<strong>association元素的嵌套查询：<br>      &nbsp; &nbsp;   select :另一个映射查询map的id<br>        &nbsp; &nbsp; column：将主查询的那个列的结果作为嵌套查询的参数传给嵌套查询方法<br>       &nbsp; &nbsp;  fetchType:数据加载的方式[lazy或eager],即延迟加载或积极加载,<br>                 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; 配置这个属性会覆盖全局配置中飞lazyLoadingEnabled<br>              2.MyBatis的嵌套查询可以实现懒加载，简单点的说就是不用的时候就不给你加载，等用的时候才去给你加载,这样做的好处是可以降低数据库的压力，做到按需响应。那么要用懒加载必须在全局配置文件中设置如下：<font color="black"><br><code>&lt;settings&gt;        &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;  &lt;!--vallue=false时按需加载-，否者全部加载-&gt;        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;   &lt;!--是否开启懒加载，true表示开启--&gt;         &lt;setting name=&quot;lazyLoadTriggerMethods&quot;        value=&quot;equals,clone,hashCode,toString&quot;/&gt;    &lt;!--懒加载模式下如果调用value后的方法将全部加载--&gt;    &lt;/settings&gt;</code></font><br></strong></font></p></blockquote><p><font color="black">在SysUserMapper.xml中写一个id为userRoleMapSelecct的新的映射关系，并写SQL查询语句如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMapSelect"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         association的select元素中指定另一个嵌套的子查询</span></span><br><span class="line"><span class="comment">         select=子查询Mapper接口中对应方法的全类名</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.selectRoleById"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">column</span>=<span class="string">"&#123;id=role_id&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById3"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMapSelect"</span>&gt;</span></span><br><span class="line">SELECT</span><br><span class="line">sys_user.id,</span><br><span class="line">sys_user.user_name,</span><br><span class="line">sys_user.user_password,</span><br><span class="line">sys_user.user_email,</span><br><span class="line">sys_user.user_info,</span><br><span class="line">sys_user.head_img,</span><br><span class="line">sys_user.create_time,</span><br><span class="line">sys_user_role.role_id </span><br><span class="line">FROM</span><br><span class="line">sys_user,</span><br><span class="line">sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">sys_user.id = sys_user_role.user_id </span><br><span class="line">AND sys_user.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">配置好后我们在SysUserMapper接口中增加<code>selectUserAndRoleById3</code>方法,然后写测试：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">            List&lt;SysUser&gt; user = sum.selectUserAndRoleById3(<span class="number">1002L</span>);</span><br><span class="line">            <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">                 System.out.println(u);</span><br><span class="line">                <span class="comment">//System.out.println(u.getUserName() + "," + u.getUserEmail() + "," + u.getCreateTime());</span></span><br><span class="line">            &#125;</span><br><span class="line">            log.info(sum);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">日志的打印结果：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Opening JDBC Connection</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Created connection 785447854.</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt;  Preparing: select sys_user.id, sys_user.user_name, sys_user.user_password, sys_user.user_email, sys_user.user_info, sys_user.head_img, sys_user.create_time, sys_user_role.role_id from sys_user,sys_user_role where sys_user.id=sys_user_role.user_id and sys_user.id=? </span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 11:29:54 [WARN]-[org.apache.ibatis.session.AutoMappingUnknownColumnBehavior] Unknown column is detected on &apos;com.orecal.mapper.SysUserMapper.selectUserAndRoleById3&apos; auto-mapping. Mapping parameters are [columnName=role_id,propertyName=role_id,propertyType=null]</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] &lt;==      Total: 1</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] ==&gt;  Preparing: select * from sys_role where id=?; </span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] ==&gt; Parameters: 2(Long)</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[com.orecal.mapper.SysRoleMapper.selectRoleById] &lt;==      Total: 1</span><br><span class="line">  SysUser&#123;id=1002, userName=&apos;testuser&apos;, userPassword=&apos;123456&apos;, userEmail=&apos;test@mybatis.tk&apos;, userInfo=&apos;普通用户&apos;, headImg=&apos;null&apos;, createTime=Tue Jul 30 10:05:56 CST 2019, role=SysRole&#123;id=2, roleName=&apos;普通用户&apos;, enable=1, createBy=1, createTime=Tue Jul 30 10:05:56 CST 2019, privilegeList=null&#125;, roleList=null&#125;</span><br><span class="line">2019-07-31 11:29:54 [INFO]-[com.orecal.AppTest] org.apache.ibatis.binding.MapperProxy@6580cfdd</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 11:29:54 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p><font color="black">可以看到，MyBatis分别给数据库发了两条sql语句，这是因为直接打印，在配置文件的setting中有一个元素<code>lazyLoadTriggerMethods  默认值value=&quot;equals,clone,hashCode,toString&quot;</code>，当程序中调用这些方法的时就会全部加载。但是如果我们在程序中只是用到User的一些属性，那么Mybatis就只发查user的sql语句,把测试代码中的<code>System.out.println(u);</code>改成<code>System.out.println(u.getUserName() + &quot;,&quot; + u.getUserEmail() + &quot;,&quot; + u.getCreateTime());</code></font></p><p><font color="black">再次运行打印的日志部分如下：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt;  Preparing: select sys_user.id, sys_user.user_name, sys_user.user_password, sys_user.user_email, sys_user.user_info, sys_user.head_img, sys_user.create_time, sys_user_role.role_id from sys_user,sys_user_role where sys_user.id=sys_user_role.user_id and sys_user.id=? </span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] ==&gt; Parameters: 1002(Long)</span><br><span class="line">  2019-07-31 11:27:13 [WARN]-[org.apache.ibatis.session.AutoMappingUnknownColumnBehavior] Unknown column is detected on &apos;com.orecal.mapper.SysUserMapper.selectUserAndRoleById3&apos; auto-mapping. Mapping parameters are [columnName=role_id,propertyName=role_id,propertyType=null]</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[com.orecal.mapper.SysUserMapper.selectUserAndRoleById3] &lt;==      Total: 1</span><br><span class="line">  testuser,test@mybatis.tk,Tue Jul 30 10:05:56 CST 2019</span><br><span class="line">2019-07-31 11:27:13 [INFO]-[com.orecal.AppTest] org.apache.ibatis.binding.MapperProxy@6a400542</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[org.apache.ibatis.transaction.jdbc.JdbcTransaction] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span><br><span class="line">  2019-07-31 11:27:13 [DEBUG]-[org.apache.ibatis.datasource.pooled.PooledDataSource] Returned connection 785447854 to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p><font color="black">可以看到，只发了一条sql语句。这就是MyBatis的延迟加载（懒加载），也就是说，当你没用到的时候，MyBatis压根不会帮你去查这个数据。这样一来的好处是会减轻数据库的压力。</font></p><h4 id="一对多映射"><a href="#一对多映射" class="headerlink" title="一对多映射"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">一对多映射</font></div></h4><p><strong><font color="black">使用<code>collection</code>实现一对多映射</font></strong>,<code>collection</code>的属性和用法与<code>association</code>基本是一样的，只是<code>collection</code>是专门用来映射数据库中一对多的多方元素的一个集合。比如现在有这样的需求：查询所有用户以及每个用户在本系统中所拥有的角色。这是一个很典型的一对多的例子，一个用户在系统中有多个角色。<br><strong>举个栗子：</strong><br><font color="black">在SysUser.java中增加属性<code>List&lt;SysRole&gt; roleList</code></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他的属性不变</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysRole&gt; roleList;   <span class="comment">//用户角色结合</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysRole&gt; <span class="title">getRoleList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> roleList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleList</span><span class="params">(List&lt;SysRole&gt; roleList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.roleList = roleList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black"> 在SysUserMapper.xml中增加reultMap<code>userRoleListMap</code>,由于<code>roleMap</code>在前面已经定义过了，这里就可以直接使用</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.roleMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>&gt;</span></span><br><span class="line">SELECT</span><br><span class="line">sys_user.*,</span><br><span class="line">sys_role.* </span><br><span class="line">FROM</span><br><span class="line">sys_user,</span><br><span class="line">sys_role,</span><br><span class="line">sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">sys_user_role.user_id = sys_user.id </span><br><span class="line">AND sys_user_role.role_id = sys_role.id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">测试代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">        List&lt;SysUser&gt; user = sum.selectAllUserAndRole();</span><br><span class="line">        System.out.println(<span class="string">"用户数："</span> + user.size());</span><br><span class="line">        <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">            System.out.println(<span class="string">"用户名："</span> + u.getUserName());</span><br><span class="line">            <span class="keyword">for</span> (SysRole role : u.getRoleList()) &#123;</span><br><span class="line">                System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(sum);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">程序运行打印的日志：</font></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Opening JDBC Connection</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">741669172</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt;  Preparing: select sys_user.*,sys_role.*,sys_privilege.* from sys_user, sys_role,sys_user_role,sys_privilege,sys_role_privilege where sys_user_role.user_id=sys_user.id and sys_user_role.role_id=sys_role.id and sys_role_privilege.role_id=sys_role.id and sys_privilege.id=sys_role_privilege.privilege_id; </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt; Parameters: </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> &lt;==      Total: <span class="number">7</span></span><br><span class="line">  用户数：<span class="number">2</span></span><br><span class="line">用户名：admin</span><br><span class="line">角色名：管理员</span><br><span class="line">角色名：普通用户</span><br><span class="line">用户名：testuser</span><br><span class="line">角色名：普通用户</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@38c5cc4c</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2c34f934]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">14</span>:<span class="number">47</span>:<span class="number">06</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">741669172</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><font color="black"> 前面这个实现了一层嵌套，就是一个主查询下面只有一个层子查询然后就结束了，下面我们尝试来实现一个两层嵌套：比如现在有这样的需求：查询所有的用户的角色，以及每个角色拥有的权限。很好想，就是一个用户可以有多个角色，每个角色又有不同的权限。</font><br><font color="black"> <strong>实现：</strong></font><br><font color="black">  首先在SysRole中增加一个属性<code>private List&lt;SysPrivilege&gt; privilegeList</code></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他的属性不变</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysPrivilege&gt; privilegeList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysPrivilege&gt; <span class="title">getPrivilegeList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> privilegeList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrivilegeList</span><span class="params">(List&lt;SysPrivilege&gt; privilegeList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.privilegeList = privilegeList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">新建SysPrivilegeMapper.xml文件，增加一个resultMap<code>privilegeMap</code></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysPrivilege"</span> <span class="attr">id</span>=<span class="string">"privilegeMap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"privilegeName"</span> <span class="attr">column</span>=<span class="string">"privilege_name"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"privilegeUrl"</span> <span class="attr">column</span>=<span class="string">"privilege_url"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   SELECT</span><br><span class="line">sys_privilege.* </span><br><span class="line">FROM</span><br><span class="line">sys_privilege,</span><br><span class="line">sys_role_privilege </span><br><span class="line">WHERE</span><br><span class="line">sys_role_privilege.privilege_id = sys_privilege.id </span><br><span class="line">AND sys_role_privilege.role_id = #&#123;roleId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black"> 在SysRoleMapper.xml中增加一个resultMap<code>rolePrivilegeListMap</code>，由于roleMap在上面已经定义过了，，用extends继承他就可以直接使用了。</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SysRoleMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMap"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privilegeList"</span> <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysPrivilegeMapper.privilegeMap"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllRoleAndPrivilege"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMap"</span>&gt;</span></span><br><span class="line">   select </span><br><span class="line">      sys_role.*,</span><br><span class="line">      sys_privilege.*</span><br><span class="line">   from </span><br><span class="line">      sys_role,</span><br><span class="line">      sys_privilege,</span><br><span class="line">      sys_role_privilege</span><br><span class="line">   where </span><br><span class="line">   sys_role_privilege.role_id=sys_role.id and                        sys_privilege.id=sys_role_privilege.privilege_id;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">在SysUserMapper.xml中增加reusltMap:<code>userRoleListMapSelect</code></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SysUserMapper.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMapSelect"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.rolePrivilegeListMap"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole2"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>&gt;</span></span><br><span class="line">          SELECT</span><br><span class="line">sys_user.*,</span><br><span class="line">sys_role.*,</span><br><span class="line">sys_privilege.* </span><br><span class="line">FROM</span><br><span class="line">sys_user,</span><br><span class="line">sys_role,</span><br><span class="line">sys_user_role,</span><br><span class="line">sys_privilege,</span><br><span class="line">sys_role_privilege </span><br><span class="line">WHERE</span><br><span class="line">sys_user_role.user_id = sys_user.id </span><br><span class="line">AND sys_user_role.role_id = sys_role.id </span><br><span class="line">AND sys_role_privilege.role_id = sys_role.id </span><br><span class="line">AND sys_privilege.id = sys_role_privilege.privilege_id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">在SysUserMapper接口中增加方法<code>selectAllUserAndRole2</code>，并且编写测试代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">       List&lt;SysUser&gt; user = sum.selectAllUserAndRole();</span><br><span class="line">       System.out.println(<span class="string">"用户数："</span> + user.size());</span><br><span class="line">       <span class="keyword">for</span> (SysUser u : user) &#123;</span><br><span class="line">         System.out.println(<span class="string">"用户名："</span> + u.getUserName());</span><br><span class="line">         <span class="keyword">for</span> (SysRole role : u.getRoleList()) &#123;</span><br><span class="line">         System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">            <span class="keyword">for</span> (SysPrivilege privilege : role.getPrivilegeList()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"权限："</span> + privilege.getPrivilegeName());</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">          System.out.println(<span class="string">"--------------------------------------------------------"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><font color="black">程寻运行打印的日志的一部分：</font></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">741669172</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt;  Preparing: select sys_user.*,sys_role.*,sys_privilege.* from sys_user, sys_role,sys_user_role,sys_privilege,sys_role_privilege where sys_user_role.user_id=sys_user.id and sys_user_role.role_id=sys_role.id and sys_role_privilege.role_id=sys_role.id and sys_privilege.id=sys_role_privilege.privilege_id; </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> ==&gt; Parameters: </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole]</span> &lt;==      Total: <span class="number">7</span></span><br><span class="line">  用户数：<span class="number">2</span></span><br><span class="line">用户名：admin</span><br><span class="line">角色名：管理员</span><br><span class="line">权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">角色名：普通用户</span><br><span class="line">权限：系统维护</span><br><span class="line">权限：单位管理</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">用户名：testuser</span><br><span class="line">角色名：普通用户</span><br><span class="line">权限：系统维护</span><br><span class="line">权限：单位管理</span><br><span class="line">--------------------------------------------------------</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@38c5cc4c</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2c34f934]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">27</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">741669172</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><font color="black">这样，我们就算是实现了一对多的两层嵌套结果映射的一个查询，这种方式在日常非常常见，也是MyBatis中非常强大的地方。<br>最后我们看一下一对多的嵌套查询映射，和一对一的实现方法是类似的：<br>前面我们写过一个resultMap<code>rolePrivilegeListMap</code>，但是还没有为他写接口方法，这里我们首先来实现这个：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SysPrivilegeMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过角色ID获得它的权限</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SysPrivilege&gt; <span class="title">selectPrivilegeByRoleId</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">在SysRoleMapper.xml增加一个resultMap:<code>rolePrivilegeListMap2</code></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMap2"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysRole"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privilegeList"</span>                               <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">column</span>=<span class="string">"&#123;roleId=id&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMap2"</span>&gt;</span></span><br><span class="line">      SELECT</span><br><span class="line">sys_role.* </span><br><span class="line">FROM</span><br><span class="line">sys_role,</span><br><span class="line">sys_user_role </span><br><span class="line">WHERE</span><br><span class="line">sys_user_role.user_id = sys_role.id </span><br><span class="line">AND sys_user_role.user_id = 1;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">在SysRoleMapper接口中增加一个方法<code>selectRoleByUserId</code></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id查他的权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  List&lt;SysRole&gt;  <span class="title">selectRoleByUserId</span><span class="params">(Long userId)</span></span>;</span><br></pre></td></tr></table></figure><p><font color="black">最后在SysUserMapper.xml中增加一个resultMap:<code>userRoleListMap2</code></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap2"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"com.orecal.bean.SysUser"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">select</span>=<span class="string">"com.orecal.mapper.SysRoleMapper.selectRoleByUserId"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">"&#123;userId=id&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRole2"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap2"</span>&gt;</span></span><br><span class="line">    select sys_user.* from sys_user where sys_user.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">在SysUserMapper接口中增加一个方法<code>selectAllUserAndRole2</code>:</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的Id查询他拥有的角色和对应的权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SysUser <span class="title">selectAllUserAndRole2</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure><p><font color="black">测试代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           SysUserMapper sum = session.getMapper(SysUserMapper.class);</span><br><span class="line">           SysUser user = sum.selectAllUserAndRole2(<span class="number">1002L</span>);</span><br><span class="line">           System.out.println(<span class="string">"-------------------------------------------"</span>);</span><br><span class="line">           System.out.println(<span class="string">"用户名："</span> + user.getUserName());</span><br><span class="line">           <span class="keyword">for</span> (SysRole role : user.getRoleList()) &#123;</span><br><span class="line">               System.out.println(<span class="string">"角色名："</span> + role.getRoleName());</span><br><span class="line">               <span class="keyword">for</span> (SysPrivilege privilege : role.getPrivilegeList()) &#123;</span><br><span class="line">                   System.out.println(<span class="string">"权限："</span> + privilege.getPrivilegeName());</span><br><span class="line">               &#125;</span><br><span class="line">               System.out.println(<span class="string">"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(<span class="string">"-------------------------------------------"</span>);</span><br><span class="line">           log.info(sum);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><font color="black">程寻运行打印的日志:</font></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Created connection <span class="number">785447854</span>.</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> ==&gt;  Preparing: select sys_user.* from sys_user where sys_user.id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysUserMapper.selectAllUserAndRole2]</span> &lt;==      Total: <span class="number">1</span></span><br><span class="line">  -------------------------------------------</span><br><span class="line">用户名：admin</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> ==&gt;  Preparing: select sys_role.* from sys_role,sys_user_role where sys_user_role.user_id=sys_role.id and sys_user_role.user_id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysRoleMapper.selectRoleByUserId]</span> &lt;==      Total: <span class="number">2</span></span><br><span class="line">  角色名：管理员</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> ==&gt;  Preparing: select sys_privilege.* from sys_privilege,sys_role_privilege where sys_role_privilege.privilege_id=sys_privilege.id and sys_role_privilege.role_id=? </span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> ==&gt; Parameters: <span class="number">1</span>(Long)</span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[com.orecal.mapper.SysPrivilegeMapper.selectPrivilegeByRoleId]</span> &lt;==      Total: <span class="number">3</span></span><br><span class="line">  权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">角色名：管理员</span><br><span class="line">权限：用户管理</span><br><span class="line">权限：角色管理</span><br><span class="line">权限：系统管理</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[INFO]</span>-<span class="string">[com.orecal.AppTest]</span> org.apache.ibatis.binding.MapperProxy@<span class="number">63355449</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.transaction.jdbc.JdbcTransaction]</span> Closing JDBC Connection <span class="string">[com.mysql.cj.jdbc.ConnectionImpl@2ed0fbae]</span></span><br><span class="line">  <span class="number">2019</span>-<span class="number">07</span>-<span class="number">31</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">08</span> <span class="string">[DEBUG]</span>-<span class="string">[org.apache.ibatis.datasource.pooled.PooledDataSource]</span> Returned connection <span class="number">785447854</span> to pool.</span><br><span class="line">  </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><font color="black">可以看到，程寻运行时，MyBatis给数据库发了多条sql语句，最终通过预定的映射集合，把这些查出来的数据放进去，之后打包组合成一个<code>List&lt;SysRole&gt;</code>对象返回。</font></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;搭建实验环境&quot;&gt;&lt;a href=&quot;#搭建实验环境&quot; class=&quot;headerlink&quot; title=&quot;搭建实验环境&quot;&gt;&lt;/a&gt;&lt;font color=&quot;black&quot;&gt;搭建实验环境&lt;/font&gt;&lt;/h4&gt;&lt;ul&gt;
 &lt;li&gt;&lt;font color=&quot;black&quot;&gt;
      
    
    </summary>
    
      <category term="Mybatis框架" scheme="http://easyblog.top/categories/Mybatis%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://easyblog.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis XML映射文件的配置</title>
    <link href="http://easyblog.top/2019/07/27/Mybatis%20XML%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
    <id>http://easyblog.top/2019/07/27/Mybatis XML映射文件的配置/</id>
    <published>2019-07-27T10:25:37.000Z</published>
    <updated>2019-08-17T16:03:33.001Z</updated>
    
    <content type="html"><![CDATA[<p><font color="black">MyBatis中的SQL 映射文件只有很少的几个顶级元素（按照它们应该被定义的顺序）：</font></p><blockquote><p> <font color="black"><strong>cache</strong> – 给定命名空间的缓存配置。<br><strong>cache-ref</strong> – 其他命名空间缓存配置的引用。<br><strong>resultMap</strong> – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。<br><strong>sql</strong> – 可被其他语句引用的可重用语句块。<br><strong>insert</strong> – 映射插入语句<br><strong>update</strong> – 映射更新语句<br><strong>delete</strong> – 映射删除语句<br><strong>select</strong> – 映射查询语句 </font></p></blockquote><h4 id="select元素"><a href="#select元素" class="headerlink" title="select元素"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black">select元素</font></div></h4><p><font color="black">select元素就是用来查询的，在select里嵌入SQL select查询语句,就象下边这样：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    select * from employee where id=#&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">其中 select元素中的id属性是必须的，它的值是对应Mapper接口中的一个方法，当调用这个接口就是调用这个sql。关于select元素常用的属性具体如下：</font></p><table border="1px"><thead><th>属性    </th><th>描述</th></thead><tbody><tr><th>id</th><th>在命名空间中唯一的标识符，可以被用来引用这条语句。这个是必须的属性</th></tr><tr><th>parameterType</th><th>将会传入这条语句的参数类的完全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过 TypeHandler 推断出具体传入语句的参数，默认值为 unset。</th></tr><tr><th>resultType</th><th>返回的期望类型的类的完全限定名或别名。这个属性是可选的</th></tr><tr><th>resultMap</th><th>返回值类型是是个map集合，可用于多表联查后的结果MyBatis会封装成一个map返回，这个属性是可选的</th></tr><tr><th>flushCache</th><th>将其设置为 true，任何时候只要语句被调用，都会导致本地缓存和二级缓存都会被清空，默认值：false。这个属性是可选的</th></tr><tr><th>useCache</th><th>将其设置为 true，将会导致本条语句的结果被二级缓存，默认值：对 select 元素为 true。这个属性是可选的</th></tr><tr><th>timeout</th><th>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为 unset（依赖驱动）。这个属性是可选的</th></tr></tbody></table><h4 id="insert-update-delete"><a href="#insert-update-delete" class="headerlink" title="insert update delete"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black">insert update delete</font></div></h4><p><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;insert update delete元素分别对应SQL语句中的insert、update、delete，分别实现对数据库记录的插入、更新和删除。他们可以有的属性值如下：</font></p><table border="1px"><thead><th>属性    </th><th>描述</th></thead><tbody><tr><th>id</th><th>在命名空间中唯一的标识符，可以被用来引用这条语句。这个是必须的属性</th></tr><tr><th>parameterType</th><th>将会传入这条语句的参数类的完全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过 TypeHandler 推断出具体传入语句的参数，默认值为 unset。</th></tr><tr><th>useGeneratedKeys</th><th>（仅对 insert 和 update 有用）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键，默认值为false，这个属性是可选的。</th></tr><th>keyProperty</th><th>（仅对 insert 和 update 有用）唯一标记一个属性，MyBatis 会通过 getGeneratedKeys 的返回值或者通过 insert 语句的 selectKey 子元素设置它的键值，他和useGeneratedKeys配合起来才能工作</th><tr><th>flushCache</th><th>将其设置为 true，任何时候只要语句被调用，都会导致本地缓存和二级缓存都会被清空，默认值：true。这个属性是可选的</th></tr><tr><th>useCache</th><th>将其设置为 true，将会导致本条语句的结果被二级缓存，默认值：对增删改元素为false。这个属性是可选的</th></tr><tr></tr><tr><th>timeout</th><th>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为 unset（依赖驱动）。这个属性是可选的</th></tr><tr><th>keyColumn</th><th>（仅对 insert 和 update 有用）通过生成的键值设置表中的列名，这个设置仅在某些数据库（像 PostgreSQL）是必须的，当主键列不是表中的第一列的时候需要设置。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。</th></tr></tbody></table><h4 id="Result-Maps"><a href="#Result-Maps" class="headerlink" title="Result Maps"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black">Result Maps</font></div></h4><p><font color="black">resultMap 元素是 MyBatis 中最重要最强大的元素。 ResultMap 的设计就是简单语句不需要明确的结果映射,而很多复杂语句确实需要描述它们的关系。</font></p><h5 id="简单映射"><a href="#简单映射" class="headerlink" title="简单映射"></a><font color="black">简单映射</font></h5><p><font color="black">例如下面这个例子：：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span> <span class="attr">paramaterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    select * from employee where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">JavaBean是这样的：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JavaBean基本类型最好使用他的包装类型！！！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String empId;</span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line">    <span class="keyword">private</span> Integer empAge;</span><br><span class="line">    <span class="keyword">private</span> String empSex;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//省略getter、setter....</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Employee&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", empId='"</span> + empId + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", empName='"</span> + empName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", empAge="</span> + empAge +</span><br><span class="line">                <span class="string">", empSex='"</span> + empSex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">Mybatis会将基于 JavaBean 的规范,这些 在 select 语句中会精确匹配到列名。这样一个语句简单作用于所有列被自动映射到 HashMap 的键上,这由 resultType 属性 指定。也就是说，对于resultType MyBatis会结果封装一个map返回。</font></p><h5 id="高级映射"><a href="#高级映射" class="headerlink" title="高级映射"></a><font color="black">高级映射</font></h5><p><font color="black">有时候我们避免不了多表联查，这样带来的问题是返回的结果类型中的一个字段在resultType中的不存在，这就会造成问题。MyBatis中使用resultMap来解决这个问题。<br>resultMap 元素有很多子元素和一个值得讨论的结构。 下面是 resultMap 标签中可以使用的属性如下：</font></p><blockquote><p><strong> <font color="black"> resultMap:</font></strong><br><font color="black"><strong>constructor</strong> - 类在实例化时,用来注入结果到构造方法中<br><strong>idArg</strong> - ID 参数;标记结果作为 ID 可以帮助提高整体效能<br><strong>arg</strong> - 注入到构造方法的一个普通结果<br><strong>id</strong> – 一个 ID 结果;标记结果作为 ID 可以帮助提高整体效能<br><strong>result</strong> – 注入到字段或 JavaBean 属性的普通结果<br><strong>association</strong> – 一个复杂的类型关联;许多结果将包成这种类型<br>嵌入结果映射 – 结果映射自身的关联,或者参考一个<br><strong>collection</strong> – 复杂类型的集<br>嵌入结果映射 – 结果映射自身的集,或者参考一个<br><strong>discriminator</strong> – 使用结果值来决定使用哪个结果映射<br><strong>case</strong> – 基于某些值的结果映射<br>嵌入结果映射 – 这种情形结果也映射它本身,因此可以包含很多相 同的元素,或者它可以参照一个外部的结果映射。</font></p></blockquote><table><thead><th>描述</th><th>描述</th></thead><tbody><tr><td>id</td><td>当前命名空间中的一个唯一标识，用于标识一个result map.</td></tr><tr><td>type</td><td>类的全限定名, 或者一个类型别名 </td></tr><tr><td>autoMapping</td><td>如果设置这个属性，MyBatis将会为这个ResultMap开启或者关闭自动映射。这个属性会覆盖全局的属性autoMappingBehavior。默认值为：unset。</td></tr></tbody></table><p><font color="black">下面是一个例子：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--StudentMapper.xml--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xzy.mapper.StudentMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--第一种多表联查的映射方式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span>  <span class="attr">type</span>=<span class="string">"student"</span>  <span class="attr">id</span>=<span class="string">"queryCName"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sid"</span> <span class="attr">column</span>=<span class="string">"sid"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sname"</span> <span class="attr">column</span>=<span class="string">"sname"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"majorIn"</span> <span class="attr">column</span>=<span class="string">"major_in"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sclass"</span> <span class="attr">column</span>=<span class="string">"sclass"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"course.cname"</span> <span class="attr">column</span>=<span class="string">"cname"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--查询某个同学所选的课程--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAll"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultMap</span>=<span class="string">"queryCName"</span>&gt;</span></span><br><span class="line">        select student.*,course.cname from student,course where student.cid=course.cid and student.sname=#&#123;sname&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">学生实体：Student.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//JavaBean Student</span></span><br><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String  sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> String majorIn;</span><br><span class="line">    <span class="keyword">private</span> String  sclass;</span><br><span class="line">    <span class="keyword">private</span> Course course;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//getter、setter...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", sid='"</span> + sid + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sname='"</span> + sname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", majorIn='"</span> + majorIn + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sclass='"</span> + sclass + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cname="</span> + course.getCname() +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">课程实体:Course.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JavaBean Course</span></span><br><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  Long id;</span><br><span class="line">    <span class="keyword">private</span> String cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="keyword">private</span> Student student;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略getter、setter.....</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Course&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", cid='"</span> + cid + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cname='"</span> + cname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试类AppTest.java</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Course;</span><br><span class="line"><span class="keyword">import</span> com.xzy.bean.Student;</span><br><span class="line"><span class="keyword">import</span> com.xzy.mapper.CourseMapper;</span><br><span class="line"><span class="keyword">import</span> com.xzy.mapper.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Unit test for simple App.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = Logger.getLogger(AppTest.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initLoad</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            StudentMapper sm=session.getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">            List&lt;Student&gt; lists= sm.getAll(<span class="string">"OKOK2"</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=lists&amp;&amp;lists.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"OKOK2同学选的课："</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (Student list : lists) &#123;</span><br><span class="line">                    System.out.println(list.toString());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"OK..."</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"没有这个人或该同学没有选课...."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"查询失败。。。。"</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><center><a href="https://sm.ms/image/djazQJ6iRZmYVce" target="_blank"><img src="https://i.loli.net/2019/08/17/djazQJ6iRZmYVce.gif"></a></center><p><font color="black">cache 和cache-ref 的用法参考另一篇笔记<a href>MyBatis缓存配置</a></font></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;font color=&quot;black&quot;&gt;MyBatis中的SQL 映射文件只有很少的几个顶级元素（按照它们应该被定义的顺序）：&lt;/font&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; &lt;font color=&quot;black&quot;&gt;&lt;strong&gt;cache&lt;/strong&gt; – 
      
    
    </summary>
    
      <category term="Mybatis框架" scheme="http://easyblog.top/categories/Mybatis%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://easyblog.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis 动态SQL</title>
    <link href="http://easyblog.top/2019/07/26/Mybatis%E5%8A%A8%E6%80%81SQL/"/>
    <id>http://easyblog.top/2019/07/26/Mybatis动态SQL/</id>
    <published>2019-07-26T10:25:09.000Z</published>
    <updated>2019-08-17T16:33:01.855Z</updated>
    
    <content type="html"><![CDATA[<p><font color="black">&nbsp;&nbsp;&nbsp;&nbsp;MyBatis 的强大特性之一便是它的动态 SQL。动态 SQL 元素和使用 JSTL 或其他类似基于 XML 的文本处理器相似。在 MyBatis 之前的版本中,有很多的元素需要来了解。MyBatis 3 大大提升了它们,现在用不到原先一半的元素就可以了。MyBatis 采用功能强大的基于 OGNL 的表达式来消除其他元素。主要的有以下几个：</font></p><ul style="background-color: gery;"><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>liforeach</li></ul><h4 id="if"><a href="#if" class="headerlink" title="if"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">if</font></div></h4><p>使用if可以用条件的筛选SQL语句分支，只有条件满足的时候才会执行。实例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">    select * from employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empSex!=null"</span>&gt;</span>and emp_sex=#&#123;empSex&#125; <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>and emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empName!=null"</span>&gt;</span>or emp_name=#&#123;empName&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">这条sql语句就会动态的根据传入的参数值来查询，比如当只传了empAge=23，其他都为空，那么生成的sql语句就是：select * from employee where emp_age=23，where元素是很强大的，他会自动帮我们把sql中多余的and或or去掉</font></p><h4 id="choose、when、otherwise"><a href="#choose、when、otherwise" class="headerlink" title="choose、when、otherwise"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">choose、when、otherwise</font></div></h4><p><font color="black">MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。实例;</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--下面的条件分支中只会有一条被执行--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBycondition"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">select * from employee where</span><br><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"empId!=null"</span>&gt;</span>emp_id=#&#123;empId&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"empName!=null"</span>&gt;</span>emp_name=#&#123;empName&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>emp_sex='女'<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">java代码这么写：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span></span>&#123;</span><br><span class="line">SqlSessionFactory sqlSessionFactory;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log=Logger.getLogger(AppTest.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSqlSession</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">String resource=<span class="string">"mybatis-config.xml"</span>;</span><br><span class="line"><span class="keyword">try</span> (InputStream inputStream = Resources.getResourceAsStream(resource)) &#123;</span><br><span class="line">    sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get2</span><span class="params">()</span></span>&#123;</span><br><span class="line">SqlSession session=sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    Employee employee=<span class="keyword">new</span> Employee();</span><br><span class="line">    employee.setEmpAge(<span class="number">34</span>);</span><br><span class="line">    employee.setEmpId(<span class="string">"3343"</span>);</span><br><span class="line">    EmployeeMapper mapper=session.getMapper(EmployeeMapper.class);</span><br><span class="line">    List&lt;Employee&gt;lists=mapper.getBycondition(employee);</span><br><span class="line">     <span class="keyword">for</span>(Employee list:lists)&#123;</span><br><span class="line"> System.out.println(list.toString());</span><br><span class="line">     &#125;</span><br><span class="line">    log.info(mapper);</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception  e)&#123;</span><br><span class="line">    System.out.println(<span class="string">"查询数据异常..."</span>+e);</span><br><span class="line">    session.rollback();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">可以看到，即使在条件中给了两个不为空的，但是由于EmpId在最前面，因此首先匹配上后就不在往下找了，和switch很像。最终的运行结果：</font></p><center><a href="https://sm.ms/image/oxK6G1jXEkBm34v" target="_blank"><img src="https://i.loli.net/2019/08/17/oxK6G1jXEkBm34v.png"></a></center><h4 id="trim-where"><a href="#trim-where" class="headerlink" title="trim, where"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">trim, where</font></div></h4><p>看看下面的这条这种情况：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmp"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">   select * from employee where </span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span> and emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>and emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selsct</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">如果三个分之没有一条分支匹配上，那么最终的sql语句会变成：</font></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span></span><br></pre></td></tr></table></figure><p><font color="black">这显然是会导致查询失败的。如果仅仅第二条或第三条匹配，那么sql语句会变成这样:</font></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span>  <span class="keyword">and</span> emp_age=<span class="comment">#&#123;empAge&#125;</span></span><br><span class="line"><span class="comment">/*或者是下面的样子*/</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span>  <span class="keyword">and</span> emp_age=<span class="comment">#&#123;empAge&#125;</span></span><br></pre></td></tr></table></figure><p><font color="black">不论是那种情况，都会导致由于sql语句错误而查询失败。MyBatis 有一个简单的处理，这在90%的情况下都会有用。那就是使用where元素，where 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。例如：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmp"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">   select * from employee </span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span> and emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"empAge!=null"</span>&gt;</span>and emp_age=#&#123;empAge&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selsct</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  &nbsp;&nbsp;&nbsp;&nbsp;<font color="black">这样即使三条语句都不满足条件，那么最终的sql语句是：<code>select * from employee</code>，也不会影响正常的查询。</font><br>   &nbsp;&nbsp;&nbsp;&nbsp;<font color="black">如果 where 元素没有按正常套路出牌，我们还是可以通过自定义 trim 元素来定制我们想要的功能。比如，和 where 元素等价的自定义 trim 元素为：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND |OR "</span>&gt;</span></span><br><span class="line">  ... </span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure><p> &nbsp;&nbsp;&nbsp;&nbsp;<font color="black">prefixOverrides 属性会忽略通过管道分隔的文本序列（注意此例中的空格也是必要的）。它带来的结果就是所有在 prefixOverrides 属性中指定的内容将被移除，并且插入 prefix 属性中指定的内容。<br>类似的用于动态更新语句的解决方案叫做 set。set 元素可以被用于动态包含需要更新的列，而舍去其他的.</font></p><h4 id="set"><a href="#set" class="headerlink" title="set"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">set</font></div></h4><p>&nbsp;&nbsp;&nbsp;&nbsp;<font color="black">set用于动态更新语句的解决方案叫做 set。set 元素可以被用于动态包含需要更新的列，而舍去其他的.示例：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByConditon"</span>&gt;</span></span><br><span class="line">update employee</span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"param1.empId!=null"</span>&gt;</span></span><br><span class="line">      emp_id=#&#123;param1.empId&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"param1.empName!=null"</span>&gt;</span></span><br><span class="line">       emp_name=#&#123;param1.empName&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"param1.empSex!=null"</span>&gt;</span></span><br><span class="line">       emp_sex=#&#123;param1.empSex&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"param1.empAge!=null"</span>&gt;</span></span><br><span class="line">       emp_age=#&#123;param1.empAge&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">where emp_age=#&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">java代码：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateByConditon</span><span class="params">()</span></span>&#123;</span><br><span class="line">   SqlSession session=sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">        EmployeeMapper em=session.getMapper(EmployeeMapper.class);</span><br><span class="line">        List&lt;Employee&gt; lists=em.getAll();</span><br><span class="line">        <span class="keyword">for</span>(Employee list:lists)&#123;</span><br><span class="line">           list.setEmpName(<span class="string">"蔡徐坤"</span>);</span><br><span class="line">           em.updateByConditon(list,<span class="number">22</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         log.info(em);</span><br><span class="line">     &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         session.close();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;<font color="black">set 元素会动态前置 SET 关键字，同时也会消除无关的逗号，因为用了条件语句之后很可能就会在生成的赋值语句的后面留下这些逗号</font></p><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">foreach</font></div></h4><p>&nbsp;&nbsp;&nbsp;&nbsp;<font color="black">动态 SQL 的另外一个常用的必要操作是需要对一个集合进行遍历，通常是在构建 in 条件语句的时候:</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPostIn"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">  SELECT * FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"lists"</span> <span class="attr">item</span>=<span class="string">"list"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;list&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">foreach标签中可以使用的属性如下：</font><br><font color="black">1. collection ：collection属性的值有三个分别是list、array、map三种，分别对应的java类型为：List、数组、map集合</font><br><font color="black">2. item ： 表示在迭代过程中每一个元素的别名</font><br><font color="black">3. index ：遍历过程的索引值</font><br><font color="black">4. open ：前缀</font><br><font color="black">5. close ：后缀</font><br><font color="black">6. separator ：分隔符，表示迭代时每个元素之间以什么分隔</font><br><font color="black">7. foreach标签主要用于构建in条件，他可以在sql中对集合进行迭代。</font></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;font color=&quot;black&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;MyBatis 的强大特性之一便是它的动态 SQL。动态 SQL 元素和使用 JSTL 或其他类似基于 XML 的文本处理器相似。在 MyBatis 之前的版本中,有很多的元素需要来了解
      
    
    </summary>
    
      <category term="Mybatis框架" scheme="http://easyblog.top/categories/Mybatis%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://easyblog.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis 全局XML文件的配置</title>
    <link href="http://easyblog.top/2019/07/26/Mybatis%E5%85%A8%E5%B1%80XML%E6%96%87%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
    <id>http://easyblog.top/2019/07/26/Mybatis全局XML文件的配置/</id>
    <published>2019-07-26T10:24:53.000Z</published>
    <updated>2019-08-17T16:19:50.685Z</updated>
    
    <content type="html"><![CDATA[<h4 id="properties"><a href="#properties" class="headerlink" title="properties"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">properties</font></div></h4><blockquote><p><font color="black">properties提供了一个通过外部配置文件(例如数据库配置文件)来动态配置环境的方法。以动态配置数据库为例：</font></p></blockquote><p><font color="black">数据库配置文件jdbc.properties的详细配置如下：</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://127.0.0.1:3306/xust?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;set global time_zone=&apos;+8:00&apos; </span><br><span class="line">username=root</span><br><span class="line">password=95162437</span><br></pre></td></tr></table></figure><p><font color="black">那么我们可以在mybatis-config.xml中这么写：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置外部数据库文件的位置，把它加载进来--&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbc.properties"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--通过在外部动态配置的方式来配置--&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--需要注意的是value后面的值如果没有自定义，必须和外部配置文件中的名字一致--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/StudentMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="settings"><a href="#settings" class="headerlink" title="settings"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">settings</font></div></h4><p>setting可以调整MyBatis的一些分长重要的配置，它们会改变 MyBatis 的运行时的行为，具体都有哪些配置可以设置可以参考官网，这里不再赘述，这里说几个常用的：</p><table boder="1px" width="100%"><thead><th>设置参数</th><th>描述</th><th>有效值</th><th>默认值</th></thead><tbody> <tr> <th><h5>cacheEnabled</h5></th>  <th>该配置影响的所有映射器中配置的缓存的全局开关。</th>   <th>true | false</th>    <th>true</th></tr>  <tr> <th><h5>lazyLoadingEnabled</h5></th>  <th>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置fetchType属性来覆盖该项的开关状态。</th>   <th>true | false    </th>    <th>    false</th></tr>  <tr><th> <font color="red"><h5>mapUnderscoreToCamelCase</h5></font></th>  <th> <font color="red">是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。</font></th>   <th> <font color="red">true | false</font></th>    <th> <font color="red">    false</font></th></tr>  <tr> <th><h5>logImpl</h5></th>  <th>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</th>   <th>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</th>    <th>Not set</th></tr>  <tr> <th><h5>logPrefix</h5>    </th>  <th>指定 MyBatis 增加到日志名称的前缀。</th>   <th>    Any String    </th>    <th>Not set</th></tr> <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></tbody></table><p><font color="black">Mybatis中可配置的settings如下：<font></font></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--一些有关于mybatis运行是行为的设置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingBehavior"</span> <span class="attr">value</span>=<span class="string">"PARTIAL"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingUnknownColumnBehavior"</span> <span class="attr">value</span>=<span class="string">"WARNING"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultExecutorType"</span> <span class="attr">value</span>=<span class="string">"SIMPLE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"25"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultFetchSize"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"safeRowBoundsEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>    <span class="comment">&lt;!--设置数据库字段的下换线自动映射到java的驼峰模式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"localCacheScope"</span> <span class="attr">value</span>=<span class="string">"SESSION"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"OTHER"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">"equals,clone,hashCode,toString"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="red" size="4">注意：settings、properties这些标签配置的位置不是随便的，他们的位置必须放在environment标签之前!<font></font></font></p><h4 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">typeAliases</font></div></h4><p><font size="3" color="black">类型别名是为 Java 类型设置一个短的名字。它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余,即人好记，好写。</font></p><h5 id="给单独的一个类重命名"><a href="#给单独的一个类重命名" class="headerlink" title="给单独的一个类重命名"></a><font color="black">给单独的一个类重命名</font></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Employee"</span> <span class="attr">type</span>=<span class="string">"com.xzy.bean.Employee"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">这样做后，以后在程序中任何使用com.xzy.bean.Employee的地方都可以用Employee来代替，例如：</font></p><font color="black">在mybatis-config.xml中添加如下配置：</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--给com.xzy.bean.Employee重命名为Employee--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"com.xzy.bean.Employee"</span> <span class="attr">alias</span>=<span class="string">"Employee"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">那么，在EmpoyeeMapper.xml中可以这么用：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xzy.mapper.EmployeeMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!--原本这个地方的参数类型应该写成com.xzy.bean.Employee,由于重命名了可以直接使用重命的名子--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"Employee"</span> &gt;</span></span><br><span class="line">        insert into employee(emp_id,emp_name,emp_age,emp_sex) values(#&#123;empId&#125;,#&#123;empName&#125;,#&#123;empAge&#125;,#&#123;empSex&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        delete from employee where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--更新--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> &gt;</span></span><br><span class="line">        update employee set  emp_id=#&#123;param2.empId&#125;,emp_name=#&#123;param2.empName&#125;,emp_age=#&#123;param2.empAge&#125;,emp_sex=#&#123;param2.empSex&#125; where id=#&#123;param1&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">      select * from employee where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAll"</span> <span class="attr">resultType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="给整个包重命名"><a href="#给整个包重命名" class="headerlink" title="给整个包重命名"></a><font color="black">给整个包重命名</font></h5><p><font size="3" color="black">使用package元素:</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;package name=&quot;com.xzy.bean&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure><p> &nbsp; &nbsp; &nbsp; &nbsp;<font color="black">这样一来每一个在包 com.xzy.bean中的 Java Bean，在没有注解的情况下，会使用类名的首字母小写来作为它的别名。如果使用了注解，那就以注解为他的别名。</font></p><h5 id="可以使用-Alias-name-注解给一个Java-Bean重命名"><a href="#可以使用-Alias-name-注解给一个Java-Bean重命名" class="headerlink" title="可以使用@Alias(name)注解给一个Java Bean重命名"></a><font color="black">可以使用<font color="red">@Alias(name)</font>注解给一个Java Bean重命名</font></h5><p><font color="black">其中name就是你给这个JavaBean起的别名</font></p><h4 id="TypeHandler—类型处理器"><a href="#TypeHandler—类型处理器" class="headerlink" title="TypeHandler—类型处理器"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">TypeHandler—类型处理器</font></div></h4><p><font color="black"> &nbsp; &nbsp; &nbsp; &nbsp;无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会用类型处理器将获取的值以合适的方式转换成 Java 类型。Mytais给了很多的类型处理器来实现java类型到数据库类型的转换，但是就是这样内置的类型处理器还是无法完全胜任，因此MyBatis允许我们重写类型处理器或创建自己的类型处理器来处理不支持的或非标准的类型。</font><br><font color="black">具体做法为：实现 org.apache.ibatis.type.TypeHandler 接口， 或继承类 org.apache.ibatis.type.BaseTypeHandler， 然后可以选择性地将它映射到一个 JDBC 类型。</font><br><font color="black">比如，有一个Phone类型：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pre;   <span class="comment">//手机的前缀</span></span><br><span class="line">    <span class="keyword">private</span> String num;   <span class="comment">//手机号码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">(String num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num=num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">(String pre,String num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pre=pre;</span><br><span class="line">        <span class="keyword">this</span>.num=num;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">//省略getter、setter...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Phone&#123;"</span> +</span><br><span class="line">                <span class="string">"pre='"</span> + pre + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", num='"</span> + num + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">在另一个javaBean中使用他：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String empId;</span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> empAge;</span><br><span class="line">    <span class="keyword">private</span> String empSex;</span><br><span class="line">    <span class="keyword">private</span>  Phone phone;    <span class="comment">//phone类型,他在MyBatis转换的时候肯定会出错的，因为数据库中没有Phone这种类型，那么这时候就需要自定义类型处理器了</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//省略getter、setter....</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Employee&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", empId='"</span> + empId + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", empName='"</span> + empName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", empAge="</span> + empAge +</span><br><span class="line">                <span class="string">", empSex='"</span> + empSex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="自定义类型处理器"><a href="#自定义类型处理器" class="headerlink" title="自定义类型处理器"></a><font color="black">自定义类型处理器</font></h5><p><font color="black">自定义一个类型处理器，让他实现Typehandler接口，这个接口有一个泛型，这个参数就是处理后需要的java中对应对类型。</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.typeHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.TypeHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Phone的类型处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneHandler</span> <span class="keyword">implements</span> <span class="title">TypeHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置参数</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, String phone, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps.setString(i,phone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*********下面的都是得到参数**********/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResult</span><span class="params">(ResultSet res, String s)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res.getString(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResult</span><span class="params">(ResultSet res, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res.getString(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResult</span><span class="params">(CallableStatement call, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> call.getString(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">在mybatis-config.xml中注册这个类型处理器</font><br><font color="black">注册的方式有两种，一种是使用&lt;typeHandler handler=””/&gt;这个标签，在handler属性中执行处理器的全类名;另一种方式是直接使用&lt;packge name=””/&gt;标签在name属性中指定包名，然后整个包下的处理器都会被自动注册。具体如下：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1.单个处理器注册--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"com.xzy.handler.PhoneHandler"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--或者这样：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--2.直接把这个包名注册--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.xzy.handler"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置环境（environments）"><a href="#配置环境（environments）" class="headerlink" title="配置环境（environments）"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">配置环境（environments）</font></div></h4><p><font color="black">MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。<br><strong>不过要记住：尽管可以配置多个环境，但是每个 SqlSessionFactory 实例只能选择其一。</strong></font><br><font color="black">环境配置实例：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"..."</span> <span class="attr">value</span>=<span class="string">"..."</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="事务管理器（transactionManager）"><a href="#事务管理器（transactionManager）" class="headerlink" title="事务管理器（transactionManager）"></a><font color="black">事务管理器（transactionManager）</font></h5><p><font color="black">在 MyBatis 中有两种类型的事务管理器（也就是 type=”[JDBC|MANAGED]”）：<font></font></font></p><li><font color="black">JDBC – 这个配置就是直接使用了 JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域。</font></li><li><font color="black">MANAGED – 这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期</font></li><h5 id="数据源（dataSource）"><a href="#数据源（dataSource）" class="headerlink" title="数据源（dataSource）"></a><font color="black">数据源（dataSource）</font></h5><p><font color="black">dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。有三种内建的数据源类型（也就是 type=”[UNPOOLED|POOLED|JNDI]”）</font></p><ul><li><font color="black">UNPOOLED– 这个数据源的实现只是每次被请求时打开和关闭连接。这就是每次操作就要和数据库发生物理连接，数据会慢很多。</font></li><li><font color="black">这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种方式每次需要和数据可连接的时候就直接去连接池中去拿。</font></li><li><font color="black">这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。</font></li></ul><font color="black">通过需要实现接口 org.apache.ibatis.datasource.DataSourceFactory ， 也可使用任何第三方数据源：</font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DataSourceFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties props)</span></span>;</span><br><span class="line">  <span class="function">DataSource <span class="title">getDataSource</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="映射器（mappers）"><a href="#映射器（mappers）" class="headerlink" title="映射器（mappers）"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">映射器（mappers）</font></div></h4><p><font color="black">mappers的作用就是告诉mybatis去哪里找SQL语句，因此对他的配置是至关重要。mybatis提供了如下4种配置的方法:</font></p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用 resource --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=<span class="string">"org/mybatis/builder/AuthorMapper.xml"</span>/&gt;</span><br><span class="line">  &lt;mapper resource=<span class="string">"org/mybatis/builder/BlogMapper.xml"</span>/&gt;</span><br><span class="line">  &lt;mapper resource=<span class="string">"org/mybatis/builder/PostMapper.xml"</span>/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用文件路径url --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper url=<span class="string">"file:///var/mappers/AuthorMapper.xml"</span>/&gt;</span><br><span class="line">  &lt;mapper url=<span class="string">"file:///var/mappers/BlogMapper.xml"</span>/&gt;</span><br><span class="line">  &lt;mapper url=<span class="string">"file:///var/mappers/PostMapper.xml"</span>/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用接口的全部类名 class --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper class=<span class="string">"org.mybatis.builder.AuthorMapper"</span>/&gt;</span><br><span class="line">  &lt;mapper class=<span class="string">"org.mybatis.builder.BlogMapper"</span>/&gt;</span><br><span class="line">  &lt;mapper class=<span class="string">"org.mybatis.builder.PostMapper"</span>/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用name 注册一个包下的所有mapper接口 --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;package name=<span class="string">"org.mybatis.builder"</span>/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><p><strong><font color="black">至此,对于mybatis的配置大致完成了，接下来就是对映射文件的配置了。</font><strong></strong></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;properties&quot;&gt;&lt;a href=&quot;#properties&quot; class=&quot;headerlink&quot; title=&quot;properties&quot;&gt;&lt;/a&gt;&lt;div style=&quot;background-color: rgb(0,128,128);line-height
      
    
    </summary>
    
      <category term="Mybatis框架" scheme="http://easyblog.top/categories/Mybatis%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://easyblog.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>认识MyBatis</title>
    <link href="http://easyblog.top/2019/07/25/%E8%AE%A4%E8%AF%86Mybatis/"/>
    <id>http://easyblog.top/2019/07/25/认识Mybatis/</id>
    <published>2019-07-25T10:27:20.000Z</published>
    <updated>2019-08-17T16:15:28.806Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是MyBatis"><a href="#什么是MyBatis" class="headerlink" title="什么是MyBatis?"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">什么是MyBatis?</font></div></h4><p><font color="black">MyBatis 是一款优秀的java持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</font></p><h4 id="MyBatis的历史"><a href="#MyBatis的历史" class="headerlink" title="MyBatis的历史"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">MyBatis的历史</font></div></h4><p><font color="black">原是Apache的一个开源项目iBatis, 2010年6月这个项目由Apache Software Foundation 迁移到了Google Code，随着开发团队转投Google Code旗下， iBatis3.x正式更名为MyBatis ，代码于2013年11月迁移到Github（下载地址见后）。iBatis一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。 iBatis提供的持久层框架包括SQL Maps和Data Access Objects（DAO）<br></font></p><h4 id="为什么要使用MyBatis"><a href="#为什么要使用MyBatis" class="headerlink" title="为什么要使用MyBatis?"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">为什么要使用MyBatis?</font></div></h4><ul><li><font color="black">MyBatis是一个半自动化的持久化层框架。</font></li><li><font color="black">JDBC的不足：-SQL夹在Java代码块里，耦合度高导致硬编码内伤-维护不易且实际开发需求中sql是有变化，频繁修改的情况多见</font></li><li><font color="black">Hibernate和JPA-长难复杂SQL，对于Hibernate而言处理也不容易-内部自动生产的SQL，不容易做特殊优化。-基于全映射的全自动框架，大量字段的POJO进行部分映射时比较困难。导致数据库性能下降。</font></li><li><font color="black">对开发人员而言，核心sql还是需要自己优化</font></li><li><font color="black">sql和java编码分开，功能边界清晰，一个专注业务、一个专注数据。</font></li></ul><h4 id="去哪里找MyBatis"><a href="#去哪里找MyBatis" class="headerlink" title="去哪里找MyBatis?"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">去哪里找MyBatis?</font></div></h4><p><font color="black">MyBatis：<a href="https://github.com/mybatis/mybatis-3" target="_blank" rel="noopener">https://github.com/mybatis/mybatis-3</a></font></p><center><a href="https://sm.ms/image/KvpHPo4DL7lmARa" target="_blank"><img src="https://i.loli.net/2019/08/17/KvpHPo4DL7lmARa.png"></a></center><h4 id="简单的配置让MyBatis跑起来"><a href="#简单的配置让MyBatis跑起来" class="headerlink" title="简单的配置让MyBatis跑起来"></a><div style="background-color: rgb(0,128,128);line-height: 35px;"><font color="black" size="4">简单的配置让MyBatis跑起来</font></div></h4><h5 id="创建Maven项目"><a href="#创建Maven项目" class="headerlink" title="创建Maven项目"></a><font color="black">创建Maven项目</font></h5><li>在IDEA中打开【File】->【New】->【New Project】,然后选择【Maven】，创建一个【webapp】工程，如图所示</li><center><a href="https://sm.ms/image/Zqk3zC9XoYmQRsI" target="_blank"><img src="https://i.loli.net/2019/08/17/Zqk3zC9XoYmQRsI.png"></a></center><li>填写【GroupId】和【ArtifactId】,填好后点击【Next】</li><li><center><a href="https://sm.ms/image/BbL5gRmpdqI19Ar" target="_blank"><img src="https://i.loli.net/2019/08/17/BbL5gRmpdqI19Ar.png"></a></center><center><a href="https://sm.ms/image/bTdOMBZVDhvsEkW" target="_blank"><img src="https://i.loli.net/2019/08/17/bTdOMBZVDhvsEkW.png"></a></center><font color="black">完成上面的操作后，等待片刻，一个基于Maven的基本结构就创建完成了，得到的Maven项目的目录结构如下图：</font><center><a href="https://sm.ms/image/eGXHWpy9dxNOqRE" target="_blank"><img src="https://i.loli.net/2019/08/17/eGXHWpy9dxNOqRE.gif"></a></center><font color="black">打开Mavne项目的pom.xml配置文件，向文件中添加MyBatis依赖、数据库JDBC驱动和Log4j等依赖</font><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis的依赖包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--数据库驱动的依赖包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--日志记录--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">完成以上操作后，MyBatis的基本开发环境就已经搭建好了，接下来我们开始实现衣蛾简单的查询功能。</font></p><h5 id="准备数据库"><a href="#准备数据库" class="headerlink" title="准备数据库"></a><font color="black">准备数据库</font></h5><p><font color="black">创建Student表</font></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line">    <span class="keyword">sid</span> <span class="built_in">varchar</span>(<span class="number">255</span>) primary <span class="keyword">key</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    sname <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    major_in <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    sclass <span class="built_in">varchar</span>(<span class="number">255</span>)  </span><br><span class="line">);</span><br></pre></td></tr></table></figure><h5 id="创建实体类和Mapper文件"><a href="#创建实体类和Mapper文件" class="headerlink" title="创建实体类和Mapper文件"></a><font color="black">创建实体类和Mapper文件</font></h5><p><font color="black">在【main】下新建一个文件夹【java】,并标记为【Source Root】，然后在src/main/java下新建一个基础包com.xzy,在这个包下在创建一个beans包，在这个包中创建一个实体类Student,代码如下：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xzy.beans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span>  <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> String majorIn;</span><br><span class="line">    <span class="keyword">private</span> String sclass;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSid</span><span class="params">(String sid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sid = sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSname</span><span class="params">(String sname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sname = sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMajorIn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> majorIn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMajorIn</span><span class="params">(String majorIn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.majorIn = majorIn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sclass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSclass</span><span class="params">(String sclass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sclass = sclass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"sid='"</span> + sid + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sname='"</span> + sname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", major_in='"</span> + majorIn + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sclass='"</span> + sclass + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">再在【com.xzy】包下新建一个包【dao.mapper】,在里面新建一个接口StudentMapper</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.xzy.dao.mapper;</span><br><span class="line"></span><br><span class="line">import com.xzy.beans.Student;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface StudentMapper &#123;</span><br><span class="line"></span><br><span class="line">    public List<span class="tag">&lt;<span class="name">Student</span>&gt;</span> getAll();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="balck">在【main】下新建一个文件夹【resoources】,并标记为【Resources Root】,然后在src/main/resources下创建目录【mapper】,在mapper目录中创建StudentMapper.xml文件，添加如下内容：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xzy.dao.mapper.StudentMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询学生表中的所有学生--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAll"</span> <span class="attr">resultType</span>=<span class="string">"com.xzy.beans.Student"</span>&gt;</span></span><br><span class="line">         select * from student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置MyBatis"><a href="#配置MyBatis" class="headerlink" title="配置MyBatis"></a><font color="black">配置MyBatis</font></h5><p><font color="black">MyBatis有多种配置方式，这里使用最基础最常用的XML配置方式。<br><br>首先在【src/main/resources】下创建【MyBatis-config.xml】文件，输入如下内容：<br></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbc.properties"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--一些有关于mybatis运行是行为的设置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingBehavior"</span> <span class="attr">value</span>=<span class="string">"PARTIAL"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingUnknownColumnBehavior"</span> <span class="attr">value</span>=<span class="string">"WARNING"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultExecutorType"</span> <span class="attr">value</span>=<span class="string">"SIMPLE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"25"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultFetchSize"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"safeRowBoundsEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>    <span class="comment">&lt;!--设置数据库字段的下换线自动映射到java的驼峰模式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"localCacheScope"</span> <span class="attr">value</span>=<span class="string">"SESSION"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"OTHER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">"equals,clone,hashCode,toString"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置数据库连接，可以配置多个数据库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--通过在外部动态配置的方式来配置--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/StudentMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="black">上面的配置文件中需要一个jdbbc.properties的配置文件，同样在【src/main/resources】下新建jdbc,properties文件 ，然后输入如下内容：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3306/xust?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;set global time_zone='+8:00' </span><br><span class="line">username=root</span><br><span class="line">password=123456</span><br></pre></td></tr></table></figure><h5 id="配置Log4j一遍查看MyBatis操作数据库的过程"><a href="#配置Log4j一遍查看MyBatis操作数据库的过程" class="headerlink" title="配置Log4j一遍查看MyBatis操作数据库的过程"></a><font color="black">配置Log4j一遍查看MyBatis操作数据库的过程</font></h5><p><font color="black">在src/main/resources中添加log4j.properties配置文件，输入一下内容：</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">### set log levels ###  </span><br><span class="line">log4j.rootLogger = DEBUG , console , debug , error  </span><br><span class="line">  </span><br><span class="line">### console ###  </span><br><span class="line">log4j.appender.console = org.apache.log4j.ConsoleAppender  </span><br><span class="line">log4j.appender.console.Target = System.out  </span><br><span class="line">log4j.appender.console.layout = org.apache.log4j.PatternLayout  </span><br><span class="line">log4j.appender.console.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH\:mm\:ss&#125; [%p]-[%c] %m%n  </span><br><span class="line">  </span><br><span class="line">### log file ###  </span><br><span class="line">log4j.appender.debug = org.apache.log4j.DailyRollingFileAppender  </span><br><span class="line">log4j.appender.debug.File = redcmsv6.log  </span><br><span class="line">log4j.appender.debug.Append = true  </span><br><span class="line">log4j.appender.debug.Threshold = INFO  </span><br><span class="line">log4j.appender.debug.layout = org.apache.log4j.PatternLayout  </span><br><span class="line">log4j.appender.debug.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH\:mm\:ss&#125; [%p]-[%c] %m%n  </span><br><span class="line">  </span><br><span class="line">### exception ###  </span><br><span class="line">log4j.appender.error = org.apache.log4j.DailyRollingFileAppender  </span><br><span class="line">log4j.appender.error.File = redcms.log  </span><br><span class="line">log4j.appender.error.Append = true  </span><br><span class="line">log4j.appender.error.Threshold = ERROR  </span><br><span class="line">log4j.appender.error.layout = org.apache.log4j.PatternLayout  </span><br><span class="line">log4j.appender.error.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH\:mm\:ss&#125; [%p]-[%c] %m%n</span><br></pre></td></tr></table></figure><h5 id="编写测试代码然MyBatis跑起来"><a href="#编写测试代码然MyBatis跑起来" class="headerlink" title="编写测试代码然MyBatis跑起来"></a><font color="black">编写测试代码然MyBatis跑起来</font></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xzy.beans.Student;</span><br><span class="line"><span class="keyword">import</span> com.xzy.dao.mapper.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Unit test for simple App.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span></span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String resource = <span class="string">"MyBatis-CONFIG.xml"</span>;</span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testselectAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession session=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//接口</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           StudentMapper sm = session.getMapper(StudentMapper.class);</span><br><span class="line">           List&lt;Student&gt; stus = sm.getAll();</span><br><span class="line">           <span class="keyword">for</span> (Student stu : stus)</span><br><span class="line">               System.out.println(stu.toString());</span><br><span class="line">           System.out.println(<span class="string">"Ok"</span>);</span><br><span class="line">       &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">           session.close();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="black">测试结果：</font></p><center><a href="https://sm.ms/image/lh5CfirmMIdoUAp" target="_blank"><img src="https://i.loli.net/2019/08/17/lh5CfirmMIdoUAp.png"></a></center></li>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;什么是MyBatis&quot;&gt;&lt;a href=&quot;#什么是MyBatis&quot; class=&quot;headerlink&quot; title=&quot;什么是MyBatis?&quot;&gt;&lt;/a&gt;&lt;div style=&quot;background-color: rgb(0,128,128);line-heigh
      
    
    </summary>
    
      <category term="Mybatis框架" scheme="http://easyblog.top/categories/Mybatis%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://easyblog.top/tags/Mybatis/"/>
    
  </entry>
  
</feed>
